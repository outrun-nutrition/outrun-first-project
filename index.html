<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‹å‹•ç‡Ÿé¤Šè¨ˆç®—å™¨</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --primary:#2563eb;--primary-light:#3b82f6;--primary-dark:#1d4ed8;
    --accent:#10b981;--accent-dark:#059669;
    --bg:#f8fafc;--surface:#ffffff;--surface-alt:#f1f5f9;
    --text:#0f172a;--text-secondary:#475569;--text-muted:#94a3b8;
    --border:#e2e8f0;--radius:12px;--shadow:0 1px 3px rgba(0,0,0,.08);
    --shadow-md:0 4px 12px rgba(0,0,0,.1);
  }
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",sans-serif;background:var(--bg);color:var(--text);line-height:1.6}

  /* Container */
  .nc-wrap{max-width:680px;margin:0 auto;padding:24px 16px}
  .nc-header{text-align:center;margin-bottom:32px}
  .nc-header h1{font-size:1.75rem;font-weight:700;color:var(--text);margin-bottom:6px}
  .nc-header p{color:var(--text-secondary);font-size:.95rem}

  /* Progress bar */
  .nc-progress{display:flex;gap:6px;margin-bottom:28px}
  .nc-progress .bar{flex:1;height:4px;border-radius:2px;background:var(--border);transition:background .3s}
  .nc-progress .bar.active{background:var(--primary)}
  .nc-progress .bar.done{background:var(--accent)}

  /* Card */
  .nc-card{background:var(--surface);border-radius:var(--radius);padding:28px 24px;box-shadow:var(--shadow);border:1px solid var(--border)}
  .nc-step-title{font-size:1.15rem;font-weight:600;margin-bottom:4px}
  .nc-step-desc{color:var(--text-secondary);font-size:.88rem;margin-bottom:20px}

  /* Form elements */
  .nc-field{margin-bottom:18px}
  .nc-field label{display:block;font-size:.88rem;font-weight:500;color:var(--text-secondary);margin-bottom:6px}
  .nc-field input[type="number"],.nc-field select{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-size:1rem;color:var(--text);background:var(--surface);transition:border-color .2s}
  .nc-field input:focus,.nc-field select:focus{outline:none;border-color:var(--primary)}
  .nc-row{display:flex;gap:12px}
  .nc-row .nc-field{flex:1}

  /* Toggle group (radio buttons as cards) */
  .nc-toggle-group{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .nc-toggle-group.cols-3{grid-template-columns:repeat(3,1fr)}
  .nc-toggle-group input{display:none}
  .nc-toggle-group label.nc-toggle{display:flex;flex-direction:column;align-items:center;gap:4px;padding:14px 8px;border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all .2s;text-align:center;font-size:.85rem;font-weight:500}
  .nc-toggle-group label.nc-toggle:hover{border-color:var(--primary-light);background:rgba(37,99,235,.03)}
  .nc-toggle-group input:checked+label.nc-toggle{border-color:var(--primary);background:rgba(37,99,235,.06);color:var(--primary)}
  .nc-toggle .nc-icon{font-size:1.5rem;margin-bottom:2px}

  /* Buttons */
  .nc-actions{display:flex;gap:10px;margin-top:24px}
  .nc-btn{flex:1;padding:12px 20px;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}
  .nc-btn-primary{background:var(--primary);color:#fff}
  .nc-btn-primary:hover{background:var(--primary-dark)}
  .nc-btn-secondary{background:var(--surface-alt);color:var(--text-secondary);border:1px solid var(--border)}
  .nc-btn-secondary:hover{background:var(--border)}
  .nc-btn:disabled{opacity:.5;cursor:not-allowed}

  /* Results page */
  .nc-result-section{margin-bottom:24px}
  .nc-result-section h3{font-size:1.05rem;font-weight:600;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid var(--border)}
  .nc-calorie-box{display:flex;justify-content:center;align-items:center;gap:16px;padding:20px;background:linear-gradient(135deg,#eff6ff,#f0fdf4);border-radius:var(--radius);margin-bottom:24px}
  .nc-calorie-num{font-size:2.2rem;font-weight:700;color:var(--primary)}
  .nc-calorie-unit{color:var(--text-secondary);font-size:.9rem}

  /* Nutrient bars */
  .nc-nutrient{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--surface-alt)}
  .nc-nutrient:last-child{border-bottom:none}
  .nc-nutrient-name{width:100px;font-size:.88rem;font-weight:500;flex-shrink:0}
  .nc-nutrient-bar-wrap{flex:1;height:8px;background:var(--surface-alt);border-radius:4px;overflow:hidden}
  .nc-nutrient-bar{height:100%;border-radius:4px;transition:width .6s ease}
  .nc-nutrient-val{width:90px;text-align:right;font-size:.85rem;font-weight:600;flex-shrink:0}

  /* Product recommendation cards */
  .nc-product{display:flex;gap:16px;padding:16px;background:var(--surface-alt);border-radius:10px;margin-bottom:10px;align-items:center;transition:box-shadow .2s}
  .nc-product:hover{box-shadow:var(--shadow-md)}
  .nc-product-icon{width:52px;height:52px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0}
  .nc-product-info{flex:1}
  .nc-product-name{font-weight:600;font-size:.95rem;margin-bottom:2px}
  .nc-product-dose{font-size:.82rem;color:var(--text-secondary)}
  .nc-product-reason{font-size:.8rem;color:var(--text-muted);margin-top:2px}
  .nc-product-tag{padding:4px 10px;border-radius:20px;font-size:.75rem;font-weight:600;white-space:nowrap;flex-shrink:0}
  .nc-tag-essential{background:#dbeafe;color:#1d4ed8}
  .nc-tag-recommended{background:#d1fae5;color:#059669}
  .nc-tag-optional{background:#fef3c7;color:#b45309}

  /* Restart */
  .nc-restart-wrap{text-align:center;margin-top:20px}
  .nc-btn-restart{display:inline-flex;align-items:center;gap:6px;padding:10px 24px;border:2px solid var(--primary);border-radius:8px;background:transparent;color:var(--primary);font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s}
  .nc-btn-restart:hover{background:var(--primary);color:#fff}

  /* Disclaimer */
  .nc-disclaimer{margin-top:20px;padding:12px 16px;background:#fffbeb;border:1px solid #fde68a;border-radius:8px;font-size:.78rem;color:#92400e;line-height:1.5}

  /* Responsive */
  @media(max-width:480px){
    .nc-wrap{padding:16px 12px}
    .nc-card{padding:20px 16px}
    .nc-toggle-group{grid-template-columns:1fr 1fr}
    .nc-toggle-group.cols-3{grid-template-columns:1fr 1fr}
    .nc-row{flex-direction:column;gap:0}
    .nc-calorie-num{font-size:1.8rem}
  }

  /* Hidden utility */
  .nc-hidden{display:none!important}

  /* Animations */
  .nc-fade-in{animation:ncFadeIn .35s ease}
  @keyframes ncFadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="nc-wrap" id="ncApp">
  <div class="nc-header">
    <h1>ğŸ‹ï¸ é‹å‹•ç‡Ÿé¤Šè¨ˆç®—å™¨</h1>
    <p>æ ¹æ“šä½ çš„èº«é«”æ•¸æ“šèˆ‡è¨“ç·´ç›®æ¨™ï¼Œè¨ˆç®—æ¯æ—¥ç‡Ÿé¤Šéœ€æ±‚ä¸¦æ¨è–¦é©åˆçš„è£œå……å“</p>
  </div>

  <!-- Progress -->
  <div class="nc-progress" id="ncProgress">
    <div class="bar active"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>

  <!-- Step 1: Basic info -->
  <div class="nc-card nc-fade-in" id="step1">
    <div class="nc-step-title">åŸºæœ¬è³‡æ–™</div>
    <div class="nc-step-desc">è¼¸å…¥ä½ çš„åŸºæœ¬èº«é«”æ•¸æ“š</div>

    <div class="nc-field">
      <label>ç”Ÿç†æ€§åˆ¥</label>
      <div class="nc-toggle-group">
        <input type="radio" name="gender" id="genderM" value="male" checked>
        <label class="nc-toggle" for="genderM"><span class="nc-icon">ğŸ™‹â€â™‚ï¸</span>ç”·æ€§</label>
        <input type="radio" name="gender" id="genderF" value="female">
        <label class="nc-toggle" for="genderF"><span class="nc-icon">ğŸ™‹â€â™€ï¸</span>å¥³æ€§</label>
      </div>
    </div>

    <div class="nc-row">
      <div class="nc-field">
        <label for="age">å¹´é½¡ï¼ˆæ­²ï¼‰</label>
        <input type="number" id="age" min="15" max="80" placeholder="ä¾‹ï¼š28">
      </div>
      <div class="nc-field">
        <label for="weight">é«”é‡ï¼ˆå…¬æ–¤ï¼‰</label>
        <input type="number" id="weight" min="30" max="200" step="0.1" placeholder="ä¾‹ï¼š72">
      </div>
      <div class="nc-field">
        <label for="height">èº«é«˜ï¼ˆå…¬åˆ†ï¼‰</label>
        <input type="number" id="height" min="100" max="230" placeholder="ä¾‹ï¼š175">
      </div>
    </div>

    <div class="nc-actions">
      <button class="nc-btn nc-btn-primary" onclick="goStep(2)">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- Step 2: Activity level -->
  <div class="nc-card nc-hidden" id="step2">
    <div class="nc-step-title">æ´»å‹•é‡èˆ‡è¨“ç·´é »ç‡</div>
    <div class="nc-step-desc">é¸æ“‡æœ€ç¬¦åˆä½ ç›®å‰ç‹€æ…‹çš„é¸é …</div>

    <div class="nc-field">
      <label>æ¯é€±é‹å‹•è¨“ç·´é »ç‡</label>
      <div class="nc-toggle-group">
        <input type="radio" name="frequency" id="freq1" value="1-2">
        <label class="nc-toggle" for="freq1"><span class="nc-icon">ğŸš¶</span>1-2 æ¬¡</label>
        <input type="radio" name="frequency" id="freq2" value="3-4" checked>
        <label class="nc-toggle" for="freq2"><span class="nc-icon">ğŸƒ</span>3-4 æ¬¡</label>
        <input type="radio" name="frequency" id="freq3" value="5-6">
        <label class="nc-toggle" for="freq3"><span class="nc-icon">ğŸ’ª</span>5-6 æ¬¡</label>
        <input type="radio" name="frequency" id="freq4" value="7+">
        <label class="nc-toggle" for="freq4"><span class="nc-icon">ğŸ”¥</span>æ¯å¤©</label>
      </div>
    </div>

    <div class="nc-field">
      <label>ä¸»è¦é‹å‹•é¡å‹</label>
      <div class="nc-toggle-group cols-3">
        <input type="radio" name="sport" id="sport1" value="weight" checked>
        <label class="nc-toggle" for="sport1"><span class="nc-icon">ğŸ‹ï¸</span>é‡é‡è¨“ç·´</label>
        <input type="radio" name="sport" id="sport2" value="cardio">
        <label class="nc-toggle" for="sport2"><span class="nc-icon">ğŸƒâ€â™‚ï¸</span>æœ‰æ°§é‹å‹•</label>
        <input type="radio" name="sport" id="sport3" value="mixed">
        <label class="nc-toggle" for="sport3"><span class="nc-icon">âš¡</span>æ··åˆè¨“ç·´</label>
      </div>
    </div>

    <div class="nc-field">
      <label>æ¯æ¬¡è¨“ç·´æ™‚é•·</label>
      <div class="nc-toggle-group cols-3">
        <input type="radio" name="duration" id="dur1" value="30-45">
        <label class="nc-toggle" for="dur1">30-45 åˆ†é˜</label>
        <input type="radio" name="duration" id="dur2" value="45-75" checked>
        <label class="nc-toggle" for="dur2">45-75 åˆ†é˜</label>
        <input type="radio" name="duration" id="dur3" value="75+">
        <label class="nc-toggle" for="dur3">75 åˆ†é˜ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="nc-actions">
      <button class="nc-btn nc-btn-secondary" onclick="goStep(1)">ä¸Šä¸€æ­¥</button>
      <button class="nc-btn nc-btn-primary" onclick="goStep(3)">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- Step 3: Goals -->
  <div class="nc-card nc-hidden" id="step3">
    <div class="nc-step-title">è¨“ç·´ç›®æ¨™</div>
    <div class="nc-step-desc">ä½ ç›®å‰æœ€ä¸»è¦çš„å¥èº«ç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ</div>

    <div class="nc-field">
      <label>ä¸»è¦ç›®æ¨™</label>
      <div class="nc-toggle-group">
        <input type="radio" name="goal" id="goal1" value="muscle" checked>
        <label class="nc-toggle" for="goal1"><span class="nc-icon">ğŸ’ª</span>å¢è‚Œ</label>
        <input type="radio" name="goal" id="goal2" value="lean">
        <label class="nc-toggle" for="goal2"><span class="nc-icon">ğŸ”¥</span>æ¸›è„‚</label>
        <input type="radio" name="goal" id="goal3" value="maintain">
        <label class="nc-toggle" for="goal3"><span class="nc-icon">âš–ï¸</span>ç¶­æŒé«”æ…‹</label>
        <input type="radio" name="goal" id="goal4" value="performance">
        <label class="nc-toggle" for="goal4"><span class="nc-icon">ğŸš€</span>æå‡è¡¨ç¾</label>
      </div>
    </div>

    <div class="nc-field">
      <label>ä½ æœ‰ä»¥ä¸‹å›°æ“¾å—ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰</label>
      <div class="nc-toggle-group">
        <input type="checkbox" id="issue1" value="recovery">
        <label class="nc-toggle" for="issue1"><span class="nc-icon">ğŸ˜©</span>æ¢å¾©æ…¢</label>
        <input type="checkbox" id="issue2" value="fatigue">
        <label class="nc-toggle" for="issue2"><span class="nc-icon">ğŸ˜´</span>å®¹æ˜“ç–²å‹</label>
        <input type="checkbox" id="issue3" value="joint">
        <label class="nc-toggle" for="issue3"><span class="nc-icon">ğŸ¦´</span>é—œç¯€ä¸é©</label>
        <input type="checkbox" id="issue4" value="sleep">
        <label class="nc-toggle" for="issue4"><span class="nc-icon">ğŸŒ™</span>ç¡çœ å“è³ªå·®</label>
      </div>
    </div>

    <div class="nc-actions">
      <button class="nc-btn nc-btn-secondary" onclick="goStep(2)">ä¸Šä¸€æ­¥</button>
      <button class="nc-btn nc-btn-primary" onclick="calculate()">è¨ˆç®—çµæœ â†’</button>
    </div>
  </div>

  <!-- Step 4: Results -->
  <div class="nc-card nc-hidden" id="step4">
    <div class="nc-step-title">ğŸ“Š ä½ çš„æ¯æ—¥ç‡Ÿé¤Šéœ€æ±‚</div>
    <div class="nc-step-desc" id="resultSummary"></div>

    <div class="nc-calorie-box">
      <div>
        <div class="nc-calorie-num" id="resultTDEE">0</div>
        <div class="nc-calorie-unit">æ¯æ—¥å»ºè­°æ”å–ç†±é‡ (kcal)</div>
      </div>
    </div>

    <!-- Macro breakdown -->
    <div class="nc-result-section">
      <h3>å·¨é‡ç‡Ÿé¤Šç´ å»ºè­°</h3>
      <div id="macroList"></div>
    </div>

    <!-- Supplement recommendations -->
    <div class="nc-result-section">
      <h3>ğŸ’Š æ¨è–¦é‹å‹•ç‡Ÿé¤Šè£œå……å“</h3>
      <div id="productList"></div>
    </div>

    <div class="nc-disclaimer">
      âš ï¸ ä»¥ä¸Šè¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›ç‡Ÿé¤Šéœ€æ±‚å› å€‹äººé«”è³ªã€å¥åº·ç‹€æ³è€Œç•°ã€‚å¦‚æœ‰ç‰¹æ®Šç–¾ç—…æˆ–ç”¨è—¥æƒ…å½¢ï¼Œè«‹å…ˆè«®è©¢é†«å¸«æˆ–ç‡Ÿé¤Šå¸«ã€‚
    </div>

    <div class="nc-restart-wrap">
      <button class="nc-btn-restart" onclick="restart()">ğŸ”„ é‡æ–°è¨ˆç®—</button>
    </div>
  </div>
</div>

<script>
(function(){
  "use strict";

  /* ====== Helpers ====== */
  function getVal(name){
    var el = document.querySelector('input[name="'+name+'"]:checked');
    return el ? el.value : null;
  }
  function getNum(id){return parseFloat(document.getElementById(id).value)||0}
  function getChecked(){
    var ids=["issue1","issue2","issue3","issue4"],out=[];
    ids.forEach(function(id){if(document.getElementById(id).checked) out.push(document.getElementById(id).value)});
    return out;
  }

  /* ====== Step navigation ====== */
  var currentStep=1;
  window.goStep=function(n){
    if(n===2 && currentStep===1){
      if(!getNum("age")||!getNum("weight")||!getNum("height")){alert("è«‹å¡«å¯«å®Œæ•´çš„åŸºæœ¬è³‡æ–™");return}
    }
    document.getElementById("step"+currentStep).classList.add("nc-hidden");
    document.getElementById("step"+n).classList.remove("nc-hidden");
    document.getElementById("step"+n).classList.add("nc-fade-in");
    currentStep=n;
    updateProgress();
  };

  function updateProgress(){
    var bars=document.querySelectorAll("#ncProgress .bar");
    bars.forEach(function(b,i){
      b.className="bar";
      if(i<currentStep-1) b.classList.add("done");
      else if(i===currentStep-1) b.classList.add("active");
    });
  }

  /* ====== Calculation engine ====== */
  window.calculate=function(){
    var gender=getVal("gender"),age=getNum("age"),weight=getNum("weight"),height=getNum("height");
    var freq=getVal("frequency"),sport=getVal("sport"),duration=getVal("duration");
    var goal=getVal("goal"),issues=getChecked();

    /* BMR (Mifflin-St Jeor) */
    var bmr;
    if(gender==="male") bmr=10*weight+6.25*height-5*age+5;
    else bmr=10*weight+6.25*height-5*age-161;

    /* Activity multiplier */
    var actMul={"1-2":1.375,"3-4":1.55,"5-6":1.725,"7+":1.9};
    var tdee=Math.round(bmr*(actMul[freq]||1.55));

    /* Goal adjustment */
    var goalAdj={"muscle":1.1,"lean":0.8,"maintain":1,"performance":1.05};
    tdee=Math.round(tdee*(goalAdj[goal]||1));

    /* Macros */
    var proteinPerKg,carbPercent,fatPercent;
    switch(goal){
      case"muscle":   proteinPerKg=2.0; carbPercent=0.50; fatPercent=0.25; break;
      case"lean":     proteinPerKg=2.2; carbPercent=0.35; fatPercent=0.30; break;
      case"performance":proteinPerKg=1.8;carbPercent=0.55;fatPercent=0.20;break;
      default:        proteinPerKg=1.6; carbPercent=0.45; fatPercent=0.30;
    }
    /* Higher frequency â†’ slightly more protein */
    if(freq==="5-6"||freq==="7+") proteinPerKg+=0.2;

    var protein=Math.round(proteinPerKg*weight);
    var proteinCal=protein*4;
    var fat=Math.round((tdee*fatPercent)/9);
    var carb=Math.round((tdee-proteinCal-fat*9)/4);
    if(carb<0) carb=0;

    /* ====== Render results ====== */
    document.getElementById("resultTDEE").textContent=tdee.toLocaleString();
    document.getElementById("resultSummary").textContent=
      (gender==="male"?"ç”·æ€§":"å¥³æ€§")+"ãƒ»"+age+" æ­²ãƒ»"+weight+" kgãƒ»"+height+" cm";

    var macros=[
      {name:"è›‹ç™½è³ª",val:protein,unit:"g",color:"#2563eb",max:Math.round(2.5*weight)},
      {name:"ç¢³æ°´åŒ–åˆç‰©",val:carb,unit:"g",color:"#f59e0b",max:Math.round(tdee*0.65/4)},
      {name:"è„‚è‚ª",val:fat,unit:"g",color:"#ef4444",max:Math.round(tdee*0.4/9)}
    ];

    var macroHTML="";
    macros.forEach(function(m){
      var pct=Math.min(100,Math.round(m.val/m.max*100));
      macroHTML+='<div class="nc-nutrient">'
        +'<span class="nc-nutrient-name">'+m.name+'</span>'
        +'<div class="nc-nutrient-bar-wrap"><div class="nc-nutrient-bar" style="width:'+pct+'%;background:'+m.color+'"></div></div>'
        +'<span class="nc-nutrient-val">'+m.val+' '+m.unit+'</span></div>';
    });
    document.getElementById("macroList").innerHTML=macroHTML;

    /* ====== Product recommendations ====== */
    var products=buildRecommendations(gender,weight,goal,freq,sport,duration,issues,protein);
    var prodHTML="";
    products.forEach(function(p){
      prodHTML+='<div class="nc-product">'
        +'<div class="nc-product-icon" style="background:'+p.bgColor+'">'+p.icon+'</div>'
        +'<div class="nc-product-info">'
        +'<div class="nc-product-name">'+p.name+'</div>'
        +'<div class="nc-product-dose">å»ºè­°ç”¨é‡ï¼š'+p.dose+'</div>'
        +'<div class="nc-product-reason">'+p.reason+'</div></div>'
        +'<span class="nc-product-tag nc-tag-'+p.priority+'">'+p.priorityLabel+'</span></div>';
    });
    document.getElementById("productList").innerHTML=prodHTML;

    goStep(4);
  };

  /* ====== Recommendation engine ====== */
  function buildRecommendations(gender,weight,goal,freq,sport,duration,issues,proteinTarget){
    var items=[];
    var intense=(freq==="5-6"||freq==="7+");
    var longSession=(duration==="75+");

    /* 1. Whey Protein â€” almost always essential for athletes */
    var scoops=Math.ceil((proteinTarget*0.4)/25); /* ~40% from supplement */
    items.push({
      name:"ä¹³æ¸…è›‹ç™½",
      icon:"ğŸ¥¤",bgColor:"#dbeafe",
      dose:"æ¯æ—¥ "+scoops+" ä»½ï¼ˆç´„ "+(scoops*25)+"g è›‹ç™½è³ªï¼‰",
      reason:"è£œè¶³æ¯æ—¥è›‹ç™½è³ªç¼ºå£ï¼Œä¿ƒé€²è‚Œè‚‰åˆæˆèˆ‡ä¿®å¾©",
      priority:"essential",priorityLabel:"å¿…å‚™",
      score:100
    });

    /* 2. Creatine â€” especially for strength / muscle */
    if(goal==="muscle"||goal==="performance"||sport==="weight"||sport==="mixed"){
      items.push({
        name:"è‚Œé…¸ (Creatine Monohydrate)",
        icon:"âš¡",bgColor:"#fef3c7",
        dose:"æ¯æ—¥ 3-5gï¼Œæ­é…æ°´æˆ–æœæ±æœç”¨",
        reason:"æå‡åŠ›é‡è¼¸å‡ºèˆ‡çˆ†ç™¼åŠ›ï¼ŒåŠ é€Ÿç£·é…¸è‚Œé…¸å†åˆæˆ",
        priority:"essential",priorityLabel:"å¿…å‚™",
        score:95
      });
    }

    /* 3. BCAA / EAA */
    if(intense||goal==="lean"||longSession){
      items.push({
        name:"BCAA æ”¯éˆèƒºåŸºé…¸",
        icon:"ğŸ’§",bgColor:"#d1fae5",
        dose:"è¨“ç·´ä¸­ 5-10gï¼Œæº¶æ–¼æ°´ä¸­é£²ç”¨",
        reason:goal==="lean"?"æ¸›è„‚æœŸä¿è­·è‚Œè‚‰æµå¤±ï¼Œå»¶ç·©è¨“ç·´ç–²å‹":"æ¸›å°‘è‚Œè‚‰åˆ†è§£ï¼ŒåŠ é€Ÿè¨“ç·´å¾Œæ¢å¾©",
        priority:"essential",priorityLabel:"å¿…å‚™",
        score:90
      });
    }

    /* 4. Electrolytes */
    if(intense||longSession||sport==="cardio"||sport==="mixed"){
      items.push({
        name:"é›»è§£è³ªè£œå……é£²",
        icon:"ğŸ’¦",bgColor:"#e0f2fe",
        dose:"è¨“ç·´ä¸­ 500-1000mlï¼ˆå«éˆ‰ã€é‰€ã€é‚ï¼‰",
        reason:"è£œå……å¤§é‡æµæ±—æµå¤±çš„é›»è§£è³ªï¼Œç¶­æŒè‚Œè‚‰èˆ‡ç¥ç¶“åŠŸèƒ½",
        priority:longSession?"essential":"recommended",
        priorityLabel:longSession?"å¿…å‚™":"æ¨è–¦",
        score:longSession?88:75
      });
    }

    /* 5. Glutamine â€” recovery issues */
    if(issues.indexOf("recovery")!==-1||intense){
      items.push({
        name:"éº©é†¯èƒºé…¸ (Glutamine)",
        icon:"ğŸ”¬",bgColor:"#fce7f3",
        dose:"è¨“ç·´å¾Œ 5-10g",
        reason:"æ”¯æŒå…ç–«ç³»çµ±ï¼ŒåŠ é€Ÿè‚Œè‚‰ä¿®å¾©èˆ‡è…¸é“å¥åº·",
        priority:"recommended",priorityLabel:"æ¨è–¦",
        score:72
      });
    }

    /* 6. Fish Oil */
    if(issues.indexOf("joint")!==-1||issues.indexOf("recovery")!==-1||intense){
      items.push({
        name:"é«˜æ¿ƒåº¦é­šæ²¹ (Omega-3)",
        icon:"ğŸŸ",bgColor:"#dbeafe",
        dose:"æ¯æ—¥ 2-3g EPA+DHA",
        reason:issues.indexOf("joint")!==-1?"ç·©è§£é—œç¯€ç™¼ç‚èˆ‡ä¸é©ï¼Œä¿ƒé€²è¨“ç·´æ¢å¾©":"æŠ—ç™¼ç‚ã€ä¿ƒé€²è‚Œè‚‰æ¢å¾©ã€æ”¯æŒå¿ƒè¡€ç®¡å¥åº·",
        priority:issues.indexOf("joint")!==-1?"essential":"recommended",
        priorityLabel:issues.indexOf("joint")!==-1?"å¿…å‚™":"æ¨è–¦",
        score:issues.indexOf("joint")!==-1?85:68
      });
    }

    /* 7. Pre-workout (performance focus) */
    if(goal==="performance"||(intense&&longSession)){
      items.push({
        name:"è¨“ç·´å‰è£œå…… (Pre-Workout)",
        icon:"ğŸš€",bgColor:"#fef3c7",
        dose:"è¨“ç·´å‰ 20-30 åˆ†é˜æœç”¨ 1 ä»½",
        reason:"å«å’–å•¡å› èˆ‡Î²-ä¸™æ°¨é…¸ï¼Œæå‡è¨“ç·´å°ˆæ³¨åº¦èˆ‡è€åŠ›",
        priority:"recommended",priorityLabel:"æ¨è–¦",
        score:65
      });
    }

    /* 8. Magnesium â€” sleep or fatigue */
    if(issues.indexOf("sleep")!==-1||issues.indexOf("fatigue")!==-1){
      items.push({
        name:"é‚ (Magnesium)",
        icon:"ğŸŒ™",bgColor:"#ede9fe",
        dose:"ç¡å‰ 200-400mgï¼ˆå»ºè­°ç”˜èƒºé…¸é‚ï¼‰",
        reason:issues.indexOf("sleep")!==-1?"æ”¹å–„ç¡çœ å“è³ªï¼Œå¹«åŠ©è‚Œè‚‰æ”¾é¬†":"æ¸›è¼•ç–²å‹æ„Ÿï¼Œæ”¯æŒèƒ½é‡ä»£è¬èˆ‡è‚Œè‚‰åŠŸèƒ½",
        priority:"recommended",priorityLabel:"æ¨è–¦",
        score:70
      });
    }

    /* 9. Vitamin D */
    items.push({
      name:"ç¶­ç”Ÿç´  D3",
      icon:"â˜€ï¸",bgColor:"#fef9c3",
      dose:"æ¯æ—¥ 2000-4000 IU",
      reason:"å¤šæ•¸äººä¸è¶³ï¼Œå½±éŸ¿éª¨éª¼å¥åº·ã€è‚Œè‚‰åŠŸèƒ½èˆ‡å…ç–«åŠ›",
      priority:"recommended",priorityLabel:"æ¨è–¦",
      score:60
    });

    /* 10. Caffeine as standalone for fatigue */
    if(issues.indexOf("fatigue")!==-1&&goal!=="performance"){
      items.push({
        name:"å’–å•¡å› éŒ ",
        icon:"â˜•",bgColor:"#fef3c7",
        dose:"è¨“ç·´å‰ 100-200mg",
        reason:"æå‡ç²¾ç¥å°ˆæ³¨åº¦ï¼Œå°æŠ—ç–²å‹æ„Ÿ",
        priority:"optional",priorityLabel:"å¯é¸",
        score:50
      });
    }

    /* Sort by score descending */
    items.sort(function(a,b){return b.score-a.score});
    return items;
  }

  /* ====== Restart ====== */
  window.restart=function(){
    document.getElementById("step4").classList.add("nc-hidden");
    document.getElementById("step1").classList.remove("nc-hidden");
    currentStep=1;
    updateProgress();
    /* Reset form */
    document.getElementById("age").value="";
    document.getElementById("weight").value="";
    document.getElementById("height").value="";
  };

  /* ====== Checkbox toggle styling ====== */
  document.querySelectorAll('.nc-toggle-group input[type="checkbox"]').forEach(function(cb){
    cb.addEventListener("change",function(){
      /* Toggle visual via the existing :checked CSS works for checkboxes too */
    });
  });

})();
</script>
</body>
</html>
