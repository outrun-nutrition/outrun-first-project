<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Â†ÖÂøÉÂ†±ÂÉπÊé°Ë≥º">
<meta name="theme-color" content="#2F2F2F">
<meta name="mobile-web-app-capable" content="yes">
<title>Â†ÖÂøÉÂ†±ÂÉπ/Êé°Ë≥º ‚Äî Outrun Nutrition</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
/* ==================== Âü∫Á§éË®≠ÂÆö ==================== */
:root {
  --black: #2F2F2F;
  --orange: #ED5D2B;
  --orange-hover: #d14e1f;
  --blue: #145DDD;
  --dark-gray: #3A3A3A;
  --card-gray: #444444;
  --text-primary: #E0E0E0;
  --text-secondary: #A0A0A0;
  --text-dim: #707070;
  --danger: #E53935;
  --success: #43A047;
  --warning: #FB8C00;
  --radius-lg: 12px;
  --radius-sm: 6px;
  --radius-xs: 4px;
  --font-zh: 'Noto Sans TC', sans-serif;
  --font-en: 'Montserrat', sans-serif;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; }
body {
  font-family: var(--font-zh);
  background: var(--black);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* ==================== È†ÇÈÉ®Â∞éË¶Ω ==================== */
.top-bar {
  background: var(--dark-gray);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid rgba(237, 93, 43, 0.3);
}
.brand { display: flex; align-items: center; gap: 10px; }
.brand-icon {
  width: 32px; height: 32px;
  background: var(--orange);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
}
.brand-name {
  font-family: var(--font-en);
  font-weight: 700; font-size: 14px;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--orange);
}
.brand-sub { font-size: 11px; color: var(--text-secondary); }
.sync-status {
  display: flex; align-items: center; gap: 6px;
  font-size: 12px; color: var(--text-secondary);
}
.sync-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--success);
}
.sync-dot.offline { background: var(--warning); }

/* ==================== ÂàÜÈ†ÅÂ∞éË¶Ω ==================== */
.tab-nav {
  display: flex;
  background: var(--dark-gray);
  border-bottom: 1px solid rgba(255,255,255,0.05);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.tab-btn {
  flex: 1; min-width: 70px;
  padding: 10px 6px;
  background: none; border: none;
  color: var(--text-secondary);
  font-family: var(--font-zh);
  font-size: 12px; font-weight: 500;
  cursor: pointer; text-align: center;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  white-space: nowrap;
}
.tab-btn.active { color: var(--orange); border-bottom-color: var(--orange); }
.tab-btn:hover { color: var(--text-primary); }
.tab-icon { font-size: 16px; display: block; margin-bottom: 2px; }

/* ==================== ‰∏ªÂÖßÂÆπÂçÄ ==================== */
.main-content { max-width: 640px; margin: 0 auto; padding: 16px; }
.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ==================== Âç°ÁâáÂÖÉ‰ª∂ ==================== */
.card {
  background: var(--dark-gray);
  border-radius: var(--radius-lg);
  padding: 20px; margin-bottom: 16px;
}
.card-header {
  display: flex; align-items: center;
  justify-content: space-between; margin-bottom: 16px;
}
.card-title { font-size: 15px; font-weight: 700; color: var(--text-primary); }
.card-badge {
  font-family: var(--font-en);
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.08em;
  padding: 3px 8px; border-radius: var(--radius-xs);
  background: rgba(237, 93, 43, 0.15); color: var(--orange);
}

/* ==================== Ë°®ÂñÆÂÖÉ‰ª∂ ==================== */
.form-group { margin-bottom: 16px; }
.form-label {
  display: block; font-size: 13px; font-weight: 500;
  color: var(--text-secondary); margin-bottom: 6px;
}
.form-label .required { color: var(--orange); margin-left: 2px; }
.form-input, .form-select, .form-textarea {
  width: 100%; padding: 10px 12px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: var(--font-zh); font-size: 15px;
  transition: border-color 0.2s;
  -webkit-appearance: none;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none; border-color: var(--orange);
  background: rgba(237, 93, 43, 0.05);
}
.form-input::placeholder { color: var(--text-dim); }
.form-select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23A0A0A0' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 36px;
  color-scheme: dark;
}
.form-select option { background: var(--dark-gray); color: var(--text-primary); }
.form-textarea { resize: vertical; min-height: 60px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

/* ==================== ÊåâÈàï ==================== */
.btn {
  display: inline-flex; align-items: center; justify-content: center;
  gap: 6px; padding: 12px 24px; border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-zh); font-size: 14px; font-weight: 600;
  cursor: pointer; transition: all 0.2s; text-decoration: none;
}
.btn-primary {
  background: var(--orange); color: #fff;
  width: 100%; padding: 14px; font-size: 16px;
}
.btn-primary:hover { background: var(--orange-hover); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-secondary { background: rgba(255,255,255,0.08); color: var(--text-primary); }
.btn-secondary:hover { background: rgba(255,255,255,0.12); }
.btn-outline {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.15);
  color: var(--text-primary);
}
.btn-outline:hover { border-color: var(--orange); color: var(--orange); }
.btn-danger { background: rgba(229, 57, 53, 0.15); color: var(--danger); }
.btn-danger:hover { background: rgba(229, 57, 53, 0.25); }
.btn-sm { padding: 6px 12px; font-size: 12px; }
.btn-group { display: flex; gap: 8px; margin-top: 16px; }

/* ==================== ÊòéÁ¥∞Ë°åË°®Ê†º ==================== */
.line-items { margin-bottom: 16px; }
.line-item {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: var(--radius-sm);
  padding: 12px; margin-bottom: 8px;
  position: relative;
}
.line-item-header {
  display: flex; justify-content: space-between;
  align-items: center; margin-bottom: 8px;
}
.line-item-num {
  font-family: var(--font-en); font-size: 11px;
  font-weight: 600; color: var(--orange);
}
.line-item-remove {
  width: 24px; height: 24px; border: none;
  background: rgba(229, 57, 53, 0.1);
  border-radius: 50%; color: var(--danger);
  font-size: 14px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.line-item-remove:hover { background: rgba(229, 57, 53, 0.25); }
.line-item .form-group { margin-bottom: 8px; }
.line-item .form-label { font-size: 11px; margin-bottom: 4px; }
.line-item .form-input, .line-item .form-select {
  padding: 8px 10px; font-size: 13px;
}
.line-item-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.line-item-subtotal {
  text-align: right; font-family: var(--font-en);
  font-size: 14px; font-weight: 600; color: var(--orange);
  padding-top: 4px;
}
.add-line-btn {
  width: 100%; padding: 10px; border: 2px dashed rgba(255,255,255,0.12);
  border-radius: var(--radius-sm); background: none;
  color: var(--text-secondary); font-family: var(--font-zh);
  font-size: 13px; cursor: pointer; transition: all 0.2s;
}
.add-line-btn:hover {
  border-color: var(--orange); color: var(--orange);
  background: rgba(237, 93, 43, 0.05);
}

/* ==================== ÈáëÈ°çÂåØÁ∏Ω ==================== */
.amount-summary {
  border-top: 1px solid rgba(255,255,255,0.08);
  padding-top: 12px; margin-top: 8px;
}
.amount-row {
  display: flex; justify-content: space-between;
  align-items: center; padding: 6px 0;
  font-size: 14px;
}
.amount-row .label { color: var(--text-secondary); }
.amount-row .value {
  font-family: var(--font-en); font-weight: 600;
}
.amount-row.total {
  border-top: 2px solid var(--orange);
  padding-top: 10px; margin-top: 6px;
  font-size: 18px;
}
.amount-row.total .label { color: var(--text-primary); font-weight: 700; }
.amount-row.total .value { color: var(--orange); font-weight: 700; }
.amount-row.discount .value { color: var(--success); }

/* ==================== ÂàóË°®Âç°Áâá ==================== */
.doc-card {
  background: var(--dark-gray);
  border-radius: var(--radius-lg);
  padding: 16px; margin-bottom: 10px;
  cursor: pointer; transition: all 0.2s;
  border: 1px solid transparent;
}
.doc-card:hover { border-color: rgba(237, 93, 43, 0.3); }
.doc-card-top {
  display: flex; justify-content: space-between;
  align-items: flex-start; margin-bottom: 8px;
}
.doc-card-id {
  font-family: var(--font-en); font-size: 13px;
  font-weight: 600; color: var(--text-primary);
}
.doc-card-date { font-size: 12px; color: var(--text-dim); }
.doc-card-mid {
  display: flex; justify-content: space-between;
  align-items: center;
}
.doc-card-name { font-size: 14px; font-weight: 500; }
.doc-card-amount {
  font-family: var(--font-en); font-size: 16px;
  font-weight: 700; color: var(--orange);
}
.doc-card-bottom {
  display: flex; justify-content: space-between;
  align-items: center; margin-top: 8px;
}
.doc-card-recorder { font-size: 11px; color: var(--text-dim); }

/* ==================== ÁãÄÊÖãÊ®ôÁ±§ ==================== */
.status-tag {
  display: inline-block; padding: 2px 8px;
  border-radius: var(--radius-xs);
  font-size: 11px; font-weight: 600;
}
.status-draft { background: rgba(160,160,160,0.15); color: var(--text-secondary); }
.status-sent { background: rgba(20,93,221,0.15); color: var(--blue); }
.status-accepted { background: rgba(67,160,71,0.15); color: var(--success); }
.status-rejected { background: rgba(229,57,53,0.15); color: var(--danger); }
.status-pending { background: rgba(251,140,0,0.15); color: var(--warning); }
.status-confirmed { background: rgba(20,93,221,0.15); color: var(--blue); }
.status-delivered { background: rgba(67,160,71,0.15); color: var(--success); }
.status-invoiced { background: rgba(237,93,43,0.15); color: var(--orange); }
.status-paid { background: rgba(67,160,71,0.25); color: var(--success); }

/* ==================== ÊêúÂ∞ãÂàó ==================== */
.search-bar {
  display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;
}
.search-bar input {
  flex: 1; min-width: 120px; padding: 8px 12px;
  background: var(--dark-gray);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: var(--font-zh); font-size: 13px;
}
.search-bar input:focus { outline: none; border-color: var(--orange); }
.search-bar input::placeholder { color: var(--text-dim); }
.search-bar select {
  padding: 8px 10px;
  background: var(--dark-gray);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: var(--font-zh); font-size: 13px;
  color-scheme: dark;
}

/* ==================== Êúà‰ªΩÈÅ∏ÊìáÂô® ==================== */
.month-nav {
  display: flex; align-items: center;
  justify-content: center; gap: 16px;
  margin-bottom: 16px;
}
.month-nav button {
  width: 36px; height: 36px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 50%; color: var(--text-primary);
  font-size: 16px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.month-nav button:hover { border-color: var(--orange); color: var(--orange); }
.month-nav .month-label {
  font-family: var(--font-en); font-size: 16px;
  font-weight: 600; min-width: 120px; text-align: center;
}

/* ==================== Áµ±Ë®àÂç°Áâá ==================== */
.stats-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 10px; margin-bottom: 16px;
}
.stat-card {
  background: var(--dark-gray);
  border-radius: var(--radius-lg);
  padding: 16px; text-align: center;
}
.stat-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
.stat-value {
  font-family: var(--font-en); font-size: 22px;
  font-weight: 700; color: var(--text-primary);
}
.stat-value.orange { color: var(--orange); }

/* ==================== Ë∂®Âã¢Âúñ ==================== */
.trend-chart {
  display: flex; align-items: flex-end;
  gap: 4px; height: 120px; padding: 8px 0;
}
.trend-bar-wrap {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; height: 100%;
}
.trend-bar {
  width: 100%; max-width: 28px;
  background: var(--orange);
  border-radius: 3px 3px 0 0;
  transition: height 0.3s; min-height: 2px;
}
.trend-bar.blue { background: var(--blue); }
.trend-label {
  font-size: 10px; color: var(--text-dim);
  margin-top: 4px; font-family: var(--font-en);
}
.trend-value {
  font-size: 9px; color: var(--text-secondary);
  margin-bottom: 4px; font-family: var(--font-en);
  white-space: nowrap;
}
.trend-summary {
  display: flex; justify-content: space-between;
  padding: 8px 0; border-top: 1px solid rgba(255,255,255,0.08);
  margin-top: 8px; font-size: 12px; color: var(--text-secondary);
}
.trend-summary strong { color: var(--text-primary); font-family: var(--font-en); }

/* ==================== Modal ==================== */
.modal-overlay {
  display: none; position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  z-index: 200; align-items: flex-end;
  justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal-box {
  background: var(--black);
  border-radius: 16px 16px 0 0;
  width: 100%; max-width: 640px;
  max-height: 85vh; overflow-y: auto;
  padding: 20px; animation: slideUp 0.25s ease;
}
.modal-box h3 { font-size: 16px; margin-bottom: 16px; }
.modal-close {
  float: right; background: none; border: none;
  color: var(--text-dim); font-size: 24px;
  cursor: pointer; padding: 0 4px;
}
.modal-close:hover { color: var(--text-primary); }

/* ==================== Toast ==================== */
.toast {
  position: fixed; top: 16px; left: 50%;
  transform: translateX(-50%);
  background: var(--dark-gray);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  padding: 12px 20px; font-size: 13px;
  z-index: 999; animation: fadeSlideIn 0.3s ease;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  max-width: 90%; text-align: center;
}
.toast.success { border-color: var(--success); color: var(--success); }
.toast.error { border-color: var(--danger); color: var(--danger); }
.toast.info { border-color: var(--blue); color: var(--blue); }

/* ==================== Áî¢ÂìÅÁõÆÈåÑÁÆ°ÁêÜ ==================== */
.product-list-item {
  display: flex; justify-content: space-between;
  align-items: center; padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}
.product-list-item:last-child { border-bottom: none; }
.product-info { flex: 1; }
.product-name { font-size: 14px; font-weight: 500; }
.product-spec { font-size: 12px; color: var(--text-secondary); }
.product-price {
  font-family: var(--font-en); font-size: 14px;
  font-weight: 600; color: var(--orange); margin-right: 12px;
}

/* ==================== ÂãïÁï´ ==================== */
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateX(-50%) translateY(-12px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}
@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

/* ==================== ÈüøÊáâÂºè ==================== */
@media (max-width: 380px) {
  .tab-btn { font-size: 11px; padding: 8px 4px; }
  .tab-icon { font-size: 14px; }
  .form-row, .line-item-row { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- ==================== È†ÇÈÉ®ÂìÅÁâåÂàó ==================== -->
<div class="top-bar">
  <div class="brand">
    <div class="brand-icon">ü•ú</div>
    <div>
      <div class="brand-name">Outrun Nutrition</div>
      <div class="brand-sub">Â†±ÂÉπ / Êé°Ë≥ºÁÆ°ÁêÜ</div>
    </div>
  </div>
  <div class="sync-status">
    <div class="sync-dot" id="syncDot"></div>
    <span id="syncLabel">Êú¨Ê©ü</span>
  </div>
</div>

<!-- ==================== ÂàÜÈ†ÅÂ∞éË¶Ω ==================== -->
<nav class="tab-nav">
  <button class="tab-btn active" onclick="switchTab('quote')">
    <span class="tab-icon">üìù</span>Êñ∞Â¢ûÂ†±ÂÉπ
  </button>
  <button class="tab-btn" onclick="switchTab('po')">
    <span class="tab-icon">üì¶</span>Êñ∞Â¢ûÊé°Ë≥º
  </button>
  <button class="tab-btn" onclick="switchTab('list')">
    <span class="tab-icon">üìã</span>ÂñÆÊìöÂàóË°®
  </button>
  <button class="tab-btn" onclick="switchTab('stats')">
    <span class="tab-icon">üìä</span>Áµ±Ë®à
  </button>
  <button class="tab-btn" onclick="switchTab('settings')">
    <span class="tab-icon">‚öôÔ∏è</span>Ë®≠ÂÆö
  </button>
</nav>

<div class="main-content">

<!-- ==================== Tab 1: Êñ∞Â¢ûÂ†±ÂÉπÂñÆ ==================== -->
<div id="tab-quote" class="tab-panel active">
  <div class="card">
    <div class="card-header">
      <span class="card-title">üìù Â†±ÂÉπÂñÆ</span>
      <span class="card-badge">QUOTATION</span>
    </div>

    <!-- Êó•Êúü -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Â†±ÂÉπÊó•Êúü</label>
        <input type="date" id="quoteDate" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">ÊúâÊïàÊúüÈôê</label>
        <input type="date" id="quoteValidUntil" class="form-input">
      </div>
    </div>

    <!-- ÂÆ¢Êà∂Ë≥áË®ä -->
    <div class="form-group">
      <label class="form-label">ÂÆ¢Êà∂ÂêçÁ®± <span class="required">*</span></label>
      <input type="text" id="quoteCustName" class="form-input" placeholder="ÂÖ¨Âè∏ÊàñÂÄã‰∫∫ÂêçÁ®±">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ËÅØÁπ´‰∫∫</label>
        <input type="text" id="quoteCustContact" class="form-input" placeholder="ÂßìÂêç">
      </div>
      <div class="form-group">
        <label class="form-label">ÈõªË©±</label>
        <input type="tel" id="quoteCustPhone" class="form-input" placeholder="09xx-xxx-xxx">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" id="quoteCustEmail" class="form-input" placeholder="email@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">Âú∞ÂùÄ</label>
        <input type="text" id="quoteCustAddr" class="form-input" placeholder="ÈÄÅË≤®/ÈÄöË®äÂú∞ÂùÄ">
      </div>
    </div>
  </div>

  <!-- ÂïÜÂìÅÊòéÁ¥∞ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">ÂïÜÂìÅÊòéÁ¥∞</span>
      <span class="card-badge" id="quoteItemCount">0 ITEMS</span>
    </div>
    <div id="quoteLineItems" class="line-items"></div>
    <button class="add-line-btn" onclick="addQuoteLineItem()">+ Êñ∞Â¢ûÂìÅÈ†Ö</button>

    <!-- ÈáëÈ°çÂåØÁ∏Ω -->
    <div class="amount-summary">
      <div class="amount-row">
        <span class="label">Â∞èË®à</span>
        <span class="value" id="quoteSubtotal">NTD 0</span>
      </div>
      <div class="form-row" style="margin:8px 0">
        <div class="form-group" style="margin:0">
          <select id="quoteDiscountType" class="form-select" onchange="calcQuoteTotals()" style="font-size:13px;padding:8px">
            <option value="percent">ÊäòÊâ£ %</option>
            <option value="fixed">ÊäòÊâ£ÈáëÈ°ç</option>
          </select>
        </div>
        <div class="form-group" style="margin:0">
          <input type="number" id="quoteDiscountValue" class="form-input" value="0" min="0" oninput="calcQuoteTotals()" style="font-size:13px;padding:8px">
        </div>
      </div>
      <div class="amount-row discount">
        <span class="label">ÊäòÊâ£</span>
        <span class="value" id="quoteDiscountAmount">-NTD 0</span>
      </div>
      <div class="form-group" style="margin:8px 0 4px">
        <select id="quoteTaxType" class="form-select" onchange="calcQuoteTotals()" style="font-size:13px;padding:8px">
          <option value="excluded">Á®ÖÂ§ñÂä† (5%)</option>
          <option value="included">Âê´Á®Ö (5%)</option>
          <option value="exempt">ÂÖçÁ®Ö</option>
        </select>
      </div>
      <div class="amount-row">
        <span class="label" id="quoteTaxLabel">Á®ÖÈ°ç (5%)</span>
        <span class="value" id="quoteTaxAmount">NTD 0</span>
      </div>
      <div class="amount-row total">
        <span class="label">Á∏ΩË®à</span>
        <span class="value" id="quoteTotal">NTD 0</span>
      </div>
    </div>
  </div>

  <!-- ÂÇôË®ª -->
  <div class="card">
    <div class="form-group" style="margin:0">
      <label class="form-label">ÂÇôË®ª</label>
      <textarea id="quoteNotes" class="form-textarea" placeholder="‰ªòÊ¨æÊ¢ù‰ª∂„ÄÅ‰∫§Ë≤®ÊñπÂºèÁ≠âË£úÂÖÖË™™Êòé"></textarea>
    </div>
  </div>

  <div class="btn-group">
    <button class="btn btn-primary" onclick="saveQuotation()" style="flex:2">ÂÑ≤Â≠òÂ†±ÂÉπÂñÆ</button>
    <button class="btn btn-secondary" onclick="saveQuotation(true)" style="flex:1">Â≠òÊ™î+PDF</button>
  </div>
</div>

<!-- ==================== Tab 2: Êñ∞Â¢ûÊé°Ë≥ºÂñÆ ==================== -->
<div id="tab-po" class="tab-panel">
  <div class="card">
    <div class="card-header">
      <span class="card-title">üì¶ Êé°Ë≥ºÂñÆ</span>
      <span class="card-badge">PURCHASE ORDER</span>
    </div>

    <div class="form-group">
      <label class="form-label">Êé°Ë≥ºÊó•Êúü</label>
      <input type="date" id="poDate" class="form-input">
    </div>

    <!-- ‰æõÊáâÂïÜ -->
    <div class="form-group">
      <label class="form-label">‰æõÊáâÂïÜÂêçÁ®± <span class="required">*</span></label>
      <input type="text" id="poVendorName" class="form-input" placeholder="‰æõÊáâÂïÜÂêçÁ®±">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ËÅØÁπ´‰∫∫</label>
        <input type="text" id="poVendorContact" class="form-input" placeholder="ÂßìÂêç">
      </div>
      <div class="form-group">
        <label class="form-label">ÈõªË©±</label>
        <input type="tel" id="poVendorPhone" class="form-input" placeholder="ÈõªË©±">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" id="poVendorEmail" class="form-input" placeholder="email@example.com">
    </div>
  </div>

  <!-- Êé°Ë≥ºÊòéÁ¥∞ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Êé°Ë≥ºÊòéÁ¥∞</span>
      <span class="card-badge" id="poItemCount">0 ITEMS</span>
    </div>
    <div id="poLineItems" class="line-items"></div>
    <button class="add-line-btn" onclick="addPOLineItem()">+ Êñ∞Â¢ûÂìÅÈ†Ö</button>

    <div class="amount-summary">
      <div class="amount-row">
        <span class="label">Â∞èË®à</span>
        <span class="value" id="poSubtotal">NTD 0</span>
      </div>
      <div class="form-group" style="margin:8px 0 4px">
        <select id="poTaxType" class="form-select" onchange="calcPOTotals()" style="font-size:13px;padding:8px">
          <option value="excluded">Á®ÖÂ§ñÂä† (5%)</option>
          <option value="included">Âê´Á®Ö (5%)</option>
          <option value="exempt">ÂÖçÁ®Ö</option>
        </select>
      </div>
      <div class="amount-row">
        <span class="label" id="poTaxLabel">Á®ÖÈ°ç (5%)</span>
        <span class="value" id="poTaxAmount">NTD 0</span>
      </div>
      <div class="amount-row total">
        <span class="label">Á∏ΩË®à</span>
        <span class="value" id="poTotal">NTD 0</span>
      </div>
    </div>
  </div>

  <!-- ‰∫§Ë≤®Ëàá‰ªòÊ¨æ -->
  <div class="card">
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">È†êÊúü‰∫§Ë≤®Êó•</label>
        <input type="date" id="poDeliveryDate" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">‰ªòÊ¨æÊ¢ù‰ª∂</label>
        <select id="poPaymentTerms" class="form-select">
          <option value="ÊúàÁµê30Â§©">ÊúàÁµê30Â§©</option>
          <option value="ÊúàÁµê60Â§©">ÊúàÁµê60Â§©</option>
          <option value="Ë≤®Âà∞‰ªòÊ¨æ">Ë≤®Âà∞‰ªòÊ¨æ</option>
          <option value="È†ê‰ªòÊ¨æ">È†ê‰ªòÊ¨æ</option>
          <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">ÈóúËÅØÂ†±ÂÉπÂñÆ</label>
      <select id="poRelatedQuote" class="form-select">
        <option value="">ÔºàÁÑ°Ôºâ</option>
      </select>
    </div>
    <div class="form-group" style="margin:0">
      <label class="form-label">ÂÇôË®ª</label>
      <textarea id="poNotes" class="form-textarea" placeholder="ÁâπÊÆäÈúÄÊ±Ç„ÄÅÊ≥®ÊÑè‰∫ãÈ†Ö"></textarea>
    </div>
  </div>

  <div class="btn-group">
    <button class="btn btn-primary" onclick="savePurchaseOrder()" style="flex:2">ÂÑ≤Â≠òÊé°Ë≥ºÂñÆ</button>
    <button class="btn btn-secondary" onclick="savePurchaseOrder(true)" style="flex:1">Â≠òÊ™î+PDF</button>
  </div>
</div>

<!-- ==================== Tab 3: ÂñÆÊìöÂàóË°® ==================== -->
<div id="tab-list" class="tab-panel">
  <div class="month-nav">
    <button onclick="changeListMonth(-1)">‚óÄ</button>
    <span class="month-label" id="listMonthLabel"></span>
    <button onclick="changeListMonth(1)">‚ñ∂</button>
  </div>

  <div class="search-bar">
    <input type="text" id="listSearch" placeholder="ÊêúÂ∞ãÁ∑®Ëôü„ÄÅÂÆ¢Êà∂„ÄÅ‰æõÊáâÂïÜ" oninput="renderDocList()">
    <select id="listTypeFilter" onchange="renderDocList()">
      <option value="">ÂÖ®ÈÉ®</option>
      <option value="quotation">Â†±ÂÉπÂñÆ</option>
      <option value="po">Êé°Ë≥ºÂñÆ</option>
    </select>
  </div>

  <div id="docListContainer"></div>
  <div id="docListEmpty" style="text-align:center;padding:40px 0;color:var(--text-dim);display:none">
    <div style="font-size:40px;margin-bottom:8px">üìÑ</div>
    <div>Êú¨ÊúàÂ∞öÁÑ°ÂñÆÊìö</div>
  </div>
</div>

<!-- ==================== Tab 4: Áµ±Ë®à ==================== -->
<div id="tab-stats" class="tab-panel">
  <div class="month-nav">
    <button onclick="changeStatsMonth(-1)">‚óÄ</button>
    <span class="month-label" id="statsMonthLabel"></span>
    <button onclick="changeStatsMonth(1)">‚ñ∂</button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Â†±ÂÉπÂñÆÊï∏</div>
      <div class="stat-value" id="statQuoteCount">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Êé°Ë≥ºÂñÆÊï∏</div>
      <div class="stat-value" id="statPOCount">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Â†±ÂÉπÁ∏ΩÈ°ç</div>
      <div class="stat-value orange" id="statQuoteTotal">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Êé°Ë≥ºÁ∏ΩÈ°ç</div>
      <div class="stat-value orange" id="statPOTotal">0</div>
    </div>
  </div>

  <!-- Â†±ÂÉπÂñÆÁãÄÊÖãÂàÜÂ∏É -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Â†±ÂÉπÂñÆÁãÄÊÖãÂàÜÂ∏É</span>
    </div>
    <div id="quoteStatusDist"></div>
  </div>

  <!-- Âπ¥Â∫¶Ë∂®Âã¢ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Âπ¥Â∫¶Ë∂®Âã¢</span>
      <select id="trendYear" class="form-select" onchange="renderTrend()" style="width:auto;padding:4px 28px 4px 8px;font-size:12px"></select>
    </div>
    <div id="trendChart" class="trend-chart"></div>
    <div id="trendSummary" class="trend-summary"></div>
  </div>
</div>

<!-- ==================== Tab 5: Ë®≠ÂÆö ==================== -->
<div id="tab-settings" class="tab-panel">
  <div class="card">
    <div class="card-header">
      <span class="card-title">‚öôÔ∏è Á≥ªÁµ±Ë®≠ÂÆö</span>
      <span class="card-badge">SETTINGS</span>
    </div>
    <div class="form-group">
      <label class="form-label">Apps Script API Á∂≤ÂùÄ</label>
      <input type="url" id="settingApiUrl" class="form-input" placeholder="https://script.google.com/macros/s/...">
    </div>
    <div class="form-group">
      <label class="form-label">‰ΩøÁî®ËÄÖÂêçÁ®±</label>
      <input type="text" id="settingRecorder" class="form-input" placeholder="‰Ω†ÁöÑÂêçÂ≠ó">
    </div>
  </div>

  <!-- ÂÖ¨Âè∏Ë≥áË®ä -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">ÂÖ¨Âè∏Ë≥áË®äÔºàÁî®Êñº PDFÔºâ</span>
    </div>
    <div class="form-group">
      <label class="form-label">ÂÖ¨Âè∏ÂêçÁ®±Ôºà‰∏≠ÊñáÂìÅÁâåÔºâ</label>
      <input type="text" id="settingCompanyName" class="form-input" value="Â†ÖÂøÉ Outrun Nutrition">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Ê≥ï‰∫∫ÂêçÁ®±</label>
        <input type="text" id="settingLegalName" class="form-input" placeholder="ÁÑ†ÁàæÁëØËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏">
      </div>
      <div class="form-group">
        <label class="form-label">Ëã±ÊñáÂêçÁ®±</label>
        <input type="text" id="settingNameEn" class="form-input" placeholder="Outrun Nutrition Co., Ltd.">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Áµ±‰∏ÄÁ∑®Ëôü</label>
        <input type="text" id="settingTaxId" class="form-input" placeholder="91114185">
      </div>
      <div class="form-group">
        <label class="form-label">ÈõªË©±</label>
        <input type="tel" id="settingCompanyPhone" class="form-input" placeholder="02-xxxx-xxxx">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" id="settingCompanyEmail" class="form-input" placeholder="info@outrun.com">
    </div>
    <div class="form-group">
      <label class="form-label">Âú∞ÂùÄ</label>
      <input type="text" id="settingCompanyAddr" class="form-input" placeholder="ÂÖ¨Âè∏Âú∞ÂùÄ">
    </div>
  </div>

  <!-- Ê•≠Âãô‰ª£Ë°® -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Ê•≠Âãô‰ª£Ë°®ÔºàPDF È°ØÁ§∫Ôºâ</span>
    </div>
    <div class="form-group">
      <label class="form-label">Ê•≠ÂãôÂêçÁ®±</label>
      <input type="text" id="settingSalesName" class="form-input" placeholder="Ê•≠Âãô‰ª£Ë°®ÂßìÂêç">
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ÈõªË©±</label>
        <input type="tel" id="settingSalesPhone" class="form-input" placeholder="0912-345-678">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" id="settingSalesEmail" class="form-input" placeholder="sales@outrun.com">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">LINE ID</label>
      <input type="text" id="settingSalesLine" class="form-input" placeholder="LINE ID ÊàñÈ°ØÁ§∫ÂêçÁ®±">
    </div>
  </div>

  <!-- ÂåØÊ¨æË≥áË®ä -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">ÂåØÊ¨æË≥áË®äÔºàPDF È°ØÁ§∫Ôºâ</span>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ÈäÄË°åÂêçÁ®±</label>
        <input type="text" id="settingBankName" class="form-input" placeholder="ÁéâÂ±±ÈäÄË°å">
      </div>
      <div class="form-group">
        <label class="form-label">ÈäÄË°å‰ª£Á¢º</label>
        <input type="text" id="settingBankCode" class="form-input" placeholder="808">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ÂàÜË°åÂêçÁ®±Ôºà‰ª£Á¢ºÔºâ</label>
        <input type="text" id="settingBankBranch" class="form-input" placeholder="ÂåóÊñ∞ÂàÜË°å (0901)">
      </div>
      <div class="form-group">
        <label class="form-label">Êà∂Âêç</label>
        <input type="text" id="settingBankHolder" class="form-input" placeholder="ÁÑ†ÁàæÁëØËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Â∏≥Ëôü</label>
      <input type="text" id="settingBankAccount" class="form-input" placeholder="0901-9400-22708">
    </div>
  </div>

  <!-- PDF ÂúñÁâá‰∏äÂÇ≥ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">PDF ÂúñÁâáË®≠ÂÆö</span>
    </div>
    <div class="form-group">
      <label class="form-label">ÂÖ¨Âè∏ LogoÔºàÂ∑¶‰∏äËßíÈ°ØÁ§∫Ôºâ</label>
      <div id="logoPreview" style="margin-bottom:8px"></div>
      <input type="file" id="logoUpload" accept="image/*" onchange="handleImageUpload('logo', this)" style="display:none">
      <div class="btn-group">
        <button class="btn btn-outline btn-sm" onclick="document.getElementById('logoUpload').click()" style="flex:1">üì∑ ‰∏äÂÇ≥ Logo</button>
        <button class="btn btn-outline btn-sm" onclick="clearImage('logo')" style="flex:0.5;color:var(--danger)">Ê∏ÖÈô§</button>
      </div>
    </div>
    <div class="form-group" style="margin-top:12px">
      <label class="form-label">ÂÖ¨Âè∏ÁôºÁ•®Á´†ÔºàÂè≥‰∏ãËßíÁ∞ΩÁΩ≤ÂçÄÈ°ØÁ§∫Ôºâ</label>
      <div id="stampPreview" style="margin-bottom:8px"></div>
      <input type="file" id="stampUpload" accept="image/*" onchange="handleImageUpload('stamp', this)" style="display:none">
      <div class="btn-group">
        <button class="btn btn-outline btn-sm" onclick="document.getElementById('stampUpload').click()" style="flex:1">üì∑ ‰∏äÂÇ≥ÁôºÁ•®Á´†</button>
        <button class="btn btn-outline btn-sm" onclick="clearImage('stamp')" style="flex:0.5;color:var(--danger)">Ê∏ÖÈô§</button>
      </div>
    </div>
  </div>

  <!-- PDF ÂÇôË®ªÊ¢ùÊ¨æ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">PDF È†êË®≠ÂÇôË®ªÊ¢ùÊ¨æ</span>
    </div>
    <div class="form-group">
      <label class="form-label">ÂÇôË®ªÊ¢ùÊ¨æÔºàÊØèË°å‰∏ÄÊ¢ùÔºâ</label>
      <textarea id="settingPdfTerms" class="form-input" rows="4" placeholder="1. Êú¨Â†±ÂÉπÂñÆÊúâÊïàÊúüÈôêÁÇ∫ÈñãÁ´ãÊó•Ëµ∑ 30 Â§©„ÄÇ&#10;2. ‰ªòÊ¨æÊñπÂºèÔºöÂåØÊ¨æ„ÄÇ"></textarea>
    </div>
  </div>

  <!-- Áî¢ÂìÅÁõÆÈåÑ -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">Áî¢ÂìÅÁõÆÈåÑ</span>
      <span class="card-badge" id="productCountBadge">0</span>
    </div>
    <div id="productList"></div>
    <div style="border-top:1px solid rgba(255,255,255,0.08);padding-top:12px;margin-top:12px">
      <div class="form-group">
        <label class="form-label">Êñ∞Â¢ûËá™Ë®ÇÁî¢ÂìÅ</label>
        <div class="form-row" style="margin-bottom:8px">
          <input type="text" id="newProdName" class="form-input" placeholder="ÂìÅÂêç" style="font-size:13px;padding:8px">
          <input type="text" id="newProdSpec" class="form-input" placeholder="Ë¶èÊ†º" style="font-size:13px;padding:8px">
        </div>
        <div class="form-row">
          <input type="number" id="newProdPrice" class="form-input" placeholder="ÂîÆÂÉπ" style="font-size:13px;padding:8px">
          <input type="text" id="newProdUnit" class="form-input" placeholder="ÂñÆ‰Ωç(È†êË®≠:ÂÄã)" style="font-size:13px;padding:8px">
        </div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="addCustomProduct()" style="width:100%">+ Êñ∞Â¢ûÁî¢ÂìÅ</button>
    </div>
  </div>

  <button class="btn btn-primary" onclick="saveSettings()">ÂÑ≤Â≠òË®≠ÂÆö</button>
  <div class="btn-group">
    <button class="btn btn-outline btn-sm" onclick="syncToCloud()" style="flex:1">‚òÅÔ∏è Èõ≤Á´ØÂêåÊ≠•</button>
    <button class="btn btn-danger btn-sm" onclick="clearLocalData()" style="flex:1">üóëÔ∏è Ê∏ÖÈô§Êú¨Âú∞Ë≥áÊñô</button>
  </div>
</div>

</div><!-- /main-content -->

<!-- ==================== Modal ==================== -->
<div class="modal-overlay" id="docModal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <div id="modalContent"></div>
  </div>
</div>

<!-- ==================== JavaScript ==================== -->
<script>
// ==================== È†êË®≠Áî¢ÂìÅÁõÆÈåÑ ====================
const DEFAULT_PRODUCTS = [
  { name: 'Áú†ÊòìÂæ© ÈÅãÂãïÊÅ¢Âæ©ËÜ†Âõä', spec: '30Á≤í/ÁΩê', price: 1299, unit: 'ÁΩê' },
  { name: 'ËÉΩÊòìÂæ© ÊÅ¢Âæ©ËõãÁôΩ', spec: 'ÈªëÁ≥ñ‰ªôËçâ 750g/Ë¢ã', price: 1350, unit: 'Ë¢ã' },
  { name: 'ËÉΩÊòìÂæ© ÊÅ¢Âæ©ËõãÁôΩ', spec: 'ÈªëÁ≥ñ‰ªôËçâ 500g/Áõí', price: 950, unit: 'Áõí' },
  { name: 'È£üÂãïÂäõ ÈÅãÂãïÈ´îÊÑüËÜ†Âõä', spec: '30ÂåÖ/Áõí', price: 1299, unit: 'Áõí' },
  { name: 'TEMPO ËÜ†Âõä', spec: '60È°Ü/ÁΩê', price: 1299, unit: 'ÁΩê' },
  { name: 'OARC Â∞àÊ•≠ÁßëÂ≠∏Ë®ìÁ∑¥Ë£úÁµ¶ÁµÑ', spec: 'Èö®ÈÅ∏ÁµÑÂêà', price: 0, unit: 'ÁµÑ' },
];

// ==================== ÁãÄÊÖãÂ∏∏Êï∏ ====================
const QUOTE_STATUSES = ['ËçâÁ®ø', 'Â∑≤ÁôºÈÄÅ', 'Â∑≤Êé•Âèó', 'Â∑≤ÊãíÁµï'];
const PO_STATUSES = ['ÂæÖÁ¢∫Ë™ç', 'Â∑≤Á¢∫Ë™ç', 'Â∑≤‰∫§Ë≤®', 'Â∑≤ÈñãÁ•®', 'Â∑≤ÁµêÊ¨æ'];

const STORAGE_KEYS = {
  QUOTATIONS: 'outrun_po_quotations',
  PURCHASE_ORDERS: 'outrun_po_purchase_orders',
  SETTINGS: 'outrun_po_settings',
  PRODUCTS: 'outrun_po_products',
  PENDING: 'outrun_po_pending',
};

// ==================== È†êË®≠ÂúñÁâá ====================
const DEFAULT_LOGO_BASE64 = 'data:image/png;base64,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';
    const DEFAULT_STAMP_BASE64 = 'data:image/png;base64,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';

// ==================== State ====================
let state = {
  quotations: [],
  purchaseOrders: [],
  products: [],
  pendingSync: [],
  settings: {
    apiUrl: '',
    recorder: '',
    companyInfo: {
      name: 'Â†ÖÂøÉ Outrun Nutrition',
      nameEn: 'Outrun Nutrition Co., Ltd.',
      legalName: 'ÁÑ†ÁàæÁëØËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏',
      phone: '', email: '', address: 'Êñ∞ÂåóÂ∏ÇÊñ∞Â∫óÂçÄËèØËààË°ó46Ëôü1Ê®ì', taxId: '91114185'
    },
    salesRep: { name: '', phone: '', email: '', line: '' },
    bankInfo: { bankName: 'ÁéâÂ±±ÈäÄË°å', bankCode: '808', branch: 'ÂåóÊñ∞ÂàÜË°å (0901)', holder: 'ÁÑ†ÁàæÁëØËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏', account: '0901-9400-22708' },
    logoBase64: '',
    stampBase64: '',
    pdfTerms: '1. Êú¨Â†±ÂÉπÂñÆÊúâÊïàÊúüÈôêÁÇ∫ÈñãÁ´ãÊó•Ëµ∑ 30 Â§©„ÄÇ\n2. ‰ªòÊ¨æÊñπÂºèÔºöÂåØÊ¨æ„ÄÇ\n3. ÂïÜÂìÅ‰∫§Êúü‰æùÂØ¶ÈöõÂ∫´Â≠òÁãÄÊ≥ÅÁÇ∫Ê∫ñ„ÄÇ'
  }
};

// ÂàóË°®/Áµ±Ë®àÁöÑÁï∂ÂâçÊúà‰ªΩ
let listYear, listMonth, statsYear, statsMonth;

// ==================== Â∑•ÂÖ∑ÂáΩÂºè ====================
function numberFormat(n) {
  return Number(n || 0).toLocaleString('en-US');
}

function todayStr() {
  const d = new Date();
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

function addDays(dateStr, days) {
  const d = new Date(dateStr);
  d.setDate(d.getDate() + days);
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

function generateId(prefix) {
  const today = todayStr().replace(/-/g, '');
  const arr = prefix === 'QUOT' ? state.quotations : state.purchaseOrders;
  const todayDocs = arr.filter(d => d.id && d.id.startsWith(prefix + '-' + today));
  const seq = String(todayDocs.length + 1).padStart(3, '0');
  return prefix + '-' + today + '-' + seq;
}

function getStatusClass(status) {
  const map = {
    'ËçâÁ®ø': 'status-draft', 'Â∑≤ÁôºÈÄÅ': 'status-sent',
    'Â∑≤Êé•Âèó': 'status-accepted', 'Â∑≤ÊãíÁµï': 'status-rejected',
    'ÂæÖÁ¢∫Ë™ç': 'status-pending', 'Â∑≤Á¢∫Ë™ç': 'status-confirmed',
    'Â∑≤‰∫§Ë≤®': 'status-delivered', 'Â∑≤ÈñãÁ•®': 'status-invoiced',
    'Â∑≤ÁµêÊ¨æ': 'status-paid',
  };
  return map[status] || 'status-draft';
}

function showToast(msg, type = 'info') {
  const existing = document.querySelector('.toast');
  if (existing) existing.remove();
  const el = document.createElement('div');
  el.className = 'toast ' + type;
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// ==================== ÂàÜÈ†ÅÂàáÊèõ ====================
function switchTab(tab) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  const tabs = ['quote', 'po', 'list', 'stats', 'settings'];
  const idx = tabs.indexOf(tab);
  if (idx >= 0) document.querySelectorAll('.tab-btn')[idx].classList.add('active');

  if (tab === 'list') renderDocList();
  if (tab === 'stats') renderStats();
  if (tab === 'settings') renderSettings();
  if (tab === 'po') populateRelatedQuotes();
}

// ==================== localStorage ====================
function saveState() {
  localStorage.setItem(STORAGE_KEYS.QUOTATIONS, JSON.stringify(state.quotations));
  localStorage.setItem(STORAGE_KEYS.PURCHASE_ORDERS, JSON.stringify(state.purchaseOrders));
  localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(state.settings));
  localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(state.products));
  localStorage.setItem(STORAGE_KEYS.PENDING, JSON.stringify(state.pendingSync));
}

function loadState() {
  try {
    const q = localStorage.getItem(STORAGE_KEYS.QUOTATIONS);
    if (q) state.quotations = JSON.parse(q);
    const p = localStorage.getItem(STORAGE_KEYS.PURCHASE_ORDERS);
    if (p) state.purchaseOrders = JSON.parse(p);
    const s = localStorage.getItem(STORAGE_KEYS.SETTINGS);
    if (s) state.settings = { ...state.settings, ...JSON.parse(s) };
    const pr = localStorage.getItem(STORAGE_KEYS.PRODUCTS);
    if (pr) state.products = JSON.parse(pr);
    else state.products = [...DEFAULT_PRODUCTS];
    const pn = localStorage.getItem(STORAGE_KEYS.PENDING);
    if (pn) state.pendingSync = JSON.parse(pn);
  } catch (e) {
    console.error('loadState error', e);
    state.products = [...DEFAULT_PRODUCTS];
  }
  // Logo È†êË®≠ÂÄºÔºöËã• localStorage ‰∏≠ÁÑ°Ëá™Ë®Ç LogoÔºå‰ΩøÁî®ÂÖßÂª∫È†êË®≠
  if (!state.settings.logoBase64) {
    state.settings.logoBase64 = DEFAULT_LOGO_BASE64;
  }
  // ÁôºÁ•®Á´†È†êË®≠ÂÄºÔºöËã• localStorage ‰∏≠ÁÑ°Ëá™Ë®ÇÁôºÁ•®Á´†Ôºå‰ΩøÁî®ÂÖßÂª∫È†êË®≠
  if (!state.settings.stampBase64) {
    state.settings.stampBase64 = DEFAULT_STAMP_BASE64;
  }
  // Á¢∫‰øùËàäÁâà localStorage ‰∏≠Áº∫Â∞ëÁöÑÊ¨Ñ‰ΩçÁî®È†êË®≠ÂÄºÂ°´ÂÖÖ
  if (!state.settings.bankInfo) state.settings.bankInfo = {};
  if (!state.settings.bankInfo.branch) state.settings.bankInfo.branch = 'ÂåóÊñ∞ÂàÜË°å (0901)';
  if (!state.settings.bankInfo.holder) state.settings.bankInfo.holder = 'ÁÑ†ÁàæÁëØËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏';
}

// ==================== Â†±ÂÉπÂñÆÊòéÁ¥∞Ë°å ====================
let quoteLineCounter = 0;

function addQuoteLineItem(data) {
  quoteLineCounter++;
  const n = quoteLineCounter;
  const container = document.getElementById('quoteLineItems');

  const productOptions = state.products.map((p, i) =>
    `<option value="${i}" ${data && data.productName === p.name ? 'selected' : ''}>${p.name} (${p.spec})</option>`
  ).join('');

  const div = document.createElement('div');
  div.className = 'line-item';
  div.id = 'quoteLine-' + n;
  div.innerHTML = `
    <div class="line-item-header">
      <span class="line-item-num">#${n}</span>
      <button class="line-item-remove" onclick="removeQuoteLine(${n})">‚úï</button>
    </div>
    <div class="form-group">
      <label class="form-label">Áî¢ÂìÅ</label>
      <select class="form-select" onchange="onQuoteProductSelect(${n}, this.value)" id="qProd-${n}">
        <option value="">‚Äî Ëá™Ë®ÇËº∏ÂÖ• ‚Äî</option>
        ${productOptions}
      </select>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ÂìÅÂêç</label>
        <input type="text" class="form-input" id="qName-${n}" value="${data ? data.productName : ''}" oninput="calcQuoteTotals()">
      </div>
      <div class="form-group">
        <label class="form-label">Ë¶èÊ†º</label>
        <input type="text" class="form-input" id="qSpec-${n}" value="${data ? data.spec : ''}">
      </div>
    </div>
    <div class="line-item-row">
      <div class="form-group">
        <label class="form-label">Êï∏Èáè</label>
        <input type="number" class="form-input" id="qQty-${n}" value="${data ? data.qty : 1}" min="1" oninput="calcQuoteLineSubtotal(${n})">
      </div>
      <div class="form-group">
        <label class="form-label">ÂñÆ‰Ωç</label>
        <input type="text" class="form-input" id="qUnit-${n}" value="${data ? data.unit : 'ÂÄã'}">
      </div>
      <div class="form-group">
        <label class="form-label">ÂñÆÂÉπ</label>
        <input type="number" class="form-input" id="qPrice-${n}" value="${data ? data.unitPrice : 0}" min="0" oninput="calcQuoteLineSubtotal(${n})">
      </div>
    </div>
    <div class="line-item-subtotal" id="qSubtotal-${n}">NTD 0</div>
  `;
  container.appendChild(div);
  calcQuoteLineSubtotal(n);
  updateQuoteItemCount();
}

function onQuoteProductSelect(n, idx) {
  if (idx === '') return;
  const p = state.products[parseInt(idx)];
  if (!p) return;
  document.getElementById('qName-' + n).value = p.name;
  document.getElementById('qSpec-' + n).value = p.spec;
  document.getElementById('qPrice-' + n).value = p.price;
  document.getElementById('qUnit-' + n).value = p.unit;
  calcQuoteLineSubtotal(n);
}

function removeQuoteLine(n) {
  const el = document.getElementById('quoteLine-' + n);
  if (el) el.remove();
  calcQuoteTotals();
  updateQuoteItemCount();
}

function calcQuoteLineSubtotal(n) {
  const qty = Number(document.getElementById('qQty-' + n)?.value) || 0;
  const price = Number(document.getElementById('qPrice-' + n)?.value) || 0;
  const sub = qty * price;
  const el = document.getElementById('qSubtotal-' + n);
  if (el) el.textContent = 'NTD ' + numberFormat(sub);
  calcQuoteTotals();
}

function getQuoteLineItems() {
  const items = [];
  document.querySelectorAll('#quoteLineItems .line-item').forEach(li => {
    const n = li.id.replace('quoteLine-', '');
    const qty = Number(document.getElementById('qQty-' + n)?.value) || 0;
    const unitPrice = Number(document.getElementById('qPrice-' + n)?.value) || 0;
    items.push({
      productName: document.getElementById('qName-' + n)?.value || '',
      spec: document.getElementById('qSpec-' + n)?.value || '',
      qty, unit: document.getElementById('qUnit-' + n)?.value || 'ÂÄã',
      unitPrice, subtotal: qty * unitPrice,
    });
  });
  return items;
}

function updateQuoteItemCount() {
  const count = document.querySelectorAll('#quoteLineItems .line-item').length;
  document.getElementById('quoteItemCount').textContent = count + ' ITEMS';
}

function calcQuoteTotals() {
  const items = getQuoteLineItems();
  const subtotal = items.reduce((s, i) => s + i.subtotal, 0);

  const discType = document.getElementById('quoteDiscountType').value;
  const discVal = Number(document.getElementById('quoteDiscountValue').value) || 0;
  let discAmount = 0;
  if (discType === 'percent') discAmount = Math.round(subtotal * discVal / 100);
  else discAmount = discVal;

  const afterDiscount = subtotal - discAmount;
  const taxType = document.getElementById('quoteTaxType').value;
  let tax = 0, total = 0;
  const taxLabel = document.getElementById('quoteTaxLabel');

  if (taxType === 'excluded') {
    tax = Math.round(afterDiscount * 0.05);
    total = afterDiscount + tax;
    taxLabel.textContent = 'Á®ÖÈ°ç (Â§ñÂä† 5%)';
  } else if (taxType === 'included') {
    tax = Math.round(afterDiscount - afterDiscount / 1.05);
    total = afterDiscount;
    taxLabel.textContent = 'Á®ÖÈ°ç (ÂÖßÂê´ 5%)';
  } else {
    tax = 0;
    total = afterDiscount;
    taxLabel.textContent = 'Á®ÖÈ°ç (ÂÖçÁ®Ö)';
  }

  document.getElementById('quoteSubtotal').textContent = 'NTD ' + numberFormat(subtotal);
  document.getElementById('quoteDiscountAmount').textContent = '-NTD ' + numberFormat(discAmount);
  document.getElementById('quoteTaxAmount').textContent = 'NTD ' + numberFormat(tax);
  document.getElementById('quoteTotal').textContent = 'NTD ' + numberFormat(total);
}

// ==================== Êé°Ë≥ºÂñÆÊòéÁ¥∞Ë°å ====================
let poLineCounter = 0;

function addPOLineItem(data) {
  poLineCounter++;
  const n = poLineCounter;
  const container = document.getElementById('poLineItems');

  const div = document.createElement('div');
  div.className = 'line-item';
  div.id = 'poLine-' + n;
  div.innerHTML = `
    <div class="line-item-header">
      <span class="line-item-num">#${n}</span>
      <button class="line-item-remove" onclick="removePOLine(${n})">‚úï</button>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">ÂìÅÂêç</label>
        <input type="text" class="form-input" id="pName-${n}" value="${data ? data.itemName : ''}" oninput="calcPOTotals()">
      </div>
      <div class="form-group">
        <label class="form-label">Ë¶èÊ†º</label>
        <input type="text" class="form-input" id="pSpec-${n}" value="${data ? data.spec : ''}">
      </div>
    </div>
    <div class="line-item-row">
      <div class="form-group">
        <label class="form-label">Êï∏Èáè</label>
        <input type="number" class="form-input" id="pQty-${n}" value="${data ? data.qty : 1}" min="1" oninput="calcPOLineSubtotal(${n})">
      </div>
      <div class="form-group">
        <label class="form-label">ÂñÆ‰Ωç</label>
        <input type="text" class="form-input" id="pUnit-${n}" value="${data ? data.unit : 'ÂÄã'}">
      </div>
      <div class="form-group">
        <label class="form-label">ÂñÆÂÉπ</label>
        <input type="number" class="form-input" id="pPrice-${n}" value="${data ? data.unitPrice : 0}" min="0" oninput="calcPOLineSubtotal(${n})">
      </div>
    </div>
    <div class="line-item-subtotal" id="pSubtotal-${n}">NTD 0</div>
  `;
  container.appendChild(div);
  calcPOLineSubtotal(n);
  updatePOItemCount();
}

function removePOLine(n) {
  const el = document.getElementById('poLine-' + n);
  if (el) el.remove();
  calcPOTotals();
  updatePOItemCount();
}

function calcPOLineSubtotal(n) {
  const qty = Number(document.getElementById('pQty-' + n)?.value) || 0;
  const price = Number(document.getElementById('pPrice-' + n)?.value) || 0;
  const sub = qty * price;
  const el = document.getElementById('pSubtotal-' + n);
  if (el) el.textContent = 'NTD ' + numberFormat(sub);
  calcPOTotals();
}

function getPOLineItems() {
  const items = [];
  document.querySelectorAll('#poLineItems .line-item').forEach(li => {
    const n = li.id.replace('poLine-', '');
    const qty = Number(document.getElementById('pQty-' + n)?.value) || 0;
    const unitPrice = Number(document.getElementById('pPrice-' + n)?.value) || 0;
    items.push({
      itemName: document.getElementById('pName-' + n)?.value || '',
      spec: document.getElementById('pSpec-' + n)?.value || '',
      qty, unit: document.getElementById('pUnit-' + n)?.value || 'ÂÄã',
      unitPrice, subtotal: qty * unitPrice,
    });
  });
  return items;
}

function updatePOItemCount() {
  const count = document.querySelectorAll('#poLineItems .line-item').length;
  document.getElementById('poItemCount').textContent = count + ' ITEMS';
}

function calcPOTotals() {
  const items = getPOLineItems();
  const subtotal = items.reduce((s, i) => s + i.subtotal, 0);
  const taxType = document.getElementById('poTaxType').value;
  let tax = 0, total = 0;
  const taxLabel = document.getElementById('poTaxLabel');

  if (taxType === 'excluded') {
    tax = Math.round(subtotal * 0.05);
    total = subtotal + tax;
    taxLabel.textContent = 'Á®ÖÈ°ç (Â§ñÂä† 5%)';
  } else if (taxType === 'included') {
    tax = Math.round(subtotal - subtotal / 1.05);
    total = subtotal;
    taxLabel.textContent = 'Á®ÖÈ°ç (ÂÖßÂê´ 5%)';
  } else {
    tax = 0;
    total = subtotal;
    taxLabel.textContent = 'Á®ÖÈ°ç (ÂÖçÁ®Ö)';
  }

  document.getElementById('poSubtotal').textContent = 'NTD ' + numberFormat(subtotal);
  document.getElementById('poTaxAmount').textContent = 'NTD ' + numberFormat(tax);
  document.getElementById('poTotal').textContent = 'NTD ' + numberFormat(total);
}

function populateRelatedQuotes() {
  const sel = document.getElementById('poRelatedQuote');
  sel.innerHTML = '<option value="">ÔºàÁÑ°Ôºâ</option>';
  state.quotations.filter(q => q.status === 'Â∑≤Êé•Âèó').forEach(q => {
    sel.innerHTML += `<option value="${q.id}">${q.id} ‚Äî ${q.customer.name} (NTD ${numberFormat(q.total)})</option>`;
  });
}

// ==================== ÂÑ≤Â≠òÂ†±ÂÉπÂñÆ ====================
function saveQuotation(genPDF = false) {
  const custName = document.getElementById('quoteCustName').value.trim();
  if (!custName) { showToast('Ë´ãËº∏ÂÖ•ÂÆ¢Êà∂ÂêçÁ®±', 'error'); return; }
  const items = getQuoteLineItems();
  if (items.length === 0) { showToast('Ë´ãÊñ∞Â¢ûËá≥Â∞ë‰∏ÄÂÄãÂìÅÈ†Ö', 'error'); return; }

  const subtotal = items.reduce((s, i) => s + i.subtotal, 0);
  const discType = document.getElementById('quoteDiscountType').value;
  const discVal = Number(document.getElementById('quoteDiscountValue').value) || 0;
  let discAmount = discType === 'percent' ? Math.round(subtotal * discVal / 100) : discVal;
  const afterDisc = subtotal - discAmount;
  const taxType = document.getElementById('quoteTaxType').value;
  let tax = 0, total = 0, taxRate = 0;
  if (taxType === 'excluded') { tax = Math.round(afterDisc * 0.05); total = afterDisc + tax; taxRate = 0.05; }
  else if (taxType === 'included') { tax = Math.round(afterDisc - afterDisc / 1.05); total = afterDisc; taxRate = 0.05; }
  else { tax = 0; total = afterDisc; taxRate = 0; }

  const quotation = {
    id: generateId('QUOT'),
    date: document.getElementById('quoteDate').value || todayStr(),
    validUntil: document.getElementById('quoteValidUntil').value || addDays(todayStr(), 30),
    customer: {
      name: custName,
      contact: document.getElementById('quoteCustContact').value.trim(),
      phone: document.getElementById('quoteCustPhone').value.trim(),
      email: document.getElementById('quoteCustEmail').value.trim(),
      address: document.getElementById('quoteCustAddr').value.trim(),
    },
    items, subtotal,
    discountType: discType, discountValue: discVal, discountAmount: discAmount,
    taxType, taxRate, taxAmount: tax, total,
    notes: document.getElementById('quoteNotes').value.trim(),
    status: 'ËçâÁ®ø',
    recorder: state.settings.recorder || 'Êú™Ë®≠ÂÆö',
    createdAt: new Date().toISOString(),
    synced: false,
  };

  state.quotations.push(quotation);
  state.pendingSync.push({ type: 'addQuotation', data: quotation });
  saveState();
  showToast('Â†±ÂÉπÂñÆÂ∑≤ÂÑ≤Â≠òÔºö' + quotation.id, 'success');

  if (genPDF) generateQuotePDF(quotation);
  resetQuoteForm();
}

function resetQuoteForm() {
  document.getElementById('quoteCustName').value = '';
  document.getElementById('quoteCustContact').value = '';
  document.getElementById('quoteCustPhone').value = '';
  document.getElementById('quoteCustEmail').value = '';
  document.getElementById('quoteCustAddr').value = '';
  document.getElementById('quoteNotes').value = '';
  document.getElementById('quoteDiscountValue').value = '0';
  document.getElementById('quoteTaxType').value = 'excluded';
  document.getElementById('quoteLineItems').innerHTML = '';
  quoteLineCounter = 0;
  initDateFields();
  calcQuoteTotals();
  updateQuoteItemCount();
}

// ==================== ÂÑ≤Â≠òÊé°Ë≥ºÂñÆ ====================
function savePurchaseOrder(genPDF = false) {
  const vendorName = document.getElementById('poVendorName').value.trim();
  if (!vendorName) { showToast('Ë´ãËº∏ÂÖ•‰æõÊáâÂïÜÂêçÁ®±', 'error'); return; }
  const items = getPOLineItems();
  if (items.length === 0) { showToast('Ë´ãÊñ∞Â¢ûËá≥Â∞ë‰∏ÄÂÄãÂìÅÈ†Ö', 'error'); return; }

  const subtotal = items.reduce((s, i) => s + i.subtotal, 0);
  const taxType = document.getElementById('poTaxType').value;
  let tax = 0, total = 0, taxRate = 0;
  if (taxType === 'excluded') { tax = Math.round(subtotal * 0.05); total = subtotal + tax; taxRate = 0.05; }
  else if (taxType === 'included') { tax = Math.round(subtotal - subtotal / 1.05); total = subtotal; taxRate = 0.05; }
  else { tax = 0; total = subtotal; taxRate = 0; }

  const po = {
    id: generateId('PO'),
    date: document.getElementById('poDate').value || todayStr(),
    vendor: {
      name: vendorName,
      contact: document.getElementById('poVendorContact').value.trim(),
      phone: document.getElementById('poVendorPhone').value.trim(),
      email: document.getElementById('poVendorEmail').value.trim(),
    },
    items, subtotal,
    taxType, taxRate, taxAmount: tax, total,
    expectedDelivery: document.getElementById('poDeliveryDate').value || '',
    paymentTerms: document.getElementById('poPaymentTerms').value,
    notes: document.getElementById('poNotes').value.trim(),
    status: 'ÂæÖÁ¢∫Ë™ç',
    relatedQuotationId: document.getElementById('poRelatedQuote').value || '',
    recorder: state.settings.recorder || 'Êú™Ë®≠ÂÆö',
    createdAt: new Date().toISOString(),
    synced: false,
  };

  state.purchaseOrders.push(po);
  state.pendingSync.push({ type: 'addPurchaseOrder', data: po });
  saveState();
  showToast('Êé°Ë≥ºÂñÆÂ∑≤ÂÑ≤Â≠òÔºö' + po.id, 'success');

  if (genPDF) generatePOPDF(po);
  resetPOForm();
}

function resetPOForm() {
  document.getElementById('poVendorName').value = '';
  document.getElementById('poVendorContact').value = '';
  document.getElementById('poVendorPhone').value = '';
  document.getElementById('poVendorEmail').value = '';
  document.getElementById('poNotes').value = '';
  document.getElementById('poDeliveryDate').value = '';
  document.getElementById('poRelatedQuote').value = '';
  document.getElementById('poTaxType').value = 'excluded';
  document.getElementById('poLineItems').innerHTML = '';
  poLineCounter = 0;
  initDateFields();
  calcPOTotals();
  updatePOItemCount();
}

// ==================== ÂñÆÊìöÂàóË°® ====================
function changeListMonth(delta) {
  listMonth += delta;
  if (listMonth > 12) { listMonth = 1; listYear++; }
  if (listMonth < 1) { listMonth = 12; listYear--; }
  renderDocList();
}

function renderDocList() {
  document.getElementById('listMonthLabel').textContent = listYear + ' / ' + String(listMonth).padStart(2, '0');
  const keyword = (document.getElementById('listSearch')?.value || '').trim().toLowerCase();
  const typeFilter = document.getElementById('listTypeFilter')?.value || '';

  let docs = [];

  if (typeFilter !== 'po') {
    state.quotations.forEach(q => {
      const d = new Date(q.date);
      if (d.getFullYear() === listYear && (d.getMonth()+1) === listMonth) {
        docs.push({ ...q, _type: 'quotation' });
      }
    });
  }
  if (typeFilter !== 'quotation') {
    state.purchaseOrders.forEach(p => {
      const d = new Date(p.date);
      if (d.getFullYear() === listYear && (d.getMonth()+1) === listMonth) {
        docs.push({ ...p, _type: 'po' });
      }
    });
  }

  if (keyword) {
    docs = docs.filter(d => {
      const haystack = [
        d.id, d._type === 'quotation' ? d.customer?.name : d.vendor?.name,
        d.notes, d.recorder
      ].join(' ').toLowerCase();
      return haystack.includes(keyword);
    });
  }

  docs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

  const container = document.getElementById('docListContainer');
  const empty = document.getElementById('docListEmpty');

  if (docs.length === 0) {
    container.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  container.innerHTML = docs.map(d => {
    const isQuote = d._type === 'quotation';
    const name = isQuote ? (d.customer?.name || '') : (d.vendor?.name || '');
    const typeLabel = isQuote ? 'Â†±ÂÉπ' : 'Êé°Ë≥º';
    return `
      <div class="doc-card" onclick="showDocDetail('${d._type}','${d.id}')">
        <div class="doc-card-top">
          <span class="doc-card-id">${d.id}</span>
          <span class="doc-card-date">${d.date}</span>
        </div>
        <div class="doc-card-mid">
          <span class="doc-card-name">${typeLabel}ÔΩú${name}</span>
          <span class="doc-card-amount">NTD ${numberFormat(d.total)}</span>
        </div>
        <div class="doc-card-bottom">
          <span class="doc-card-recorder">${d.recorder || ''}</span>
          <span class="status-tag ${getStatusClass(d.status)}">${d.status}</span>
        </div>
      </div>
    `;
  }).join('');
}

// ==================== ÂñÆÊìöË©≥ÊÉÖ Modal ====================
function showDocDetail(type, id) {
  const doc = type === 'quotation'
    ? state.quotations.find(q => q.id === id)
    : state.purchaseOrders.find(p => p.id === id);
  if (!doc) return;

  const isQuote = type === 'quotation';
  const statuses = isQuote ? QUOTE_STATUSES : PO_STATUSES;
  const target = isQuote ? doc.customer : doc.vendor;
  const targetLabel = isQuote ? 'ÂÆ¢Êà∂' : '‰æõÊáâÂïÜ';

  let itemsHtml = doc.items.map((item, i) => `
    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:13px">
      <div>
        <div>${isQuote ? item.productName : item.itemName}</div>
        <div style="font-size:11px;color:var(--text-dim)">${item.spec} √ó ${item.qty} ${item.unit}</div>
      </div>
      <div style="font-family:var(--font-en);font-weight:600">NTD ${numberFormat(item.subtotal)}</div>
    </div>
  `).join('');

  let statusBtns = statuses.map(s =>
    `<button class="btn btn-sm ${doc.status === s ? 'btn-primary' : 'btn-outline'}"
      onclick="updateDocStatus('${type}','${id}','${s}')" style="flex:1">${s}</button>`
  ).join('');

  let extraBtns = '';
  if (isQuote && doc.status === 'Â∑≤Êé•Âèó') {
    extraBtns = `<button class="btn btn-secondary btn-sm" onclick="convertQuoteToPO('${id}')" style="width:100%;margin-top:8px">üì¶ ËΩâÁÇ∫Êé°Ë≥ºÂñÆ</button>`;
  }

  const content = document.getElementById('modalContent');
  content.innerHTML = `
    <h3>${isQuote ? 'üìù Â†±ÂÉπÂñÆ' : 'üì¶ Êé°Ë≥ºÂñÆ'} ${doc.id}</h3>
    <div style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
      <div>Êó•ÊúüÔºö${doc.date}${isQuote ? ' ÔΩú ÊúâÊïàËá≥Ôºö' + doc.validUntil : ''}</div>
      <div>${targetLabel}Ôºö<strong style="color:var(--text-primary)">${target?.name || ''}</strong></div>
      ${target?.contact ? '<div>ËÅØÁπ´‰∫∫Ôºö' + target.contact + (target.phone ? ' / ' + target.phone : '') + '</div>' : ''}
      ${target?.email ? '<div>EmailÔºö' + target.email : ''}
      ${!isQuote && doc.expectedDelivery ? '<div>È†êÊúü‰∫§Ë≤®Ôºö' + doc.expectedDelivery + '</div>' : ''}
      ${!isQuote ? '<div>‰ªòÊ¨æÊ¢ù‰ª∂Ôºö' + doc.paymentTerms + '</div>' : ''}
      <div>Âª∫Á´ã‰∫∫Ôºö${doc.recorder}</div>
    </div>

    <div class="card" style="padding:12px;margin-bottom:12px">
      ${itemsHtml}
      <div style="border-top:1px solid rgba(255,255,255,0.1);padding-top:8px;margin-top:8px;font-size:13px">
        <div style="display:flex;justify-content:space-between;padding:2px 0">
          <span style="color:var(--text-secondary)">Â∞èË®à</span>
          <span style="font-family:var(--font-en);font-weight:600">NTD ${numberFormat(doc.subtotal)}</span>
        </div>
        ${isQuote && doc.discountAmount ? `<div style="display:flex;justify-content:space-between;padding:2px 0">
          <span style="color:var(--text-secondary)">ÊäòÊâ£</span>
          <span style="font-family:var(--font-en);font-weight:600;color:var(--success)">-NTD ${numberFormat(doc.discountAmount)}</span>
        </div>` : ''}
        <div style="display:flex;justify-content:space-between;padding:2px 0">
          <span style="color:var(--text-secondary)">Á®ÖÈ°ç (${doc.taxType === 'excluded' ? 'Â§ñÂä† 5%' : doc.taxType === 'included' ? 'ÂÖßÂê´ 5%' : 'ÂÖçÁ®Ö'})</span>
          <span style="font-family:var(--font-en);font-weight:600">NTD ${numberFormat(doc.taxAmount)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:6px 0;border-top:2px solid var(--orange);margin-top:6px;font-size:16px">
          <span style="font-weight:700">Á∏ΩË®à</span>
          <span style="font-family:var(--font-en);font-weight:700;color:var(--orange)">NTD ${numberFormat(doc.total)}</span>
        </div>
      </div>
    </div>

    ${doc.notes ? `<div style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">ÂÇôË®ªÔºö${doc.notes}</div>` : ''}

    <div style="margin-bottom:8px;font-size:12px;color:var(--text-secondary)">ÁãÄÊÖãËÆäÊõ¥</div>
    <div class="btn-group" style="flex-wrap:wrap;margin-top:0">${statusBtns}</div>
    ${extraBtns}

    <div class="btn-group" style="margin-top:12px">
      <button class="btn btn-secondary btn-sm" onclick="${isQuote ? 'generateQuotePDF' : 'generatePOPDF'}(state.${isQuote ? 'quotations' : 'purchaseOrders'}.find(d=>d.id==='${id}'))" style="flex:1">üìÑ Áî¢Áîü PDF</button>
      <button class="btn btn-danger btn-sm" onclick="deleteDoc('${type}','${id}')" style="flex:1">üóëÔ∏è Âà™Èô§</button>
    </div>
  `;
  document.getElementById('docModal').classList.add('active');
}

function closeModal() {
  document.getElementById('docModal').classList.remove('active');
}

function updateDocStatus(type, id, newStatus) {
  if (type === 'quotation') {
    const q = state.quotations.find(d => d.id === id);
    if (q) q.status = newStatus;
  } else {
    const p = state.purchaseOrders.find(d => d.id === id);
    if (p) p.status = newStatus;
  }
  saveState();
  showToast('ÁãÄÊÖãÂ∑≤Êõ¥Êñ∞ÁÇ∫„Äå' + newStatus + '„Äç', 'success');
  showDocDetail(type, id);
  renderDocList();
}

function deleteDoc(type, id) {
  if (!confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÂñÆÊìöÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) return;
  if (type === 'quotation') {
    state.quotations = state.quotations.filter(d => d.id !== id);
  } else {
    state.purchaseOrders = state.purchaseOrders.filter(d => d.id !== id);
  }
  saveState();
  closeModal();
  renderDocList();
  showToast('Â∑≤Âà™Èô§', 'info');
}

function convertQuoteToPO(quoteId) {
  const q = state.quotations.find(d => d.id === quoteId);
  if (!q) return;
  closeModal();
  switchTab('po');

  document.getElementById('poVendorName').value = q.customer.name;
  document.getElementById('poVendorContact').value = q.customer.contact || '';
  document.getElementById('poVendorPhone').value = q.customer.phone || '';
  document.getElementById('poVendorEmail').value = q.customer.email || '';
  document.getElementById('poRelatedQuote').value = quoteId;

  document.getElementById('poLineItems').innerHTML = '';
  poLineCounter = 0;
  q.items.forEach(item => {
    addPOLineItem({
      itemName: item.productName,
      spec: item.spec,
      qty: item.qty,
      unit: item.unit,
      unitPrice: item.unitPrice,
    });
  });

  showToast('Â∑≤Â∏∂ÂÖ•Â†±ÂÉπÂñÆË≥áÊñôÔºåË´ãÁ¢∫Ë™çÂæåÂÑ≤Â≠ò', 'info');
}

// ==================== Áµ±Ë®à ====================
function changeStatsMonth(delta) {
  statsMonth += delta;
  if (statsMonth > 12) { statsMonth = 1; statsYear++; }
  if (statsMonth < 1) { statsMonth = 12; statsYear--; }
  renderStats();
}

function renderStats() {
  document.getElementById('statsMonthLabel').textContent = statsYear + ' / ' + String(statsMonth).padStart(2, '0');

  const monthQuotes = state.quotations.filter(q => {
    const d = new Date(q.date);
    return d.getFullYear() === statsYear && (d.getMonth()+1) === statsMonth;
  });
  const monthPOs = state.purchaseOrders.filter(p => {
    const d = new Date(p.date);
    return d.getFullYear() === statsYear && (d.getMonth()+1) === statsMonth;
  });

  document.getElementById('statQuoteCount').textContent = monthQuotes.length;
  document.getElementById('statPOCount').textContent = monthPOs.length;
  document.getElementById('statQuoteTotal').textContent = numberFormat(monthQuotes.reduce((s, q) => s + q.total, 0));
  document.getElementById('statPOTotal').textContent = numberFormat(monthPOs.reduce((s, p) => s + p.total, 0));

  // ÁãÄÊÖãÂàÜÂ∏É
  const distHtml = QUOTE_STATUSES.map(s => {
    const count = monthQuotes.filter(q => q.status === s).length;
    return `<div style="display:flex;justify-content:space-between;padding:6px 0;font-size:13px">
      <span class="status-tag ${getStatusClass(s)}">${s}</span>
      <span style="font-family:var(--font-en);font-weight:600">${count}</span>
    </div>`;
  }).join('');
  document.getElementById('quoteStatusDist').innerHTML = distHtml;

  renderTrend();
}

function renderTrend() {
  const yearSel = document.getElementById('trendYear');
  if (yearSel.options.length === 0) {
    const curYear = new Date().getFullYear();
    for (let y = curYear - 2; y <= curYear; y++) {
      yearSel.innerHTML += `<option value="${y}" ${y === curYear ? 'selected' : ''}>${y}</option>`;
    }
  }
  const year = Number(yearSel.value);
  const monthData = [];
  let maxVal = 0;

  for (let m = 1; m <= 12; m++) {
    const qTotal = state.quotations
      .filter(q => { const d = new Date(q.date); return d.getFullYear() === year && (d.getMonth()+1) === m; })
      .reduce((s, q) => s + q.total, 0);
    const pTotal = state.purchaseOrders
      .filter(p => { const d = new Date(p.date); return d.getFullYear() === year && (d.getMonth()+1) === m; })
      .reduce((s, p) => s + p.total, 0);
    monthData.push({ m, qTotal, pTotal });
    if (qTotal > maxVal) maxVal = qTotal;
    if (pTotal > maxVal) maxVal = pTotal;
  }

  const chartEl = document.getElementById('trendChart');
  chartEl.innerHTML = monthData.map(d => {
    const qH = maxVal > 0 ? Math.max(2, (d.qTotal / maxVal) * 90) : 2;
    const qK = d.qTotal >= 1000 ? Math.round(d.qTotal / 1000) + 'k' : d.qTotal;
    return `<div class="trend-bar-wrap">
      <div class="trend-value">${qK}</div>
      <div style="flex:1;display:flex;align-items:flex-end;width:100%">
        <div class="trend-bar" style="height:${qH}%"></div>
      </div>
      <div class="trend-label">${d.m}Êúà</div>
    </div>`;
  }).join('');

  const yearQTotal = monthData.reduce((s, d) => s + d.qTotal, 0);
  const yearPTotal = monthData.reduce((s, d) => s + d.pTotal, 0);
  document.getElementById('trendSummary').innerHTML = `
    <span>Â†±ÂÉπ <strong>NTD ${numberFormat(yearQTotal)}</strong></span>
    <span>Êé°Ë≥º <strong>NTD ${numberFormat(yearPTotal)}</strong></span>
  `;
}

// ==================== Ë®≠ÂÆöÈ†Å ====================
function renderSettings() {
  document.getElementById('settingApiUrl').value = state.settings.apiUrl || '';
  document.getElementById('settingRecorder').value = state.settings.recorder || '';
  document.getElementById('settingCompanyName').value = state.settings.companyInfo?.name || 'Â†ÖÂøÉ Outrun Nutrition';
  document.getElementById('settingLegalName').value = state.settings.companyInfo?.legalName || '';
  document.getElementById('settingNameEn').value = state.settings.companyInfo?.nameEn || '';
  document.getElementById('settingTaxId').value = state.settings.companyInfo?.taxId || '';
  document.getElementById('settingCompanyPhone').value = state.settings.companyInfo?.phone || '';
  document.getElementById('settingCompanyEmail').value = state.settings.companyInfo?.email || '';
  document.getElementById('settingCompanyAddr').value = state.settings.companyInfo?.address || '';
  document.getElementById('settingSalesName').value = state.settings.salesRep?.name || '';
  document.getElementById('settingSalesPhone').value = state.settings.salesRep?.phone || '';
  document.getElementById('settingSalesEmail').value = state.settings.salesRep?.email || '';
  document.getElementById('settingSalesLine').value = state.settings.salesRep?.line || '';
  document.getElementById('settingBankName').value = state.settings.bankInfo?.bankName || '';
  document.getElementById('settingBankCode').value = state.settings.bankInfo?.bankCode || '';
  document.getElementById('settingBankBranch').value = state.settings.bankInfo?.branch || '';
  document.getElementById('settingBankHolder').value = state.settings.bankInfo?.holder || '';
  document.getElementById('settingBankAccount').value = state.settings.bankInfo?.account || '';
  document.getElementById('settingPdfTerms').value = state.settings.pdfTerms || '';
  // ÂúñÁâáÈ†êË¶Ω
  renderImagePreview('logo', state.settings.logoBase64);
  renderImagePreview('stamp', state.settings.stampBase64);
  renderProductList();
}

function saveSettings() {
  state.settings.apiUrl = document.getElementById('settingApiUrl').value.trim();
  state.settings.recorder = document.getElementById('settingRecorder').value.trim();
  state.settings.companyInfo = {
    name: document.getElementById('settingCompanyName').value.trim(),
    legalName: document.getElementById('settingLegalName').value.trim(),
    nameEn: document.getElementById('settingNameEn').value.trim(),
    taxId: document.getElementById('settingTaxId').value.trim(),
    phone: document.getElementById('settingCompanyPhone').value.trim(),
    email: document.getElementById('settingCompanyEmail').value.trim(),
    address: document.getElementById('settingCompanyAddr').value.trim(),
  };
  state.settings.salesRep = {
    name: document.getElementById('settingSalesName').value.trim(),
    phone: document.getElementById('settingSalesPhone').value.trim(),
    email: document.getElementById('settingSalesEmail').value.trim(),
    line: document.getElementById('settingSalesLine').value.trim(),
  };
  state.settings.bankInfo = {
    bankName: document.getElementById('settingBankName').value.trim(),
    bankCode: document.getElementById('settingBankCode').value.trim(),
    branch: document.getElementById('settingBankBranch').value.trim(),
    holder: document.getElementById('settingBankHolder').value.trim(),
    account: document.getElementById('settingBankAccount').value.trim(),
  };
  state.settings.pdfTerms = document.getElementById('settingPdfTerms').value.trim();
  saveState();
  updateSyncStatus();
  showToast('Ë®≠ÂÆöÂ∑≤ÂÑ≤Â≠ò', 'success');
}

function renderProductList() {
  const container = document.getElementById('productList');
  document.getElementById('productCountBadge').textContent = state.products.length;
  if (state.products.length === 0) {
    container.innerHTML = '<div style="text-align:center;color:var(--text-dim);padding:16px">Â∞öÁÑ°Áî¢ÂìÅ</div>';
    return;
  }
  container.innerHTML = state.products.map((p, i) => `
    <div class="product-list-item">
      <div class="product-info">
        <div class="product-name">${p.name}</div>
        <div class="product-spec">${p.spec}ÔΩú${p.unit}</div>
      </div>
      <span class="product-price">${p.price > 0 ? 'NTD ' + numberFormat(p.price) : '‰æùÂ†±ÂÉπ'}</span>
      <button class="btn btn-danger btn-sm" onclick="removeProduct(${i})" style="padding:4px 8px;font-size:11px">‚úï</button>
    </div>
  `).join('');
}

function addCustomProduct() {
  const name = document.getElementById('newProdName').value.trim();
  const spec = document.getElementById('newProdSpec').value.trim();
  const price = Number(document.getElementById('newProdPrice').value) || 0;
  const unit = document.getElementById('newProdUnit').value.trim() || 'ÂÄã';
  if (!name) { showToast('Ë´ãËº∏ÂÖ•ÂìÅÂêç', 'error'); return; }
  state.products.push({ name, spec, price, unit });
  saveState();
  renderProductList();
  document.getElementById('newProdName').value = '';
  document.getElementById('newProdSpec').value = '';
  document.getElementById('newProdPrice').value = '';
  document.getElementById('newProdUnit').value = '';
  showToast('Â∑≤Êñ∞Â¢ûÁî¢ÂìÅ', 'success');
}

function removeProduct(idx) {
  if (!confirm('Á¢∫ÂÆöÂà™Èô§„Äå' + state.products[idx].name + '„ÄçÔºü')) return;
  state.products.splice(idx, 1);
  saveState();
  renderProductList();
}

// ==================== Èõ≤Á´ØÂêåÊ≠•È™®Êû∂ ====================
function updateSyncStatus() {
  const dot = document.getElementById('syncDot');
  const label = document.getElementById('syncLabel');
  if (state.settings.apiUrl) {
    dot.className = 'sync-dot';
    label.textContent = 'Â∑≤ÈÄ£Á∑ö';
  } else {
    dot.className = 'sync-dot offline';
    label.textContent = 'Êú¨Ê©ü';
  }
}

async function callApi(method, data) {
  const url = state.settings.apiUrl;
  if (!url) throw new Error('Êú™Ë®≠ÂÆö API URL');

  if (method === 'GET') {
    const params = new URLSearchParams(data).toString();
    const res = await fetch(url + '?' + params);
    return await res.json();
  } else {
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    return await res.json();
  }
}

async function syncToCloud() {
  if (!state.settings.apiUrl) {
    showToast('Ë´ãÂÖàÂú®Ë®≠ÂÆöÈ†ÅÂ°´ÂÖ• API URL', 'error');
    return;
  }

  if (state.pendingSync.length === 0) {
    showToast('Ê≤íÊúâÂæÖÂêåÊ≠•ÁöÑË≥áÊñô', 'info');
    return;
  }

  showToast('Ê≠£Âú®ÂêåÊ≠•...', 'info');
  let success = 0;
  let fail = 0;

  for (const item of state.pendingSync) {
    try {
      await callApi('POST', { action: item.type, ...item.data });
      success++;
    } catch (e) {
      fail++;
    }
  }

  if (fail === 0) {
    state.pendingSync = [];
    saveState();
    showToast(`ÂêåÊ≠•ÂÆåÊàêÔºÅÂÖ± ${success} Á≠Ü`, 'success');
  } else {
    showToast(`ÂêåÊ≠•ÈÉ®ÂàÜÂÆåÊàêÔºö${success} ÊàêÂäü / ${fail} Â§±Êïó`, 'warning');
  }
}

function clearLocalData() {
  if (!confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊú¨Âú∞Ë≥áÊñôÂóéÔºü\nÔºàÂ†±ÂÉπÂñÆ„ÄÅÊé°Ë≥ºÂñÆ„ÄÅÁî¢ÂìÅÁõÆÈåÑÈÉΩÊúÉË¢´Ê∏ÖÈô§Ôºâ')) return;
  if (!confirm('Ê≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºåÁ¢∫ÂÆöË¶ÅÁπºÁ∫åÂóéÔºü')) return;
  Object.values(STORAGE_KEYS).forEach(k => localStorage.removeItem(k));
  state.quotations = [];
  state.purchaseOrders = [];
  state.products = [...DEFAULT_PRODUCTS];
  state.pendingSync = [];
  saveState();
  renderSettings();
  showToast('Êú¨Âú∞Ë≥áÊñôÂ∑≤Ê∏ÖÈô§', 'info');
}

// ==================== ÂúñÁâá‰∏äÂÇ≥ËôïÁêÜ ====================
function handleImageUpload(type, input) {
  const file = input.files[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) {
    showToast('ÂúñÁâáÂ§ßÂ∞è‰∏çÂæóË∂ÖÈÅé 2MB', 'error');
    input.value = '';
    return;
  }
  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result;
    if (type === 'logo') {
      state.settings.logoBase64 = base64;
    } else if (type === 'stamp') {
      state.settings.stampBase64 = base64;
    }
    saveState();
    renderImagePreview(type, base64);
    showToast((type === 'logo' ? 'Logo' : 'ÁôºÁ•®Á´†') + ' Â∑≤‰∏äÂÇ≥', 'success');
  };
  reader.readAsDataURL(file);
}

function clearImage(type) {
  if (type === 'logo') {
    state.settings.logoBase64 = '';
  } else if (type === 'stamp') {
    state.settings.stampBase64 = '';
  }
  saveState();
  renderImagePreview(type, '');
  showToast((type === 'logo' ? 'Logo' : 'ÁôºÁ•®Á´†') + ' Â∑≤Ê∏ÖÈô§', 'info');
}

function renderImagePreview(type, base64) {
  const container = document.getElementById(type + 'Preview');
  if (!container) return;
  if (base64) {
    container.innerHTML = '<img src="' + base64 + '" style="max-height:60px;max-width:200px;border-radius:4px;border:1px solid rgba(255,255,255,0.1)">';
  } else {
    container.innerHTML = '<div style="color:var(--text-dim);font-size:12px">Â∞öÊú™‰∏äÂÇ≥</div>';
  }
}

// ==================== PDF Áî¢ÁîüÔºàhtml2canvas ÊñπÊ°àÔºâ====================
function escHtml(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function buildQuoteHTML(q) {
  const co = state.settings.companyInfo;
  const sr = state.settings.salesRep || {};
  const bank = state.settings.bankInfo || {};
  const terms = state.settings.pdfTerms || '';
  const logoSrc = state.settings.logoBase64 || '';
  const stampSrc = state.settings.stampBase64 || '';
  const accent = '#145DDD';
  const afterDiscount = q.subtotal - (q.discountAmount || 0);
  const taxLabelMap = { excluded: 'ÁáüÊ•≠Á®ÖÔºà5%Ôºâ', included: 'ÁáüÊ•≠Á®ÖÔºàÂÖßÂê´ 5%Ôºâ', exempt: 'ÁáüÊ•≠Á®ÖÔºàÂÖçÁ®ÖÔºâ' };
  const untaxed = q.taxType === 'included' ? Math.round(afterDiscount / 1.05) : afterDiscount;

  let itemsHTML = q.items.map((item, i) => `
    <tr style="border-bottom:1px solid #e5e5e5">
      <td style="text-align:center;padding:8px 4px">${i + 1}</td>
      <td style="padding:8px 6px">${escHtml(item.productName)}${item.spec ? '<br><span style="color:#888;font-size:11px">' + escHtml(item.spec) + '</span>' : ''}</td>
      <td style="text-align:center;padding:8px 4px">${item.qty}</td>
      <td style="text-align:center;padding:8px 4px">${escHtml(item.unit || 'ÂÄã')}</td>
      <td style="text-align:right;padding:8px 6px">NT$ ${numberFormat(item.unitPrice)}</td>
      <td style="text-align:right;padding:8px 6px">NT$ ${numberFormat(item.subtotal)}</td>
    </tr>
  `).join('');

  const allNotes = [q.notes, terms].filter(Boolean).join('\n');

  return `
  <div style="font-family:'Noto Sans TC','Microsoft JhengHei','PingFang TC',sans-serif;color:#333;width:720px;padding:40px 45px;background:#fff;line-height:1.5">
    <!-- Ê®ôÈ†≠ -->
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
      <div>
        ${logoSrc ? '<img src="' + logoSrc + '" style="max-height:52px;max-width:280px;object-fit:contain;margin-bottom:8px" crossorigin="anonymous">' : '<div style="font-size:22px;font-weight:700;color:' + accent + ';margin-bottom:4px">' + escHtml(co.name || 'Â†ÖÂøÉ Outrun Nutrition') + '</div>'}
        ${co.legalName ? '<div style="font-size:11px;color:#666">' + escHtml(co.legalName) + (co.nameEn ? ' / ' + escHtml(co.nameEn) : '') + '</div>' : ''}
        ${co.taxId ? '<div style="font-size:11px;color:#666">Áµ±Á∑®Ôºö' + escHtml(co.taxId) + '</div>' : ''}
        ${co.address ? '<div style="font-size:11px;color:#666">Âú∞ÂùÄÔºö' + escHtml(co.address) + '</div>' : ''}
        ${co.phone ? '<div style="font-size:11px;color:#666">ÈõªË©±Ôºö' + escHtml(co.phone) + '</div>' : ''}
      </div>
      <div style="text-align:right">
        <div style="font-size:28px;font-weight:700;color:${accent};letter-spacing:2px">QUOTATION</div>
        <div style="font-size:16px;color:#666;margin-bottom:6px">Â†±ÂÉπÂñÆ</div>
        <div style="font-size:11px;color:#555">Â†±ÂÉπÂñÆËôüÔºö${escHtml(q.id)}</div>
        <div style="font-size:11px;color:#555">ÈñãÁ´ãÊó•ÊúüÔºö${escHtml(q.date)}</div>
        <div style="font-size:11px;color:#555">ÊúâÊïàÊúüÈôêÔºö${escHtml(q.validUntil)}</div>
      </div>
    </div>
    <div style="border-top:3px solid ${accent};margin-bottom:16px"></div>

    <!-- ÂÆ¢Êà∂ + Ê•≠Âãô -->
    <div style="display:flex;gap:16px;margin-bottom:16px">
      <div style="flex:1;border:1px solid #ddd;border-radius:4px;padding:12px">
        <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:6px">ÂÆ¢Êà∂Ë≥áË®ä BILL TO</div>
        <div style="font-size:14px;font-weight:600;color:#333;margin-bottom:4px">${escHtml(q.customer.name)}</div>
        ${q.customer.contact ? '<div style="font-size:11px;color:#666">ËÅØÁπ´‰∫∫Ôºö' + escHtml(q.customer.contact) + '</div>' : ''}
        ${q.customer.address ? '<div style="font-size:11px;color:#666">Âú∞ÂùÄÔºö' + escHtml(q.customer.address) + '</div>' : ''}
        ${q.customer.phone ? '<div style="font-size:11px;color:#666">ÈõªË©±Ôºö' + escHtml(q.customer.phone) + '</div>' : ''}
        ${q.customer.email ? '<div style="font-size:11px;color:#666">EmailÔºö' + escHtml(q.customer.email) + '</div>' : ''}
      </div>
      <div style="flex:1;border:1px solid #ddd;border-radius:4px;padding:12px">
        <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:6px">Ê•≠Âãô‰ª£Ë°® SALES REP</div>
        <div style="font-size:14px;font-weight:600;color:#333;margin-bottom:4px">${escHtml(sr.name || state.settings.recorder || '')}</div>
        ${sr.phone ? '<div style="font-size:11px;color:#666">ÈõªË©±Ôºö' + escHtml(sr.phone) + '</div>' : ''}
        ${sr.email ? '<div style="font-size:11px;color:#666">EmailÔºö' + escHtml(sr.email) + '</div>' : ''}
        ${sr.line ? '<div style="font-size:11px;color:#666">LINEÔºö' + escHtml(sr.line) + '</div>' : ''}
      </div>
    </div>

    <!-- ÊòéÁ¥∞Ë°®Ê†º -->
    <table style="width:100%;border-collapse:collapse;margin-bottom:16px;font-size:12px">
      <thead>
        <tr style="background:${accent};color:#fff">
          <th style="padding:8px 6px;text-align:center;width:36px">#</th>
          <th style="padding:8px 6px;text-align:left">ÂìÅÈ†Ö Description</th>
          <th style="padding:8px 6px;text-align:center;width:55px">Êï∏Èáè</th>
          <th style="padding:8px 6px;text-align:center;width:50px">ÂñÆ‰Ωç</th>
          <th style="padding:8px 6px;text-align:right;width:90px">ÂñÆÂÉπ</th>
          <th style="padding:8px 6px;text-align:right;width:100px">Â∞èË®à</th>
        </tr>
      </thead>
      <tbody>
        ${itemsHTML}
      </tbody>
    </table>

    <!-- ÈáëÈ°çÂåØÁ∏Ω -->
    <div style="display:flex;justify-content:flex-end;margin-bottom:16px">
      <div style="width:280px">
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#666">
          <span>Èä∑ÂîÆÂêàË®àÔºàÊú™Á®ÖÔºâ</span><span>NT$ ${numberFormat(untaxed)}</span>
        </div>
        ${q.discountAmount ? '<div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#666"><span>ÊäòÊâ£</span><span>-NT$ ' + numberFormat(q.discountAmount) + '</span></div>' : ''}
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#666">
          <span>${taxLabelMap[q.taxType] || 'ÁáüÊ•≠Á®ÖÔºà5%Ôºâ'}</span><span>NT$ ${numberFormat(q.taxAmount)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#555">
          <span>ÂïÜÂìÅÁ∏ΩÈ°çÔºàÂê´Á®ÖÔºâ</span><span>NT$ ${numberFormat(q.total)}</span>
        </div>
        <div style="border-top:2px solid ${accent};margin:4px 0"></div>
        <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:16px;font-weight:700;color:${accent}">
          <span>Á∏ΩË®à Total</span><span>NT$ ${numberFormat(q.total)}</span>
        </div>
      </div>
    </div>

    <!-- ÂåØÊ¨æË≥áË®ä -->
    ${(bank.bankName || bank.account) ? `
    <div style="border:1px solid #ddd;border-radius:4px;padding:10px 12px;margin-bottom:12px">
      <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:4px">ÂåØÊ¨æË≥áË®ä PAYMENT</div>
      ${bank.bankCode && bank.bankName ? '<div style="font-size:11px;color:#555">ÈäÄË°å‰ª£Á¢ºÔºö' + escHtml(bank.bankCode) + 'Ôºà' + escHtml(bank.bankName) + 'Ôºâ</div>' : ''}
      ${bank.branch ? '<div style="font-size:11px;color:#555">ÂàÜË°åÔºö' + escHtml(bank.branch) + '</div>' : ''}
      ${bank.account ? '<div style="font-size:11px;color:#555">Â∏≥ËôüÔºö' + escHtml(bank.account) + '</div>' : ''}
      ${bank.holder ? '<div style="font-size:11px;color:#555">Êà∂ÂêçÔºö' + escHtml(bank.holder) + '</div>' : ''}
    </div>` : ''}

    <!-- ÂÇôË®ªÊ¢ùÊ¨æ -->
    ${allNotes ? `
    <div style="border:1px solid #ddd;border-radius:4px;padding:10px 12px;margin-bottom:20px">
      <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:4px">ÂÇôË®ªÊ¢ùÊ¨æ TERMS</div>
      <div style="font-size:10px;color:#666;white-space:pre-line">${escHtml(allNotes)}</div>
    </div>` : ''}

    <!-- Á∞ΩÁΩ≤ÂçÄ -->
    <div style="display:flex;gap:40px;margin-top:30px">
      <div style="flex:1">
        <div style="font-size:10px;color:#888;margin-bottom:30px">ÂÆ¢Êà∂Á∞ΩÁΩ≤ Accepted By</div>
        <div style="border-top:1px solid #ccc;padding-top:4px;font-size:9px;color:#aaa">ÂÖ¨Âè∏ÂêçÁ®± / Êó•Êúü</div>
      </div>
      <div style="flex:1;text-align:center">
        <div style="font-size:10px;color:#888;margin-bottom:6px">${escHtml(co.legalName || co.name || '')} Authorized By</div>
        ${stampSrc ? '<img src="' + stampSrc + '" style="max-height:120px;max-width:180px;object-fit:contain;margin-bottom:4px" crossorigin="anonymous">' : '<div style="height:120px"></div>'}
        <div style="border-top:1px solid #ccc;padding-top:4px;font-size:9px;color:#aaa">ÊéàÊ¨äÁ∞ΩÁ´† / Êó•Êúü</div>
      </div>
    </div>

    <!-- È†ÅËÖ≥ -->
    <div style="text-align:center;margin-top:20px;font-size:9px;color:#bbb">
      ${escHtml([co.name, co.phone, co.email].filter(Boolean).join(' | '))}
    </div>
  </div>`;
}

function buildPOHTML(po) {
  const co = state.settings.companyInfo;
  const logoSrc = state.settings.logoBase64 || '';
  const stampSrc = state.settings.stampBase64 || '';
  const accent = '#145DDD';
  const poAfterTax = po.taxType === 'included' ? Math.round(po.subtotal / 1.05) : po.subtotal;
  const taxLabelMap = { excluded: 'ÁáüÊ•≠Á®ÖÔºà5%Ôºâ', included: 'ÁáüÊ•≠Á®ÖÔºàÂÖßÂê´ 5%Ôºâ', exempt: 'ÁáüÊ•≠Á®ÖÔºàÂÖçÁ®ÖÔºâ' };

  let itemsHTML = po.items.map((item, i) => `
    <tr style="border-bottom:1px solid #e5e5e5">
      <td style="text-align:center;padding:8px 4px">${i + 1}</td>
      <td style="padding:8px 6px">${escHtml(item.itemName)}${item.spec ? '<br><span style="color:#888;font-size:11px">' + escHtml(item.spec) + '</span>' : ''}</td>
      <td style="text-align:center;padding:8px 4px">${item.qty}</td>
      <td style="text-align:center;padding:8px 4px">${escHtml(item.unit || 'ÂÄã')}</td>
      <td style="text-align:right;padding:8px 6px">NT$ ${numberFormat(item.unitPrice)}</td>
      <td style="text-align:right;padding:8px 6px">NT$ ${numberFormat(item.subtotal)}</td>
    </tr>
  `).join('');

  return `
  <div style="font-family:'Noto Sans TC','Microsoft JhengHei','PingFang TC',sans-serif;color:#333;width:720px;padding:40px 45px;background:#fff;line-height:1.5">
    <!-- Ê®ôÈ†≠ -->
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
      <div>
        ${logoSrc ? '<img src="' + logoSrc + '" style="max-height:52px;max-width:280px;object-fit:contain;margin-bottom:8px" crossorigin="anonymous">' : '<div style="font-size:22px;font-weight:700;color:' + accent + ';margin-bottom:4px">' + escHtml(co.name || 'Â†ÖÂøÉ Outrun Nutrition') + '</div>'}
        ${co.legalName ? '<div style="font-size:11px;color:#666">' + escHtml(co.legalName) + (co.nameEn ? ' / ' + escHtml(co.nameEn) : '') + '</div>' : ''}
        ${co.taxId ? '<div style="font-size:11px;color:#666">Áµ±Á∑®Ôºö' + escHtml(co.taxId) + '</div>' : ''}
        ${co.address ? '<div style="font-size:11px;color:#666">Âú∞ÂùÄÔºö' + escHtml(co.address) + '</div>' : ''}
      </div>
      <div style="text-align:right">
        <div style="font-size:26px;font-weight:700;color:${accent};letter-spacing:1px">PURCHASE ORDER</div>
        <div style="font-size:16px;color:#666;margin-bottom:6px">Êé°Ë≥ºÂñÆ</div>
        <div style="font-size:11px;color:#555">Êé°Ë≥ºÂñÆËôüÔºö${escHtml(po.id)}</div>
        <div style="font-size:11px;color:#555">ÈñãÁ´ãÊó•ÊúüÔºö${escHtml(po.date)}</div>
        ${po.expectedDelivery ? '<div style="font-size:11px;color:#555">È†êÊúü‰∫§Ë≤®Ôºö' + escHtml(po.expectedDelivery) + '</div>' : ''}
      </div>
    </div>
    <div style="border-top:3px solid ${accent};margin-bottom:16px"></div>

    <!-- ‰æõÊáâÂïÜ + ‰ªòÊ¨æÊ¢ù‰ª∂ -->
    <div style="display:flex;gap:16px;margin-bottom:16px">
      <div style="flex:1;border:1px solid #ddd;border-radius:4px;padding:12px">
        <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:6px">‰æõÊáâÂïÜ VENDOR</div>
        <div style="font-size:14px;font-weight:600;color:#333;margin-bottom:4px">${escHtml(po.vendor.name)}</div>
        ${po.vendor.contact ? '<div style="font-size:11px;color:#666">ËÅØÁπ´‰∫∫Ôºö' + escHtml(po.vendor.contact) + '</div>' : ''}
        ${po.vendor.phone ? '<div style="font-size:11px;color:#666">ÈõªË©±Ôºö' + escHtml(po.vendor.phone) + '</div>' : ''}
        ${po.vendor.email ? '<div style="font-size:11px;color:#666">EmailÔºö' + escHtml(po.vendor.email) + '</div>' : ''}
      </div>
      <div style="flex:1;border:1px solid #ddd;border-radius:4px;padding:12px">
        <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:6px">‰ªòÊ¨æÊ¢ù‰ª∂ TERMS</div>
        <div style="font-size:13px;font-weight:500;color:#333">${escHtml(po.paymentTerms || 'ÊúàÁµê30Â§©')}</div>
        ${po.relatedQuotationId ? '<div style="font-size:11px;color:#666;margin-top:6px">ÈóúËÅØÂ†±ÂÉπÂñÆÔºö' + escHtml(po.relatedQuotationId) + '</div>' : ''}
      </div>
    </div>

    <!-- ÊòéÁ¥∞Ë°®Ê†º -->
    <table style="width:100%;border-collapse:collapse;margin-bottom:16px;font-size:12px">
      <thead>
        <tr style="background:${accent};color:#fff">
          <th style="padding:8px 6px;text-align:center;width:36px">#</th>
          <th style="padding:8px 6px;text-align:left">ÂìÅÈ†Ö Description</th>
          <th style="padding:8px 6px;text-align:center;width:55px">Êï∏Èáè</th>
          <th style="padding:8px 6px;text-align:center;width:50px">ÂñÆ‰Ωç</th>
          <th style="padding:8px 6px;text-align:right;width:90px">ÂñÆÂÉπ</th>
          <th style="padding:8px 6px;text-align:right;width:100px">Â∞èË®à</th>
        </tr>
      </thead>
      <tbody>
        ${itemsHTML}
      </tbody>
    </table>

    <!-- ÈáëÈ°çÂåØÁ∏Ω -->
    <div style="display:flex;justify-content:flex-end;margin-bottom:16px">
      <div style="width:280px">
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#666">
          <span>Â∞èË®àÔºàÊú™Á®ÖÔºâ</span><span>NT$ ${numberFormat(poAfterTax)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#666">
          <span>${taxLabelMap[po.taxType] || 'ÁáüÊ•≠Á®ÖÔºà5%Ôºâ'}</span><span>NT$ ${numberFormat(po.taxAmount)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:4px 0;font-size:12px;color:#555">
          <span>ÂêàË®àÈáëÈ°çÔºàÂê´Á®ÖÔºâ</span><span>NT$ ${numberFormat(po.total)}</span>
        </div>
        <div style="border-top:2px solid ${accent};margin:4px 0"></div>
        <div style="display:flex;justify-content:space-between;padding:6px 0;font-size:16px;font-weight:700;color:${accent}">
          <span>Á∏ΩË®à Total</span><span>NT$ ${numberFormat(po.total)}</span>
        </div>
      </div>
    </div>

    <!-- ÂÇôË®ª -->
    ${po.notes ? `
    <div style="border:1px solid #ddd;border-radius:4px;padding:10px 12px;margin-bottom:20px">
      <div style="font-size:11px;font-weight:600;color:${accent};margin-bottom:4px">ÂÇôË®ª NOTES</div>
      <div style="font-size:10px;color:#666;white-space:pre-line">${escHtml(po.notes)}</div>
    </div>` : ''}

    <!-- Á∞ΩÁΩ≤ÂçÄ -->
    <div style="display:flex;gap:40px;margin-top:30px">
      <div style="flex:1">
        <div style="font-size:10px;color:#888;margin-bottom:30px">‰æõÊáâÂïÜÁ¢∫Ë™ç Vendor Confirmation</div>
        <div style="border-top:1px solid #ccc;padding-top:4px;font-size:9px;color:#aaa">ÂÖ¨Âè∏ÂêçÁ®± / Êó•Êúü</div>
      </div>
      <div style="flex:1;text-align:center">
        <div style="font-size:10px;color:#888;margin-bottom:6px">${escHtml(co.legalName || co.name || '')} Ê†∏ÂáÜ</div>
        ${stampSrc ? '<img src="' + stampSrc + '" style="max-height:120px;max-width:180px;object-fit:contain;margin-bottom:4px" crossorigin="anonymous">' : '<div style="height:120px"></div>'}
        <div style="border-top:1px solid #ccc;padding-top:4px;font-size:9px;color:#aaa">ÊéàÊ¨äÁ∞ΩÁ´† / Êó•Êúü</div>
      </div>
    </div>

    <!-- È†ÅËÖ≥ -->
    <div style="text-align:center;margin-top:20px;font-size:9px;color:#bbb">
      ${escHtml([co.name, co.phone, co.email].filter(Boolean).join(' | '))}
    </div>
  </div>`;
}

async function htmlToPDF(htmlContent, filename) {
  showToast('Ê≠£Âú®Áî¢Áîü PDF...', 'info');
  // Âª∫Á´ãÈö±ËóèÁöÑÊ∏≤ÊüìÂÆπÂô®
  const container = document.createElement('div');
  container.style.cssText = 'position:fixed;left:-9999px;top:0;z-index:-1;';
  container.innerHTML = htmlContent;
  document.body.appendChild(container);

  try {
    // Á≠âÂæÖÂ≠óÈ´îËºâÂÖ•
    if (document.fonts && document.fonts.ready) await document.fonts.ready;
    // Áü≠Êö´Âª∂ÈÅ≤Á¢∫‰øùÊ∏≤ÊüìÂÆåÊàê
    await new Promise(r => setTimeout(r, 300));

    const el = container.firstElementChild;
    const canvas = await html2canvas(el, {
      scale: 2.5,
      useCORS: true,
      backgroundColor: '#ffffff',
      logging: false,
    });

    const imgData = canvas.toDataURL('image/jpeg', 0.92);
    const { jsPDF } = window.jspdf;

    // A4 ÊØî‰æãÔºö210 x 297 mm
    const pdfW = 210;
    const pdfH = 297;
    const imgW = canvas.width;
    const imgH = canvas.height;
    const ratio = pdfW / imgW;
    const scaledH = imgH * ratio;

    // Â¶ÇÊûúÂÖßÂÆπË∂ÖÈÅé‰∏ÄÈ†ÅÔºåÊåâÈ†ÅÂàÜÂâ≤
    if (scaledH <= pdfH) {
      const doc = new jsPDF({ unit: 'mm', format: 'a4' });
      doc.addImage(imgData, 'JPEG', 0, 0, pdfW, scaledH);
      doc.save(filename);
    } else {
      const doc = new jsPDF({ unit: 'mm', format: [pdfW, scaledH] });
      doc.addImage(imgData, 'JPEG', 0, 0, pdfW, scaledH);
      doc.save(filename);
    }

    showToast('PDF Â∑≤‰∏ãËºâÔºö' + filename, 'success');
  } catch (e) {
    console.error('PDF Áî¢ÁîüÂ§±Êïó:', e);
    showToast('PDF Áî¢ÁîüÂ§±ÊïóÔºö' + e.message, 'error');
  } finally {
    document.body.removeChild(container);
  }
}

async function generateQuotePDF(q) {
  const html = buildQuoteHTML(q);
  await htmlToPDF(html, q.id + '.pdf');
}

async function generatePOPDF(po) {
  const html = buildPOHTML(po);
  await htmlToPDF(html, po.id + '.pdf');
}

// ==================== PWA ====================
(function initPWA() {
  const manifest = {
    name: 'Â†ÖÂøÉÂ†±ÂÉπÊé°Ë≥º ‚Äî Outrun Nutrition',
    short_name: 'Â†ÖÂøÉÂ†±ÂÉπÊé°Ë≥º',
    description: 'Outrun Nutrition Â†±ÂÉπÂñÆËàáÊé°Ë≥ºÂñÆÁÆ°ÁêÜÁ≥ªÁµ±',
    start_url: location.href.split('?')[0],
    display: 'standalone',
    background_color: '#2F2F2F',
    theme_color: '#2F2F2F',
    icons: [{
      src: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><rect width="192" height="192" rx="32" fill="#2F2F2F"/><text x="96" y="130" text-anchor="middle" font-size="110">üìã</text></svg>'),
      sizes: '192x192', type: 'image/svg+xml',
    }],
  };
  const blob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
  const link = document.createElement('link');
  link.rel = 'manifest';
  link.href = URL.createObjectURL(blob);
  document.head.appendChild(link);

  let deferredPrompt = null;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const banner = document.createElement('div');
    banner.id = 'pwaInstallBanner';
    banner.style.cssText = 'position:fixed;bottom:16px;left:12px;right:12px;background:var(--dark-gray);border:1px solid var(--orange);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.5)';
    banner.innerHTML = `<div style="font-size:28px">üì≤</div><div style="flex:1"><div style="font-weight:600;font-size:14px">Âä†Âà∞‰∏ªÁï´Èù¢</div><div style="font-size:11px;color:var(--text-secondary)">ÂÆâË£ùÂ†ÖÂøÉÂ†±ÂÉπÊé°Ë≥º App</div></div>
    <button onclick="deferredPrompt.prompt();deferredPrompt=null;this.parentElement.remove()" style="background:var(--orange);color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:13px;font-weight:600;cursor:pointer">ÂÆâË£ù</button>
    <button onclick="this.parentElement.remove()" style="background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:18px">‚úï</button>`;
    document.body.appendChild(banner);
  });
})();

// ==================== ÂàùÂßãÂåñ ====================
function initDateFields() {
  const today = todayStr();
  document.getElementById('quoteDate').value = today;
  document.getElementById('quoteValidUntil').value = addDays(today, 30);
  document.getElementById('poDate').value = today;
}

document.addEventListener('DOMContentLoaded', function() {
  loadState();
  initDateFields();
  updateSyncStatus();

  const now = new Date();
  listYear = statsYear = now.getFullYear();
  listMonth = statsMonth = now.getMonth() + 1;

  // È¶ñÊ¨°‰ΩøÁî®ÂêçÁ®±ÊèêÁ§∫
  if (!state.settings.recorder) {
    setTimeout(() => {
      const name = prompt('Ê≠°Ëøé‰ΩøÁî®Â†ÖÂøÉÂ†±ÂÉπ/Êé°Ë≥ºÁ≥ªÁµ±ÔºÅ\nË´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÂ≠óÔºàÁî®ÊñºË®òÈåÑÂª∫Á´ã‰∫∫ÔºâÔºö');
      if (name && name.trim()) {
        state.settings.recorder = name.trim();
        saveState();
        showToast('‰Ω†Â•ΩÔºå' + name.trim() + 'ÔºÅ', 'success');
      }
    }, 500);
  }

  addQuoteLineItem();

  // Logo ÂíåÁôºÁ•®Á´†Â∑≤Âú® loadState() ‰∏≠Ëá™ÂãïÂ°´ÂÖÖÂÖßÂª∫È†êË®≠ÂÄº
});
</script>
</body>
</html>
