<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Outrun Nutrition â€” å€‹äººåŒ–ç‡Ÿé¤Šè©•ä¼°</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --primary:#2563eb;--primary-light:#3b82f6;--primary-dark:#1d4ed8;
  --accent:#10b981;--accent-dark:#059669;
  --bg:#f8fafc;--surface:#ffffff;--surface-alt:#f1f5f9;
  --text:#0f172a;--text-secondary:#475569;--text-muted:#94a3b8;
  --border:#e2e8f0;--radius:14px;
  --shadow:0 1px 3px rgba(0,0,0,.06);
  --shadow-md:0 4px 16px rgba(0,0,0,.08);
  --shadow-lg:0 8px 30px rgba(0,0,0,.1);
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",sans-serif;
}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.7;min-height:100vh}

/* ===== Layout ===== */
.ns-wrap{max-width:640px;margin:0 auto;padding:32px 20px 48px}
.ns-brand{text-align:center;margin-bottom:8px}
.ns-brand-name{font-size:.85rem;font-weight:600;letter-spacing:2px;color:var(--primary);text-transform:uppercase}
.ns-header{text-align:center;margin-bottom:32px}
.ns-header h1{font-size:1.6rem;font-weight:700;color:var(--text);margin-bottom:8px;line-height:1.4}
.ns-header p{color:var(--text-secondary);font-size:.9rem;max-width:480px;margin:0 auto}

/* ===== Progress ===== */
.ns-progress-wrap{margin-bottom:32px}
.ns-progress-steps{display:flex;justify-content:space-between;margin-bottom:8px}
.ns-progress-step{font-size:.72rem;font-weight:500;color:var(--text-muted);transition:color .3s}
.ns-progress-step.active{color:var(--primary);font-weight:600}
.ns-progress-step.done{color:var(--accent)}
.ns-progress-bar{height:4px;background:var(--border);border-radius:2px;overflow:hidden}
.ns-progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--primary));border-radius:2px;transition:width .4s ease}

/* ===== Card ===== */
.ns-card{background:var(--surface);border-radius:var(--radius);padding:32px 28px;box-shadow:var(--shadow);border:1px solid var(--border)}
.ns-step-num{display:inline-block;font-size:.72rem;font-weight:600;color:var(--primary);background:rgba(37,99,235,.08);padding:4px 12px;border-radius:20px;margin-bottom:12px}
.ns-step-title{font-size:1.15rem;font-weight:700;margin-bottom:4px;color:var(--text)}
.ns-step-desc{color:var(--text-secondary);font-size:.85rem;margin-bottom:24px;line-height:1.6}

/* ===== Form Fields ===== */
.ns-field{margin-bottom:20px}
.ns-field label.ns-label{display:block;font-size:.85rem;font-weight:600;color:var(--text);margin-bottom:8px}
.ns-field .ns-hint{font-size:.78rem;color:var(--text-muted);margin-top:4px}
.ns-field input[type="number"],.ns-field select{width:100%;padding:12px 16px;border:1.5px solid var(--border);border-radius:10px;font-size:.95rem;color:var(--text);background:var(--surface);transition:border-color .2s,box-shadow .2s;font-family:var(--font)}
.ns-field input:focus,.ns-field select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.ns-row{display:flex;gap:12px}
.ns-row .ns-field{flex:1}

/* ===== Toggle Group (radio/checkbox as cards) ===== */
.ns-toggle-group{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.ns-toggle-group.cols-3{grid-template-columns:repeat(3,1fr)}
.ns-toggle-group input{display:none}
.ns-toggle-group label.ns-toggle{display:flex;flex-direction:column;align-items:center;gap:6px;padding:16px 10px;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all .2s;text-align:center;font-size:.82rem;font-weight:500;color:var(--text-secondary);user-select:none}
.ns-toggle-group label.ns-toggle:hover{border-color:var(--primary-light);background:rgba(37,99,235,.02)}
.ns-toggle-group input:checked+label.ns-toggle{border-color:var(--primary);background:rgba(37,99,235,.05);color:var(--primary);font-weight:600}
.ns-toggle .ns-icon{font-size:1.4rem}
.ns-toggle .ns-toggle-desc{font-size:.72rem;color:var(--text-muted);font-weight:400;line-height:1.3}
.ns-toggle-group input:checked+label.ns-toggle .ns-toggle-desc{color:var(--primary)}

/* ===== Buttons ===== */
.ns-actions{display:flex;gap:10px;margin-top:28px}
.ns-btn{flex:1;padding:14px 24px;border:none;border-radius:10px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font)}
.ns-btn-primary{background:var(--primary);color:#fff}
.ns-btn-primary:hover{background:var(--primary-dark);box-shadow:var(--shadow-md)}
.ns-btn-secondary{background:var(--surface);color:var(--text-secondary);border:1.5px solid var(--border)}
.ns-btn-secondary:hover{background:var(--surface-alt);border-color:var(--text-muted)}
.ns-btn:disabled{opacity:.5;cursor:not-allowed}

/* ===== Results Page ===== */
.ns-result-hero{text-align:center;padding:28px 20px;background:linear-gradient(135deg,#eff6ff,#ecfdf5);border-radius:var(--radius);margin-bottom:28px}
.ns-result-hero .ns-big-num{font-size:2.8rem;font-weight:800;color:var(--primary);line-height:1}
.ns-result-hero .ns-big-label{font-size:.85rem;color:var(--text-secondary);margin-top:6px}
.ns-result-hero .ns-user-summary{font-size:.82rem;color:var(--text-muted);margin-top:10px}

.ns-section{margin-bottom:28px}
.ns-section h3{font-size:1rem;font-weight:700;margin-bottom:14px;padding-bottom:10px;border-bottom:2px solid var(--surface-alt);display:flex;align-items:center;gap:8px}
.ns-section h3 .ns-section-icon{font-size:1.1rem}

/* Macro bars */
.ns-macro{display:flex;align-items:center;gap:14px;padding:12px 0;border-bottom:1px solid var(--surface-alt)}
.ns-macro:last-child{border-bottom:none}
.ns-macro-name{width:90px;font-size:.85rem;font-weight:600;flex-shrink:0;color:var(--text)}
.ns-macro-bar-wrap{flex:1;height:10px;background:var(--surface-alt);border-radius:5px;overflow:hidden}
.ns-macro-bar{height:100%;border-radius:5px;transition:width .8s ease}
.ns-macro-val{width:100px;text-align:right;font-size:.82rem;font-weight:600;flex-shrink:0;color:var(--text-secondary)}

/* Micro nutrient alerts */
.ns-micro-card{padding:14px 16px;background:var(--surface-alt);border-radius:10px;margin-bottom:8px;display:flex;align-items:flex-start;gap:12px}
.ns-micro-icon{font-size:1.2rem;flex-shrink:0;margin-top:2px}
.ns-micro-info{flex:1}
.ns-micro-name{font-size:.88rem;font-weight:600;color:var(--text)}
.ns-micro-detail{font-size:.78rem;color:var(--text-secondary);margin-top:2px;line-height:1.5}
.ns-micro-status{padding:3px 10px;border-radius:20px;font-size:.72rem;font-weight:600;white-space:nowrap;flex-shrink:0;align-self:center}
.ns-status-warning{background:#fef3c7;color:#b45309}
.ns-status-ok{background:#d1fae5;color:#059669}
.ns-status-low{background:#fee2e2;color:#dc2626}

/* Product recommendations */
.ns-product{display:flex;gap:14px;padding:16px;background:var(--surface-alt);border-radius:12px;margin-bottom:10px;align-items:center;transition:box-shadow .2s}
.ns-product:hover{box-shadow:var(--shadow-md)}
.ns-product-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0}
.ns-product-info{flex:1}
.ns-product-name{font-weight:600;font-size:.9rem;color:var(--text)}
.ns-product-dose{font-size:.78rem;color:var(--text-secondary);margin-top:2px}
.ns-product-reason{font-size:.75rem;color:var(--text-muted);margin-top:3px;line-height:1.4}
.ns-product-evidence{font-size:.68rem;color:var(--primary);margin-top:2px;font-weight:500}
.ns-product-tag{padding:4px 10px;border-radius:20px;font-size:.72rem;font-weight:600;white-space:nowrap;flex-shrink:0}
.ns-tag-essential{background:#dbeafe;color:#1d4ed8}
.ns-tag-recommended{background:#d1fae5;color:#059669}
.ns-tag-optional{background:#fef3c7;color:#b45309}

/* Contact collection */
.ns-contact-box{padding:24px;background:linear-gradient(135deg,#eff6ff,#f0fdf4);border-radius:var(--radius);margin-bottom:24px;border:1px solid var(--border)}
.ns-contact-box h3{font-size:.95rem;font-weight:700;margin-bottom:4px;border:none;padding:0}
.ns-contact-box p{font-size:.8rem;color:var(--text-secondary);margin-bottom:16px}
.ns-contact-row{display:flex;gap:10px;margin-bottom:10px}
.ns-contact-row .ns-field{flex:1;margin-bottom:0}
.ns-contact-row input{padding:10px 14px;font-size:.88rem}
.ns-btn-submit-contact{width:100%;padding:12px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-size:.9rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font);margin-top:6px}
.ns-btn-submit-contact:hover{background:var(--accent-dark)}
.ns-contact-success{display:none;text-align:center;padding:16px;color:var(--accent-dark);font-weight:600;font-size:.9rem}

/* Disclaimer */
.ns-disclaimer{margin-top:24px;padding:14px 18px;background:#fffbeb;border:1px solid #fde68a;border-radius:10px;font-size:.75rem;color:#92400e;line-height:1.6}

/* Restart & PDF */
.ns-bottom-actions{display:flex;gap:10px;justify-content:center;margin-top:24px;flex-wrap:wrap}
.ns-btn-action{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;border-radius:10px;font-size:.88rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font);border:2px solid var(--border);background:var(--surface);color:var(--text-secondary)}
.ns-btn-action:hover{border-color:var(--primary);color:var(--primary)}
.ns-btn-action.ns-btn-pdf{border-color:var(--primary);color:var(--primary)}
.ns-btn-action.ns-btn-pdf:hover{background:var(--primary);color:#fff}

/* Reference */
.ns-references{margin-top:20px;padding:16px 18px;background:var(--surface-alt);border-radius:10px}
.ns-references summary{font-size:.82rem;font-weight:600;color:var(--text-secondary);cursor:pointer}
.ns-references .ns-ref-list{margin-top:10px;font-size:.72rem;color:var(--text-muted);line-height:1.8}

/* Responsive */
@media(max-width:480px){
  .ns-wrap{padding:20px 14px 40px}
  .ns-card{padding:24px 18px}
  .ns-toggle-group{grid-template-columns:1fr 1fr}
  .ns-toggle-group.cols-3{grid-template-columns:1fr 1fr}
  .ns-row{flex-direction:column;gap:0}
  .ns-result-hero .ns-big-num{font-size:2.2rem}
  .ns-contact-row{flex-direction:column}
  .ns-progress-steps{display:none}
}

/* Utility */
.ns-hidden{display:none!important}
.ns-fade-in{animation:nsFadeIn .4s ease}
@keyframes nsFadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="ns-wrap" id="nsApp">
  <div class="ns-brand"><span class="ns-brand-name">Outrun Nutrition</span></div>
  <div class="ns-header">
    <h1>å€‹äººåŒ–ç‡Ÿé¤Šè©•ä¼°</h1>
    <p>èŠ± 3 åˆ†é˜äº†è§£ä½ çš„ç‡Ÿé¤Šç‹€æ…‹ï¼Œç²å¾—å°ˆå±¬å»ºè­°<br>æ‰€æœ‰å»ºè­°çš†åŸºæ–¼å°ç£è¡›ç¦éƒ¨ DRIs èˆ‡åœ‹éš›é‹å‹•ç‡Ÿé¤Šå­¸æœƒç ”ç©¶</p>
  </div>

  <!-- Progress -->
  <div class="ns-progress-wrap">
    <div class="ns-progress-steps" id="nsProgressSteps">
      <span class="ns-progress-step active" data-step="1">åŸºæœ¬è³‡æ–™</span>
      <span class="ns-progress-step" data-step="2">é£²é£Ÿç¿’æ…£</span>
      <span class="ns-progress-step" data-step="3">ç”Ÿæ´»å‹æ…‹</span>
      <span class="ns-progress-step" data-step="4">å¥åº·ç›®æ¨™</span>
      <span class="ns-progress-step" data-step="5">è©•ä¼°çµæœ</span>
    </div>
    <div class="ns-progress-bar"><div class="ns-progress-fill" id="nsProgressFill" style="width:20%"></div></div>
  </div>

  <!-- ==================== Step 1: åŸºæœ¬è³‡æ–™ ==================== -->
  <div class="ns-card ns-fade-in" id="step1">
    <span class="ns-step-num">Step 1 / 5</span>
    <div class="ns-step-title">åŸºæœ¬è³‡æ–™</div>
    <div class="ns-step-desc">æˆ‘å€‘éœ€è¦é€™äº›æ•¸æ“šä¾†è¨ˆç®—ä½ çš„åŸºç¤ä»£è¬ç‡ï¼ˆBMRï¼‰</div>

    <div class="ns-field">
      <label class="ns-label">ç”Ÿç†æ€§åˆ¥</label>
      <div class="ns-toggle-group">
        <input type="radio" name="gender" id="genderM" value="male" checked>
        <label class="ns-toggle" for="genderM"><span class="ns-icon">â™‚</span>ç”·æ€§</label>
        <input type="radio" name="gender" id="genderF" value="female">
        <label class="ns-toggle" for="genderF"><span class="ns-icon">â™€</span>å¥³æ€§</label>
      </div>
    </div>

    <div class="ns-row">
      <div class="ns-field">
        <label class="ns-label" for="age">å¹´é½¡</label>
        <input type="number" id="age" min="15" max="80" placeholder="æ­²">
      </div>
      <div class="ns-field">
        <label class="ns-label" for="height">èº«é«˜</label>
        <input type="number" id="height" min="100" max="230" placeholder="å…¬åˆ†">
      </div>
      <div class="ns-field">
        <label class="ns-label" for="weight">é«”é‡</label>
        <input type="number" id="weight" min="30" max="200" step="0.1" placeholder="å…¬æ–¤">
      </div>
    </div>

    <div class="ns-actions">
      <button class="ns-btn ns-btn-primary" onclick="goStep(2)">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- ==================== Step 2: é£²é£Ÿç¿’æ…£ ==================== -->
  <div class="ns-card ns-hidden" id="step2">
    <span class="ns-step-num">Step 2 / 5</span>
    <div class="ns-step-title">é£²é£Ÿç¿’æ…£</div>
    <div class="ns-step-desc">äº†è§£ä½ çš„æ—¥å¸¸é£²é£Ÿæ¨¡å¼ï¼Œå¹«åŠ©æˆ‘å€‘è©•ä¼°ç‡Ÿé¤Šæ”å–ç‹€æ³</div>

    <div class="ns-field">
      <label class="ns-label">æ¯å¤©æ­£é¤æ•¸é‡</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="meals" id="meals1" value="1-2">
        <label class="ns-toggle" for="meals1"><span class="ns-icon">ğŸ½</span>1-2 é¤</label>
        <input type="radio" name="meals" id="meals2" value="3" checked>
        <label class="ns-toggle" for="meals2"><span class="ns-icon">ğŸ½ğŸ½</span>3 é¤</label>
        <input type="radio" name="meals" id="meals3" value="4+">
        <label class="ns-toggle" for="meals3"><span class="ns-icon">ğŸ½ğŸ½ğŸ½</span>4 é¤ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">é£²é£Ÿé¡å‹</label>
      <div class="ns-toggle-group">
        <input type="radio" name="dietType" id="diet1" value="omnivore" checked>
        <label class="ns-toggle" for="diet1"><span class="ns-icon">ğŸ¥©</span>è‘·é£Ÿç‚ºä¸»</label>
        <input type="radio" name="dietType" id="diet2" value="mostly-plant">
        <label class="ns-toggle" for="diet2"><span class="ns-icon">ğŸ¥—</span>è”¬é£Ÿç‚ºä¸»</label>
        <input type="radio" name="dietType" id="diet3" value="vegetarian">
        <label class="ns-toggle" for="diet3"><span class="ns-icon">ğŸŒ¿</span>ç´ é£Ÿ</label>
        <input type="radio" name="dietType" id="diet4" value="vegan">
        <label class="ns-toggle" for="diet4"><span class="ns-icon">ğŸŒ±</span>å…¨ç´ </label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">æ¯é€±åƒåˆ°ä»¥ä¸‹é£Ÿç‰©çš„é »ç‡ï¼Ÿ</label>
      <div class="ns-hint">é€™å¹«åŠ©æˆ‘å€‘è©•ä¼°ä½ çš„è›‹ç™½è³ªèˆ‡å¾®é‡ç‡Ÿé¤Šç´ æ”å–</div>
    </div>

    <div class="ns-field">
      <label class="ns-label" style="font-weight:500;font-size:.82rem;color:var(--text-secondary)">ä¹³è£½å“ï¼ˆç‰›å¥¶ã€å„ªæ ¼ã€èµ·å¸ï¼‰</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="dairy" id="dairy0" value="rarely">
        <label class="ns-toggle" for="dairy0">å¾ˆå°‘</label>
        <input type="radio" name="dairy" id="dairy1" value="1-3" checked>
        <label class="ns-toggle" for="dairy1">1-3 æ¬¡</label>
        <input type="radio" name="dairy" id="dairy2" value="daily">
        <label class="ns-toggle" for="dairy2">æ¯å¤©</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label" style="font-weight:500;font-size:.82rem;color:var(--text-secondary)">é­šé¡èˆ‡æµ·é®®</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="fish" id="fish0" value="rarely">
        <label class="ns-toggle" for="fish0">å¾ˆå°‘</label>
        <input type="radio" name="fish" id="fish1" value="1-2" checked>
        <label class="ns-toggle" for="fish1">1-2 æ¬¡</label>
        <input type="radio" name="fish" id="fish2" value="3+">
        <label class="ns-toggle" for="fish2">3 æ¬¡ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label" style="font-weight:500;font-size:.82rem;color:var(--text-secondary)">è”¬èœèˆ‡æ°´æœ</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="veggies" id="veg0" value="rarely">
        <label class="ns-toggle" for="veg0">å¶çˆ¾åƒ</label>
        <input type="radio" name="veggies" id="veg1" value="some" checked>
        <label class="ns-toggle" for="veg1">æ¯å¤© 1-2 ä»½</label>
        <input type="radio" name="veggies" id="veg2" value="plenty">
        <label class="ns-toggle" for="veg2">æ¯å¤© 3 ä»½ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="ns-actions">
      <button class="ns-btn ns-btn-secondary" onclick="goStep(1)">ä¸Šä¸€æ­¥</button>
      <button class="ns-btn ns-btn-primary" onclick="goStep(3)">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- ==================== Step 3: ç”Ÿæ´»å‹æ…‹ ==================== -->
  <div class="ns-card ns-hidden" id="step3">
    <span class="ns-step-num">Step 3 / 5</span>
    <div class="ns-step-title">ç”Ÿæ´»å‹æ…‹èˆ‡é‹å‹•ç¿’æ…£</div>
    <div class="ns-step-desc">æ´»å‹•é‡æœƒå½±éŸ¿ä½ çš„æ¯æ—¥ç†±é‡èˆ‡ç‡Ÿé¤Šç´ éœ€æ±‚</div>

    <div class="ns-field">
      <label class="ns-label">æ¯é€±é‹å‹•é »ç‡</label>
      <div class="ns-toggle-group">
        <input type="radio" name="frequency" id="freq0" value="0">
        <label class="ns-toggle" for="freq0"><span class="ns-icon">ğŸš¶</span>å¹¾ä¹ä¸é‹å‹•</label>
        <input type="radio" name="frequency" id="freq1" value="1-2">
        <label class="ns-toggle" for="freq1"><span class="ns-icon">ğŸƒ</span>1-2 æ¬¡</label>
        <input type="radio" name="frequency" id="freq2" value="3-4" checked>
        <label class="ns-toggle" for="freq2"><span class="ns-icon">ğŸ’ª</span>3-4 æ¬¡</label>
        <input type="radio" name="frequency" id="freq3" value="5+">
        <label class="ns-toggle" for="freq3"><span class="ns-icon">ğŸ”¥</span>5 æ¬¡ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">ä¸»è¦é‹å‹•é¡å‹</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="sport" id="sport1" value="strength" checked>
        <label class="ns-toggle" for="sport1"><span class="ns-icon">ğŸ‹ï¸</span>é‡é‡è¨“ç·´</label>
        <input type="radio" name="sport" id="sport2" value="cardio">
        <label class="ns-toggle" for="sport2"><span class="ns-icon">ğŸƒâ€â™‚ï¸</span>æœ‰æ°§é‹å‹•</label>
        <input type="radio" name="sport" id="sport3" value="mixed">
        <label class="ns-toggle" for="sport3"><span class="ns-icon">âš¡</span>æ··åˆè¨“ç·´</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">æ—¥å¸¸æˆ¶å¤–æ—¥æ›¬æ™‚é–“</label>
      <div class="ns-hint">æ—¥æ›¬æ˜¯ç¶­ç”Ÿç´  D çš„é‡è¦ä¾†æºï¼ˆNAHSIT èª¿æŸ¥é¡¯ç¤ºå°ç£æˆäººæ™®éä¸è¶³ï¼‰</div>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="sun" id="sun0" value="rarely">
        <label class="ns-toggle" for="sun0"><span class="ns-icon">ğŸ¢</span>å¾ˆå°‘æ›¬å¤ªé™½</label>
        <input type="radio" name="sun" id="sun1" value="some" checked>
        <label class="ns-toggle" for="sun1"><span class="ns-icon">â›…</span>å¶çˆ¾ 15-30 åˆ†</label>
        <input type="radio" name="sun" id="sun2" value="plenty">
        <label class="ns-toggle" for="sun2"><span class="ns-icon">â˜€ï¸</span>æ¯å¤© 30 åˆ†ä»¥ä¸Š</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">ç¡çœ å“è³ª</label>
      <div class="ns-toggle-group cols-3">
        <input type="radio" name="sleep" id="sleep0" value="poor">
        <label class="ns-toggle" for="sleep0"><span class="ns-icon">ğŸ˜©</span>ä¸å¤ªå¥½</label>
        <input type="radio" name="sleep" id="sleep1" value="ok" checked>
        <label class="ns-toggle" for="sleep1"><span class="ns-icon">ğŸ˜</span>ä¸€èˆ¬</label>
        <input type="radio" name="sleep" id="sleep2" value="good">
        <label class="ns-toggle" for="sleep2"><span class="ns-icon">ğŸ˜´</span>å¾ˆå¥½</label>
      </div>
    </div>

    <div class="ns-actions">
      <button class="ns-btn ns-btn-secondary" onclick="goStep(2)">ä¸Šä¸€æ­¥</button>
      <button class="ns-btn ns-btn-primary" onclick="goStep(4)">ä¸‹ä¸€æ­¥</button>
    </div>
  </div>

  <!-- ==================== Step 4: å¥åº·ç›®æ¨™ ==================== -->
  <div class="ns-card ns-hidden" id="step4">
    <span class="ns-step-num">Step 4 / 5</span>
    <div class="ns-step-title">å¥åº·ç›®æ¨™èˆ‡å›°æ“¾</div>
    <div class="ns-step-desc">æœ€å¾Œä¸€æ­¥ï¼å‘Šè¨´æˆ‘å€‘ä½ çš„ç›®æ¨™ï¼Œå°±èƒ½çœ‹åˆ°ä½ çš„å°ˆå±¬å ±å‘Š</div>

    <div class="ns-field">
      <label class="ns-label">ç›®å‰æœ€ä¸»è¦çš„ç›®æ¨™</label>
      <div class="ns-toggle-group">
        <input type="radio" name="goal" id="goal1" value="muscle" checked>
        <label class="ns-toggle" for="goal1"><span class="ns-icon">ğŸ’ª</span>å¢è‚Œ<span class="ns-toggle-desc">å¢åŠ è‚Œè‚‰é‡èˆ‡åŠ›é‡</span></label>
        <input type="radio" name="goal" id="goal2" value="lean">
        <label class="ns-toggle" for="goal2"><span class="ns-icon">ğŸ”¥</span>æ¸›è„‚<span class="ns-toggle-desc">é™ä½é«”è„‚è‚ªç‡</span></label>
        <input type="radio" name="goal" id="goal3" value="health">
        <label class="ns-toggle" for="goal3"><span class="ns-icon">ğŸŒ¿</span>å¥åº·ç¶­æŒ<span class="ns-toggle-desc">ç¶­æŒæ•´é«”å¥åº·</span></label>
        <input type="radio" name="goal" id="goal4" value="performance">
        <label class="ns-toggle" for="goal4"><span class="ns-icon">ğŸš€</span>é‹å‹•è¡¨ç¾<span class="ns-toggle-desc">æå‡è€åŠ›èˆ‡çˆ†ç™¼åŠ›</span></label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">ç›®å‰æœ‰ä»¥ä¸‹å›°æ“¾å—ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰</label>
      <div class="ns-toggle-group">
        <input type="checkbox" id="issue1" value="recovery">
        <label class="ns-toggle" for="issue1"><span class="ns-icon">ğŸ˜©</span>é‹å‹•å¾Œæ¢å¾©æ…¢</label>
        <input type="checkbox" id="issue2" value="fatigue">
        <label class="ns-toggle" for="issue2"><span class="ns-icon">ğŸ˜´</span>å®¹æ˜“ç–²å‹</label>
        <input type="checkbox" id="issue3" value="digestion">
        <label class="ns-toggle" for="issue3"><span class="ns-icon">ğŸ¤¢</span>æ¶ˆåŒ–ä¸é †</label>
        <input type="checkbox" id="issue4" value="joint">
        <label class="ns-toggle" for="issue4"><span class="ns-icon">ğŸ¦´</span>é—œç¯€ä¸é©</label>
      </div>
    </div>

    <div class="ns-field">
      <label class="ns-label">ç›®å‰æ˜¯å¦æœ‰ä½¿ç”¨ç‡Ÿé¤Šè£œå……å“ï¼Ÿ</label>
      <div class="ns-toggle-group">
        <input type="radio" name="supplement" id="supp0" value="none" checked>
        <label class="ns-toggle" for="supp0"><span class="ns-icon">âœ–</span>æ²’æœ‰</label>
        <input type="radio" name="supplement" id="supp1" value="basic">
        <label class="ns-toggle" for="supp1"><span class="ns-icon">ğŸ’Š</span>åŸºç¤ä¿å¥å“</label>
        <input type="radio" name="supplement" id="supp2" value="sports">
        <label class="ns-toggle" for="supp2"><span class="ns-icon">ğŸ¥¤</span>é‹å‹•è£œå……å“</label>
        <input type="radio" name="supplement" id="supp3" value="both">
        <label class="ns-toggle" for="supp3"><span class="ns-icon">âœ…</span>å…©è€…éƒ½æœ‰</label>
      </div>
    </div>

    <div class="ns-actions">
      <button class="ns-btn ns-btn-secondary" onclick="goStep(3)">ä¸Šä¸€æ­¥</button>
      <button class="ns-btn ns-btn-primary" onclick="calculate()">æŸ¥çœ‹æˆ‘çš„è©•ä¼°çµæœ</button>
    </div>
  </div>

  <!-- ==================== Step 5: Results ==================== -->
  <div class="ns-card ns-hidden" id="step5">
    <span class="ns-step-num">ä½ çš„å°ˆå±¬ç‡Ÿé¤Šå ±å‘Š</span>
    <div class="ns-step-title" id="resultTitle">å€‹äººåŒ–ç‡Ÿé¤Šè©•ä¼°çµæœ</div>
    <div class="ns-step-desc" id="resultDesc"></div>

    <!-- TDEE Hero -->
    <div class="ns-result-hero">
      <div class="ns-big-num" id="resultTDEE">0</div>
      <div class="ns-big-label">æ¯æ—¥å»ºè­°æ”å–ç†±é‡ (kcal)</div>
      <div class="ns-user-summary" id="resultSummary"></div>
    </div>

    <!-- Macros -->
    <div class="ns-section">
      <h3><span class="ns-section-icon">ğŸ“Š</span> å·¨é‡ç‡Ÿé¤Šç´ åˆ†é…</h3>
      <div id="macroList"></div>
    </div>

    <!-- Micronutrient alerts -->
    <div class="ns-section">
      <h3><span class="ns-section-icon">ğŸ”</span> å¾®é‡ç‡Ÿé¤Šç´ é¢¨éšªè©•ä¼°</h3>
      <div id="microList"></div>
    </div>

    <!-- Supplement recommendations -->
    <div class="ns-section">
      <h3><span class="ns-section-icon">ğŸ’Š</span> å»ºè­°ç‡Ÿé¤Šè£œå……æ–¹æ¡ˆ</h3>
      <div id="productList"></div>
    </div>

    <!-- Contact collection -->
    <div class="ns-contact-box" id="contactBox">
      <h3>ğŸ“© å–å¾—å®Œæ•´å ±å‘Š</h3>
      <p>ç•™ä¸‹è¯ç¹«æ–¹å¼ï¼Œæˆ‘å€‘æœƒå°‡å®Œæ•´è©•ä¼°å ±å‘Šå¯„é€çµ¦ä½ ï¼Œä¹Ÿæœƒä¸å®šæœŸåˆ†äº«ç‡Ÿé¤ŠçŸ¥è­˜èˆ‡å°ˆå±¬å„ªæƒ </p>
      <div class="ns-contact-row">
        <div class="ns-field">
          <input type="email" id="contactEmail" placeholder="Email">
        </div>
      </div>
      <div class="ns-contact-row">
        <div class="ns-field">
          <input type="text" id="contactLine" placeholder="LINE IDï¼ˆé¸å¡«ï¼‰">
        </div>
      </div>
      <button class="ns-btn-submit-contact" id="btnSubmitContact" onclick="submitContact()">é€å‡º</button>
      <div class="ns-contact-success" id="contactSuccess">âœ“ å·²æ”¶åˆ°ï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡ä½ è¯ç¹«</div>
    </div>

    <!-- Disclaimer -->
    <div class="ns-disclaimer">
      âš ï¸ æœ¬è©•ä¼°çµæœåƒ…ä¾›åƒè€ƒï¼Œè¨ˆç®—å…¬å¼åŸºæ–¼ Mifflin-St Jeor æ–¹ç¨‹å¼ï¼Œç‡Ÿé¤Šå»ºè­°åƒè€ƒè¡›ç¦éƒ¨ç¬¬å…«ç‰ˆ DRIs åŠåœ‹éš›é‹å‹•ç‡Ÿé¤Šå­¸æœƒï¼ˆISSNï¼‰ç ”ç©¶ã€‚å¯¦éš›éœ€æ±‚å› å€‹äººé«”è³ªèˆ‡å¥åº·ç‹€æ³è€Œç•°ï¼Œå¦‚æœ‰ç‰¹æ®Šç–¾ç—…æˆ–ç”¨è—¥ï¼Œè«‹å…ˆè«®è©¢é†«å¸«æˆ–ç‡Ÿé¤Šå¸«ã€‚
    </div>

    <!-- References -->
    <details class="ns-references">
      <summary>åƒè€ƒæ–‡ç»èˆ‡è³‡æ–™ä¾†æº</summary>
      <div class="ns-ref-list">
        1. Mifflin MD, St Jeor ST, et al. (1990). A new predictive equation for resting energy expenditure. <em>Am J Clin Nutr</em>, 51(2), 241-247.<br>
        2. è¡›ç”Ÿç¦åˆ©éƒ¨åœ‹æ°‘å¥åº·ç½²ï¼ˆ2020ï¼‰ã€‚åœ‹äººè†³é£Ÿç‡Ÿé¤Šç´ åƒè€ƒæ”å–é‡ç¬¬å…«ç‰ˆã€‚<br>
        3. JÃ¤ger R, Kerksick CM, et al. (2017). ISSN Position Stand: Protein and exercise. <em>J Int Soc Sports Nutr</em>, 14:20.<br>
        4. Kerksick CM, et al. (2018). ISSN exercise & sports nutrition review update. <em>J Int Soc Sports Nutr</em>, 15:38.<br>
        5. åœ‹æ°‘ç‡Ÿé¤Šå¥åº·ç‹€æ³è®Šé·èª¿æŸ¥ï¼ˆNAHSIT 2013-2020ï¼‰ã€‚
      </div>
    </details>

    <!-- Bottom actions -->
    <div class="ns-bottom-actions">
      <button class="ns-btn-action" onclick="restart()">â†» é‡æ–°è©•ä¼°</button>
      <button class="ns-btn-action ns-btn-pdf" onclick="downloadPDF()">ğŸ“„ ä¸‹è¼‰ PDF å ±å‘Š</button>
    </div>
  </div>
</div>

<script>
(function(){
"use strict";

/* ====== Helpers ====== */
function getVal(name){
  var el=document.querySelector('input[name="'+name+'"]:checked');
  return el?el.value:null;
}
function getNum(id){return parseFloat(document.getElementById(id).value)||0}
function getChecked(){
  var ids=["issue1","issue2","issue3","issue4"],out=[];
  ids.forEach(function(id){if(document.getElementById(id).checked) out.push(document.getElementById(id).value)});
  return out;
}

/* ====== Step Navigation ====== */
var currentStep=1;
window.goStep=function(n){
  if(n===2 && currentStep===1){
    if(!getNum("age")||!getNum("weight")||!getNum("height")){alert("è«‹å¡«å¯«å®Œæ•´çš„åŸºæœ¬è³‡æ–™ï¼ˆå¹´é½¡ã€èº«é«˜ã€é«”é‡ï¼‰");return}
    if(getNum("age")<15||getNum("age")>80){alert("è«‹è¼¸å…¥åˆç†çš„å¹´é½¡ï¼ˆ15-80 æ­²ï¼‰");return}
  }
  document.getElementById("step"+currentStep).classList.add("ns-hidden");
  var target=document.getElementById("step"+n);
  target.classList.remove("ns-hidden");
  target.classList.remove("ns-fade-in");
  void target.offsetWidth;
  target.classList.add("ns-fade-in");
  currentStep=n;
  updateProgress();
  window.scrollTo({top:0,behavior:"smooth"});
};

function updateProgress(){
  var fill=document.getElementById("nsProgressFill");
  fill.style.width=(currentStep/5*100)+"%";
  var steps=document.querySelectorAll(".ns-progress-step");
  steps.forEach(function(s){
    var si=parseInt(s.getAttribute("data-step"));
    s.classList.remove("active","done");
    if(si<currentStep) s.classList.add("done");
    else if(si===currentStep) s.classList.add("active");
  });
}

/* ====== Main Calculation ====== */
window.calculate=function(){
  var gender=getVal("gender"),age=getNum("age"),weight=getNum("weight"),height=getNum("height");
  var meals=getVal("meals"),dietType=getVal("dietType");
  var dairy=getVal("dairy"),fish=getVal("fish"),veggies=getVal("veggies");
  var freq=getVal("frequency"),sport=getVal("sport"),sun=getVal("sun"),sleep=getVal("sleep");
  var goal=getVal("goal"),issues=getChecked(),supplement=getVal("supplement");

  /* === BMR (Mifflin-St Jeor, 1990) === */
  var bmr;
  if(gender==="male") bmr=10*weight+6.25*height-5*age+5;
  else bmr=10*weight+6.25*height-5*age-161;

  /* === TDEE === */
  var actMul={"0":1.2,"1-2":1.375,"3-4":1.55,"5+":1.725};
  var tdee=Math.round(bmr*(actMul[freq]||1.55));

  /* Goal adjustment */
  var goalAdj={"muscle":1.10,"lean":0.80,"health":1.0,"performance":1.05};
  tdee=Math.round(tdee*(goalAdj[goal]||1));

  /* === Macros (ISSN guidelines) === */
  var proteinPerKg,fatPct;
  switch(goal){
    case"muscle":      proteinPerKg=2.0; fatPct=0.25; break;
    case"lean":        proteinPerKg=2.4; fatPct=0.28; break;
    case"performance": proteinPerKg=1.8; fatPct=0.22; break;
    default:           proteinPerKg=1.4; fatPct=0.28;
  }
  if(freq==="5+") proteinPerKg+=0.2;

  var protein=Math.round(proteinPerKg*weight);
  var fat=Math.round((tdee*fatPct)/9);
  var carb=Math.round((tdee-protein*4-fat*9)/4);
  if(carb<0) carb=0;

  /* === Render TDEE & Summary === */
  document.getElementById("resultTDEE").textContent=tdee.toLocaleString();
  document.getElementById("resultSummary").textContent=
    (gender==="male"?"ç”·æ€§":"å¥³æ€§")+" Â· "+age+" æ­² Â· "+height+" cm Â· "+weight+" kg";
  document.getElementById("resultDesc").textContent=
    "æ ¹æ“šä½ çš„èº«é«”æ•¸æ“šã€é£²é£Ÿç¿’æ…£èˆ‡è¨“ç·´ç›®æ¨™ï¼Œä»¥ä¸‹æ˜¯æˆ‘å€‘ç‚ºä½ é‡èº«æ‰“é€ çš„ç‡Ÿé¤Šå»ºè­°ã€‚";

  /* === Render Macros === */
  var macros=[
    {name:"è›‹ç™½è³ª",val:protein,unit:"g",cal:protein*4,color:"#2563eb"},
    {name:"ç¢³æ°´åŒ–åˆç‰©",val:carb,unit:"g",cal:carb*4,color:"#f59e0b"},
    {name:"è„‚è‚ª",val:fat,unit:"g",cal:fat*9,color:"#ef4444"}
  ];
  var macroHTML="";
  macros.forEach(function(m){
    var pct=Math.round(m.cal/tdee*100);
    macroHTML+='<div class="ns-macro">'
      +'<span class="ns-macro-name">'+m.name+'</span>'
      +'<div class="ns-macro-bar-wrap"><div class="ns-macro-bar" style="width:'+pct+'%;background:'+m.color+'"></div></div>'
      +'<span class="ns-macro-val">'+m.val+' '+m.unit+' ('+pct+'%)</span></div>';
  });
  document.getElementById("macroList").innerHTML=macroHTML;

  /* === Micronutrient Risk Assessment === */
  var micros=buildMicroAssessment(gender,age,dairy,fish,veggies,sun,dietType,issues);
  var microHTML="";
  micros.forEach(function(m){
    microHTML+='<div class="ns-micro-card">'
      +'<span class="ns-micro-icon">'+m.icon+'</span>'
      +'<div class="ns-micro-info">'
      +'<div class="ns-micro-name">'+m.name+'</div>'
      +'<div class="ns-micro-detail">'+m.detail+'</div></div>'
      +'<span class="ns-micro-status ns-status-'+m.status+'">'+m.statusLabel+'</span></div>';
  });
  document.getElementById("microList").innerHTML=microHTML;

  /* === Product Recommendations === */
  var products=buildRecommendations(gender,weight,goal,freq,sport,dietType,dairy,fish,veggies,sun,issues,supplement,protein);
  var prodHTML="";
  products.forEach(function(p){
    prodHTML+='<div class="ns-product">'
      +'<div class="ns-product-icon" style="background:'+p.bgColor+'">'+p.icon+'</div>'
      +'<div class="ns-product-info">'
      +'<div class="ns-product-name">'+p.name+'</div>'
      +'<div class="ns-product-dose">å»ºè­°ç”¨é‡ï¼š'+p.dose+'</div>'
      +'<div class="ns-product-reason">'+p.reason+'</div>'
      +(p.evidence?'<div class="ns-product-evidence">'+p.evidence+'</div>':'')
      +'</div>'
      +'<span class="ns-product-tag ns-tag-'+p.priority+'">'+p.priorityLabel+'</span></div>';
  });
  document.getElementById("productList").innerHTML=prodHTML;

  /* Store data for PDF */
  window._surveyResult={gender:gender,age:age,weight:weight,height:height,tdee:tdee,
    protein:protein,carb:carb,fat:fat,macros:macros,micros:micros,products:products,
    goal:goal,freq:freq,sport:sport,dietType:dietType};

  goStep(5);
};

/* ====== Micronutrient Assessment ====== */
function buildMicroAssessment(gender,age,dairy,fish,veggies,sun,dietType,issues){
  var items=[];

  /* Vitamin D â€” NAHSIT: 22-43% deficiency in TW adults */
  var vitDstatus="warning",vitDlabel="ç•™æ„";
  if(sun==="rarely"){vitDstatus="low";vitDlabel="åä½é¢¨éšª"}
  else if(sun==="plenty"){vitDstatus="ok";vitDlabel="è‰¯å¥½"}
  items.push({
    name:"ç¶­ç”Ÿç´  D",icon:"â˜€ï¸",status:vitDstatus,statusLabel:vitDlabel,
    detail:"å°ç£ NAHSIT èª¿æŸ¥é¡¯ç¤º 22-43% æˆäººç¶­ç”Ÿç´  D ä¸è¶³ã€‚è¡›ç¦éƒ¨å»ºè­°æ¯æ—¥æ”å– 400 IUï¼ˆ19-50 æ­²ï¼‰ã€‚"+
      (sun==="rarely"?"ä½ çš„æ—¥æ›¬æ™‚é–“åå°‘ï¼Œå»ºè­°é¡å¤–è£œå……ã€‚":"")
  });

  /* Calcium â€” consistently below DRI in TW */
  var caStatus="warning",caLabel="ç•™æ„";
  if(dairy==="daily"){caStatus="ok";caLabel="è‰¯å¥½"}
  else if(dairy==="rarely"){caStatus="low";caLabel="åä½é¢¨éšª"}
  items.push({
    name:"éˆ£è³ª",icon:"ğŸ¦´",status:caStatus,statusLabel:caLabel,
    detail:"è¡›ç¦éƒ¨å»ºè­°æˆäººæ¯æ—¥ 1,000 mgã€‚NAHSIT æ•¸æ“šé¡¯ç¤ºå¤šæ•¸å°ç£æˆäººæ”å–é‡ä½æ–¼å»ºè­°å€¼ 70%ã€‚"+
      (dairy==="rarely"?"ä½ çš„ä¹³è£½å“æ”å–åå°‘ï¼Œå»ºè­°å¢åŠ æˆ–è€ƒæ…®è£œå……ã€‚":"")
  });

  /* Iron â€” especially for women */
  var feStatus="ok",feLabel="è‰¯å¥½";
  if(gender==="female"&&age<50){
    feStatus="warning";feLabel="ç•™æ„";
    if(dietType==="vegetarian"||dietType==="vegan"){feStatus="low";feLabel="åä½é¢¨éšª"}
  }
  if(dietType==="vegan"){feStatus="warning";feLabel="ç•™æ„"}
  items.push({
    name:"éµè³ª",icon:"ğŸ©¸",status:feStatus,statusLabel:feLabel,
    detail:"è¡›ç¦éƒ¨å»ºè­°ï¼šç”·æ€§ 10 mg/å¤©ï¼Œè‚²é½¡å¥³æ€§ 15 mg/å¤©ã€‚"+
      (gender==="female"&&age<50?"è‚²é½¡å¥³æ€§éœ€æ±‚è¼ƒé«˜ï¼Œå»ºè­°æ³¨æ„æ”å–ã€‚":"")+
      (dietType==="vegan"?"æ¤ç‰©æ€§é£²é£Ÿä¸­çš„éµè³ªå¸æ”¶ç‡è¼ƒä½ï¼Œå»ºè­°æ­é…ç¶­ç”Ÿç´  C æ”å–ã€‚":"")
  });

  /* Omega-3 */
  var o3Status="ok",o3Label="è‰¯å¥½";
  if(fish==="rarely"){o3Status="warning";o3Label="ç•™æ„"}
  if(fish==="rarely"&&(issues.indexOf("joint")!==-1||issues.indexOf("recovery")!==-1)){o3Status="low";o3Label="åä½é¢¨éšª"}
  items.push({
    name:"Omega-3 è„‚è‚ªé…¸",icon:"ğŸŸ",status:o3Status,statusLabel:o3Label,
    detail:"EPA èˆ‡ DHA æœ‰åŠ©æ–¼æŠ—ç™¼ç‚èˆ‡å¿ƒè¡€ç®¡å¥åº·ã€‚"+
      (fish==="rarely"?"ä½ çš„é­šé¡æ”å–åå°‘ï¼Œå¯è€ƒæ…®é­šæ²¹è£œå……ã€‚":"æ¯é€± 1-2 æ¬¡é­šé¡æ”å–æœ‰åŠ©ç¶­æŒã€‚")
  });

  /* Fiber */
  var fibStatus="ok",fibLabel="è‰¯å¥½";
  if(veggies==="rarely"){fibStatus="low";fibLabel="åä½é¢¨éšª"}
  else if(veggies==="some"){fibStatus="warning";fibLabel="ç•™æ„"}
  items.push({
    name:"è†³é£Ÿçº–ç¶­",icon:"ğŸ¥¬",status:fibStatus,statusLabel:fibLabel,
    detail:"è¡›ç¦éƒ¨å»ºè­°æ¯æ—¥ 25-35gã€‚NAHSIT é¡¯ç¤ºå¤šæ•¸å°ç£æˆäººæ”å–ä¸è¶³ã€‚"+
      (veggies==="rarely"?"å»ºè­°å¢åŠ è”¬æœæ”å–é‡ã€‚":"")
  });

  /* Magnesium â€” moderate deficiency in TW */
  var mgStatus="ok",mgLabel="è‰¯å¥½";
  if(veggies==="rarely"&&dairy==="rarely"){mgStatus="warning";mgLabel="ç•™æ„"}
  if(issues.indexOf("fatigue")!==-1||issues.indexOf("recovery")!==-1){
    if(mgStatus==="ok"){mgStatus="warning";mgLabel="ç•™æ„"}
  }
  items.push({
    name:"é‚",icon:"âš¡",status:mgStatus,statusLabel:mgLabel,
    detail:"è¡›ç¦éƒ¨å»ºè­°ï¼šç”·æ€§ 380 mg/å¤©ï¼Œå¥³æ€§ 320 mg/å¤©ã€‚é‚åƒèˆ‡ 300 ç¨®ä»¥ä¸Šé…µç´ åæ‡‰ï¼Œèˆ‡è‚Œè‚‰åŠŸèƒ½å’Œç¡çœ å“è³ªå¯†åˆ‡ç›¸é—œã€‚"
  });

  return items;
}

/* ====== Supplement Recommendations ====== */
function buildRecommendations(gender,weight,goal,freq,sport,dietType,dairy,fish,veggies,sun,issues,supplement,proteinTarget){
  var items=[];
  var active=(freq==="3-4"||freq==="5+");
  var intense=(freq==="5+");
  var isVeg=(dietType==="vegetarian"||dietType==="vegan");

  /* 1. Whey Protein â€” ISSN Category A */
  if(goal==="muscle"||goal==="lean"||goal==="performance"||active){
    var proteinGap=Math.round(proteinTarget*0.35);
    var scoops=Math.max(1,Math.ceil(proteinGap/25));
    items.push({
      name:isVeg?"æ¤ç‰©è›‹ç™½ï¼ˆè±Œè±†+ç±³è›‹ç™½ï¼‰":"ä¹³æ¸…è›‹ç™½",
      icon:"ğŸ¥¤",bgColor:"#dbeafe",
      dose:"æ¯æ—¥ "+scoops+" ä»½ï¼ˆç´„ "+(scoops*25)+"g è›‹ç™½è³ªï¼‰",
      reason:"è£œè¶³æ¯æ—¥è›‹ç™½è³ªç¼ºå£ï¼Œæ”¯æŒè‚Œè‚‰åˆæˆèˆ‡ä¿®å¾©ã€‚ISSN å»ºè­°é‹å‹•è€…æ”å– "+
        (goal==="lean"?"2.3-3.1":"1.4-2.0")+" g/kg/å¤©ã€‚",
      evidence:"ISSN Category A â€” å¼·åŠ›è­‰æ“šæ”¯æŒ",
      priority:"essential",priorityLabel:"æ ¸å¿ƒæ¨è–¦",score:100
    });
  }

  /* 2. Creatine â€” ISSN Category A */
  if(goal==="muscle"||goal==="performance"||sport==="strength"||sport==="mixed"){
    items.push({
      name:"è‚Œé…¸ï¼ˆCreatine Monohydrateï¼‰",
      icon:"âš¡",bgColor:"#fef3c7",
      dose:"æ¯æ—¥ 3-5gï¼Œæ­é…æ°´æˆ–æœæ±",
      reason:"æå‡åŠ›é‡è¼¸å‡ºèˆ‡é«˜å¼·åº¦é‹å‹•è¡¨ç¾ï¼ŒåŠ é€Ÿç£·é…¸è‚Œé…¸å†åˆæˆ",
      evidence:"ISSN Category A â€” ç ”ç©¶æœ€å……åˆ†çš„é‹å‹•è£œå……å“ä¹‹ä¸€",
      priority:"essential",priorityLabel:"æ ¸å¿ƒæ¨è–¦",score:95
    });
  }

  /* 3. Vitamin D â€” based on TW deficiency data */
  if(sun!=="plenty"){
    items.push({
      name:"ç¶­ç”Ÿç´  D3",
      icon:"â˜€ï¸",bgColor:"#fef9c3",
      dose:sun==="rarely"?"æ¯æ—¥ 1000-2000 IU":"æ¯æ—¥ 400-1000 IU",
      reason:"NAHSIT èª¿æŸ¥é¡¯ç¤ºå°ç£æˆäººæ™®éä¸è¶³ï¼ˆ22-43%ï¼‰ï¼Œå½±éŸ¿éª¨éª¼ã€è‚Œè‚‰åŠŸèƒ½èˆ‡å…ç–«åŠ›",
      evidence:"è¡›ç¦éƒ¨ DRIs ç¬¬å…«ç‰ˆå»ºè­° 400 IU/å¤©ï¼ˆ19-50 æ­²ï¼‰",
      priority:sun==="rarely"?"essential":"recommended",
      priorityLabel:sun==="rarely"?"æ ¸å¿ƒæ¨è–¦":"å»ºè­°è£œå……",score:sun==="rarely"?88:65
    });
  }

  /* 4. Calcium */
  if(dairy!=="daily"){
    items.push({
      name:"éˆ£è³ªè£œå……",
      icon:"ğŸ¦´",bgColor:"#f0fdf4",
      dose:"æ¯æ—¥ 500-600 mgï¼ˆåˆ†æ¬¡æœç”¨å¸æ”¶è¼ƒä½³ï¼‰",
      reason:"NAHSIT æ•¸æ“šé¡¯ç¤ºå°ç£æˆäººéˆ£è³ªæ”å–æ™®éä½æ–¼ DRI å»ºè­°çš„ 1,000 mg/å¤©",
      evidence:"è¡›ç¦éƒ¨ DRIs ç¬¬å…«ç‰ˆ",
      priority:dairy==="rarely"?"essential":"recommended",
      priorityLabel:dairy==="rarely"?"æ ¸å¿ƒæ¨è–¦":"å»ºè­°è£œå……",score:dairy==="rarely"?82:60
    });
  }

  /* 5. Fish Oil / Omega-3 */
  if(fish==="rarely"||(issues.indexOf("joint")!==-1)||(issues.indexOf("recovery")!==-1)){
    items.push({
      name:"é«˜æ¿ƒåº¦é­šæ²¹ï¼ˆOmega-3ï¼‰",
      icon:"ğŸŸ",bgColor:"#dbeafe",
      dose:"æ¯æ—¥ 2-3g EPA+DHA",
      reason:issues.indexOf("joint")!==-1
        ?"EPA/DHA å…·æŠ—ç™¼ç‚åŠŸæ•ˆï¼Œæœ‰åŠ©æ–¼ç·©è§£é—œç¯€ä¸é©èˆ‡ä¿ƒé€²é‹å‹•æ¢å¾©"
        :"è£œå…… EPA/DHAï¼Œæ”¯æŒå¿ƒè¡€ç®¡å¥åº·èˆ‡æŠ—ç™¼ç‚åŠŸèƒ½",
      evidence:"",
      priority:issues.indexOf("joint")!==-1?"essential":"recommended",
      priorityLabel:issues.indexOf("joint")!==-1?"æ ¸å¿ƒæ¨è–¦":"å»ºè­°è£œå……",
      score:issues.indexOf("joint")!==-1?85:62
    });
  }

  /* 6. Magnesium â€” sleep/fatigue */
  if(issues.indexOf("fatigue")!==-1||issues.indexOf("recovery")!==-1||
    (veggies==="rarely"&&dairy==="rarely")){
    items.push({
      name:"é‚ï¼ˆç”˜èƒºé…¸é‚ï¼‰",
      icon:"ğŸŒ™",bgColor:"#ede9fe",
      dose:"ç¡å‰ 200-400 mg",
      reason:issues.indexOf("fatigue")!==-1
        ?"é‚åƒèˆ‡èƒ½é‡ä»£è¬èˆ‡è‚Œè‚‰åŠŸèƒ½ï¼Œæœ‰åŠ©æ”¹å–„ç–²å‹æ„Ÿ"
        :"æ”¯æŒè‚Œè‚‰æ¢å¾©èˆ‡æ”¾é¬†ï¼Œæ”¹å–„ç¡çœ å“è³ª",
      evidence:"è¡›ç¦éƒ¨ DRIsï¼šç”·æ€§ 380 mgã€å¥³æ€§ 320 mg/å¤©",
      priority:"recommended",priorityLabel:"å»ºè­°è£œå……",score:70
    });
  }

  /* 7. BCAA â€” for intense training or fat loss */
  if(intense||goal==="lean"){
    items.push({
      name:"BCAA æ”¯éˆèƒºåŸºé…¸",
      icon:"ğŸ’§",bgColor:"#d1fae5",
      dose:"è¨“ç·´ä¸­ 5-10g",
      reason:goal==="lean"?"æ¸›è„‚æœŸé–“ç¶­æŒè‚Œè‚‰é‡ï¼Œå»¶ç·©è¨“ç·´ç–²å‹":"æ”¯æŒé«˜å¼·åº¦è¨“ç·´æ¢å¾©ï¼Œæ¸›å°‘è‚Œè‚‰åˆ†è§£",
      evidence:"",
      priority:"recommended",priorityLabel:"å»ºè­°è£œå……",score:68
    });
  }

  /* 8. Caffeine â€” ISSN Category A for performance */
  if(goal==="performance"||(intense&&issues.indexOf("fatigue")!==-1)){
    items.push({
      name:"å’–å•¡å› ",
      icon:"â˜•",bgColor:"#fef3c7",
      dose:"è¨“ç·´å‰ 30 åˆ†é˜ï¼Œ3-6 mg/kg é«”é‡ï¼ˆç´„ "+(Math.round(weight*4))+" mgï¼‰",
      reason:"æå‡é‹å‹•è¡¨ç¾ã€å°ˆæ³¨åŠ›èˆ‡è€åŠ›",
      evidence:"ISSN Category A â€” æœ€å»£æ³›ç ”ç©¶çš„é‹å‹•å¢è£œåŠ‘ä¹‹ä¸€",
      priority:"recommended",priorityLabel:"å»ºè­°è£œå……",score:66
    });
  }

  /* 9. Iron â€” for veg women */
  if(gender==="female"&&age<50&&(isVeg||dietType==="mostly-plant")){
    items.push({
      name:"éµè³ªè£œå……",
      icon:"ğŸ©¸",bgColor:"#fce7f3",
      dose:"æ¯æ—¥ 10-15 mgï¼Œæ­é…ç¶­ç”Ÿç´  C æœç”¨",
      reason:"è‚²é½¡å¥³æ€§éœ€æ±‚è¼ƒé«˜ï¼ˆDRI 15 mg/å¤©ï¼‰ï¼Œæ¤ç‰©æ€§é£²é£Ÿä¸­éè¡€åŸºè³ªéµå¸æ”¶ç‡è¼ƒä½",
      evidence:"è¡›ç¦éƒ¨ DRIs ç¬¬å…«ç‰ˆ",
      priority:"recommended",priorityLabel:"å»ºè­°è£œå……",score:72
    });
  }

  /* 10. Glutamine â€” digestion/recovery */
  if(issues.indexOf("digestion")!==-1||issues.indexOf("recovery")!==-1){
    items.push({
      name:"éº©é†¯èƒºé…¸ï¼ˆGlutamineï¼‰",
      icon:"ğŸ”¬",bgColor:"#fce7f3",
      dose:"è¨“ç·´å¾Œ 5-10g",
      reason:issues.indexOf("digestion")!==-1
        ?"æ”¯æŒè…¸é“é»è†œä¿®å¾©èˆ‡æ¶ˆåŒ–é“å¥åº·"
        :"åŠ é€Ÿè‚Œè‚‰ä¿®å¾©ï¼Œæ”¯æŒå…ç–«åŠŸèƒ½",
      evidence:"",
      priority:"optional",priorityLabel:"å¯è€ƒæ…®",score:55
    });
  }

  items.sort(function(a,b){return b.score-a.score});
  return items;
}

/* ====== Contact Submission ====== */
window.submitContact=function(){
  var email=document.getElementById("contactEmail").value.trim();
  var line=document.getElementById("contactLine").value.trim();
  if(!email){alert("è«‹è¼¸å…¥ Email");return}
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email");return}

  /* In production, send to backend API. For now, store in localStorage. */
  var data=window._surveyResult||{};
  data.email=email;
  data.line=line;
  data.timestamp=new Date().toISOString();
  try{
    var existing=JSON.parse(localStorage.getItem("ns_contacts")||"[]");
    existing.push(data);
    localStorage.setItem("ns_contacts",JSON.stringify(existing));
  }catch(e){}

  document.getElementById("btnSubmitContact").style.display="none";
  document.getElementById("contactSuccess").style.display="block";
};

/* ====== PDF Download ====== */
window.downloadPDF=function(){
  var d=window._surveyResult;
  if(!d) return;

  var goalMap={"muscle":"å¢è‚Œ","lean":"æ¸›è„‚","health":"å¥åº·ç¶­æŒ","performance":"é‹å‹•è¡¨ç¾"};
  var lines=[];
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("     OUTRUN NUTRITION â€” å€‹äººåŒ–ç‡Ÿé¤Šè©•ä¼°å ±å‘Š");
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("");
  lines.push("ç”¢å‡ºæ—¥æœŸï¼š"+new Date().toLocaleDateString("zh-TW"));
  lines.push("");
  lines.push("ã€ åŸºæœ¬è³‡æ–™ ã€‘");
  lines.push("  æ€§åˆ¥ï¼š  "+(d.gender==="male"?"ç”·æ€§":"å¥³æ€§"));
  lines.push("  å¹´é½¡ï¼š  "+d.age+" æ­²");
  lines.push("  èº«é«˜ï¼š  "+d.height+" cm");
  lines.push("  é«”é‡ï¼š  "+d.weight+" kg");
  lines.push("  ç›®æ¨™ï¼š  "+(goalMap[d.goal]||d.goal));
  lines.push("");
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("ã€ æ¯æ—¥å»ºè­°æ”å–ç†±é‡ ã€‘");
  lines.push("  TDEE = "+d.tdee.toLocaleString()+" kcal");
  lines.push("  ï¼ˆåŸºæ–¼ Mifflin-St Jeor å…¬å¼ Ã— æ´»å‹•ä¿‚æ•¸ Ã— ç›®æ¨™ä¿‚æ•¸ï¼‰");
  lines.push("");
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("ã€ å·¨é‡ç‡Ÿé¤Šç´ åˆ†é… ã€‘");
  lines.push("  è›‹ç™½è³ªï¼š    "+d.protein+" g ï¼ˆ"+Math.round(d.protein*4/d.tdee*100)+"%ï¼‰");
  lines.push("  ç¢³æ°´åŒ–åˆç‰©ï¼š"+d.carb+" g ï¼ˆ"+Math.round(d.carb*4/d.tdee*100)+"%ï¼‰");
  lines.push("  è„‚è‚ªï¼š      "+d.fat+" g ï¼ˆ"+Math.round(d.fat*9/d.tdee*100)+"%ï¼‰");
  lines.push("");
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("ã€ å¾®é‡ç‡Ÿé¤Šç´ é¢¨éšªè©•ä¼° ã€‘");
  d.micros.forEach(function(m){
    var tag=m.status==="ok"?"âœ“ è‰¯å¥½":m.status==="warning"?"â–³ ç•™æ„":"âœ— åä½é¢¨éšª";
    lines.push("  "+m.icon+" "+m.name+"  "+tag);
    lines.push("     "+m.detail.replace(/<[^>]*>/g,""));
    lines.push("");
  });
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("ã€ å»ºè­°ç‡Ÿé¤Šè£œå……æ–¹æ¡ˆ ã€‘");
  d.products.forEach(function(p,i){
    lines.push("  "+(i+1)+". "+p.name+" ["+p.priorityLabel+"]");
    lines.push("     ç”¨é‡ï¼š"+p.dose);
    lines.push("     åŸå› ï¼š"+p.reason);
    if(p.evidence) lines.push("     ä¾æ“šï¼š"+p.evidence);
    lines.push("");
  });
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("ã€ åƒè€ƒæ–‡ç» ã€‘");
  lines.push("  1. Mifflin MD, St Jeor ST, et al. (1990). Am J Clin Nutr, 51(2), 241-247.");
  lines.push("  2. è¡›ç¦éƒ¨ï¼ˆ2020ï¼‰åœ‹äººè†³é£Ÿç‡Ÿé¤Šç´ åƒè€ƒæ”å–é‡ç¬¬å…«ç‰ˆ");
  lines.push("  3. JÃ¤ger R, et al. (2017). ISSN Position Stand: Protein and exercise.");
  lines.push("  4. Kerksick CM, et al. (2018). ISSN exercise & sports nutrition review.");
  lines.push("  5. åœ‹æ°‘ç‡Ÿé¤Šå¥åº·ç‹€æ³è®Šé·èª¿æŸ¥ï¼ˆNAHSIT 2013-2020ï¼‰");
  lines.push("");
  lines.push("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  lines.push("âš ï¸ æœ¬å ±å‘Šåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆé†«ç™‚å»ºè­°ã€‚");
  lines.push("   å¦‚æœ‰ç‰¹æ®Šå¥åº·ç‹€æ³ï¼Œè«‹è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡ã€‚");
  lines.push("");
  lines.push("Outrun Nutrition â€” é™ªä½ è·‘å¾—æ›´é ");

  var text=lines.join("\n");
  var blob=new Blob(["\uFEFF"+text],{type:"text/plain;charset=utf-8"});
  var url=URL.createObjectURL(blob);
  var a=document.createElement("a");
  a.href=url;
  a.download="Outrun_Nutrition_ç‡Ÿé¤Šè©•ä¼°å ±å‘Š.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};

/* ====== Restart ====== */
window.restart=function(){
  document.getElementById("step5").classList.add("ns-hidden");
  document.getElementById("step1").classList.remove("ns-hidden");
  document.getElementById("step1").classList.add("ns-fade-in");
  currentStep=1;
  updateProgress();
  document.getElementById("age").value="";
  document.getElementById("height").value="";
  document.getElementById("weight").value="";
  /* Reset contact */
  document.getElementById("contactEmail").value="";
  document.getElementById("contactLine").value="";
  document.getElementById("btnSubmitContact").style.display="";
  document.getElementById("contactSuccess").style.display="none";
  window.scrollTo({top:0,behavior:"smooth"});
};

})();
</script>
</body>
</html>
